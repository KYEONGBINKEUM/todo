"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[907],{9907:function(e,t,r){r.d(t,{Z:function(){return x}});var n=r(6717),o=r(7387),a=r(8519),s=r(1730),i=r(1097),l=r(2423),d=r(354);let c=[{value:"urgent",label:"긴급",color:"#ef4444"},{value:"high",label:"높음",color:"#f97316"},{value:"medium",label:"보통",color:"#eab308"},{value:"low",label:"낮음",color:"#22c55e"}],u=d.mB;function x(e){var t,r,x,m,p,f,h,b,v,g,j,y;let{task:N,onClose:w,onUpdate:k,onDelete:D}=e,{user:C}=(0,i.a)(),S=(0,a.useRouter)(),[E,P]=(0,o.useState)(N.title),R=(0,o.useRef)(null),[T,z]=(0,o.useState)(""),[B,L]=(0,o.useState)(null),[I,_]=(0,o.useState)(""),A=(0,o.useRef)(null),[M,U]=(0,o.useState)(null!==(x=N.memo)&&void 0!==x?x:""),O=(0,o.useRef)(null),{notes:F}=(0,s.a)(),[W,J]=(0,o.useState)(!1),K=(0,o.useRef)(null),H=(0,o.useRef)(null);(0,o.useEffect)(()=>{var e;P(N.title),U(null!==(e=N.memo)&&void 0!==e?e:""),L(null)},[N.id]),(0,o.useEffect)(()=>{B&&A.current&&(A.current.focus(),A.current.select())},[B]);let q=e=>{P(e),R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{k({title:e.trim()||"제목 없음"})},400)},X=null!==(m=N.subTasks)&&void 0!==m?m:[],Q=()=>{var e;let t=T.trim();t&&(k({subTasks:[...X,{id:"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,6)),title:t,completed:!1}]}),z(""),null===(e=K.current)||void 0===e||e.focus())},V=e=>{k({subTasks:X.map(t=>t.id===e?{...t,completed:!t.completed}:t)})},Y=e=>{k({subTasks:X.filter(t=>t.id!==e)})},Z=e=>{L(e.id),_(e.title)},G=e=>{let t=I.trim();t&&k({subTasks:X.map(r=>r.id===e?{...r,title:t}:r)}),L(null)},$=e=>{U(e),O.current&&clearTimeout(O.current),O.current=setTimeout(()=>k({memo:e}),500)},ee=null!==(p=N.attachments)&&void 0!==p?p:[],[et,er]=(0,o.useState)(!1),[en,eo]=(0,o.useState)([]),ea=async e=>{var t;let r=Array.from(null!==(t=e.target.files)&&void 0!==t?t:[]);if(H.current&&(H.current.value=""),!r.length||!C||!N.id)return;let n=r.filter(e=>!(e.size>u)||(alert('"'.concat(e.name,'"은 10 MB를 초과하여 첨부할 수 없습니다.')),!1));if(!n.length)return;er(!0),eo(n.map(e=>({name:e.name,percent:0})));let o=[];for(let e=0;e<n.length;e++){let t=n[e],r="".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,6)),{downloadURL:a,storagePath:s}=await (0,d.pD)(C.uid,N.id,t,r,t=>{eo(r=>r.map((r,n)=>n===e?{...r,percent:t}:r))});o.push({id:r,name:t.name,size:t.size,type:t.type,addedAt:new Date().toISOString(),downloadURL:a,storagePath:s}),eo(t=>t.map((t,r)=>r===e?{...t,percent:100}:t))}k({attachments:[...ee,...o]}),er(!1),eo([])},es=async e=>{e.storagePath?await (0,d.dU)(e.storagePath):await (0,d.FV)([e.id]),k({attachments:ee.filter(t=>t.id!==e.id)})},ei=e=>{e.downloadURL?(0,d.TH)(e.downloadURL,e.name,e.type):(0,d.Qs)(e.id,e.name,e.type)},el=e=>e<1024?"".concat(e," B"):e<1048576?"".concat((e/1024).toFixed(1)," KB"):"".concat((e/1048576).toFixed(1)," MB"),ed=e=>new Date(e).toLocaleDateString("ko-KR",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),ec=X.filter(e=>e.completed).length,eu=e=>e.startsWith("image/")?"\uD83D\uDDBC️":e.includes("pdf")?"\uD83D\uDCC4":e.includes("word")||e.includes("document")?"\uD83D\uDCDD":e.includes("sheet")||e.includes("excel")?"\uD83D\uDCCA":e.startsWith("video/")?"\uD83C\uDFAC":e.startsWith("audio/")?"\uD83C\uDFB5":"\uD83D\uDCCE";return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed inset-0 z-40",onClick:w}),(0,n.jsxs)("div",{className:"fixed top-14 md:top-0 right-0 bottom-0 w-full md:w-[380px] z-50 flex flex-col bg-background-card border-l border-border shadow-2xl animate-slide-in-right overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between px-5 pt-5 pb-4 border-b border-border flex-shrink-0",children:[(0,n.jsxs)("div",{className:"flex-1 pr-3",children:[(0,n.jsx)("p",{className:"text-[10px] text-text-muted uppercase tracking-wider font-semibold mb-1",children:"할일 상세"}),(0,n.jsx)("textarea",{value:E,onChange:e=>q(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),e.currentTarget.blur())},rows:2,placeholder:"할일 제목...",className:"w-full bg-transparent text-base font-bold text-text-primary leading-snug resize-none focus:outline-none border-b border-transparent hover:border-border focus:border-[#e94560]/50 transition-colors placeholder-text-muted"})]}),(0,n.jsx)("button",{onClick:w,className:"w-8 h-8 flex items-center justify-center rounded-lg text-text-muted hover:text-text-primary hover:bg-border transition-colors flex-shrink-0 mt-5",children:(0,n.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:(0,n.jsx)("path",{d:"M1 1L13 13M13 1L1 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,n.jsxs)("div",{className:"px-5 py-4 border-b border-border space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("span",{className:"text-text-muted text-xs w-16 flex-shrink-0",children:"중요도"}),(0,n.jsx)("div",{className:"flex gap-1.5",children:c.map(e=>(0,n.jsx)("button",{onClick:()=>k({priority:e.value}),className:"px-2.5 py-1 rounded-lg text-[11px] font-semibold transition-all border",style:N.priority===e.value?{borderColor:e.color,color:e.color,backgroundColor:"".concat(e.color,"20")}:{borderColor:"transparent",color:"var(--color-text-inactive)"},children:e.label},e.value))})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("span",{className:"text-text-muted text-xs w-16 flex-shrink-0",children:"마감일"}),(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[(0,n.jsx)("input",{type:"date",value:null!==(f=N.dueDate)&&void 0!==f?f:"",onChange:e=>k({dueDate:e.target.value||null}),className:"flex-1 px-3 py-1.5 bg-background border border-border rounded-lg text-xs text-text-primary focus:outline-none focus:border-[#e94560] transition-colors"}),N.dueDate&&(0,n.jsx)("button",{onClick:()=>k({dueDate:null}),className:"text-text-muted hover:text-[#e94560] text-sm transition-colors",title:"마감일 제거",children:"\xd7"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("span",{className:"text-text-muted text-xs w-16 flex-shrink-0",children:"등록일"}),(0,n.jsx)("div",{className:"flex items-center gap-2 flex-1",children:(0,n.jsx)("input",{type:"date",value:null!==(h=N.createdDate)&&void 0!==h?h:N.createdAt&&"function"==typeof N.createdAt.toDate?(()=>{let e=N.createdAt.toDate();return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(e.getDate()).padStart(2,"0"))})():"",onChange:e=>k({createdDate:e.target.value||null}),className:"flex-1 px-3 py-1.5 bg-background border border-border rounded-lg text-xs text-text-primary focus:outline-none focus:border-[#e94560] transition-colors"})})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("span",{className:"text-text-muted text-xs w-16 flex-shrink-0",children:"알림"}),(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[(0,n.jsx)("input",{type:"datetime-local",value:null!==(b=N.reminder)&&void 0!==b?b:"",onChange:async e=>{let t=e.target.value;t&&await (0,l.e)(),k({reminder:t||null})},className:"flex-1 px-3 py-1.5 bg-background border border-border rounded-lg text-xs text-text-primary focus:outline-none focus:border-[#e94560] transition-colors"}),N.reminder&&(0,n.jsx)("button",{onClick:()=>k({reminder:null}),className:"text-text-muted hover:text-[#e94560] text-sm transition-colors",title:"알림 제거",children:"\xd7"})]})]}),N.reminder&&"Notification"in window&&"denied"===Notification.permission&&(0,n.jsxs)("p",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[(0,n.jsx)("span",{children:"⚠️"}),(0,n.jsx)("span",{children:"브라우저 알림이 차단되어 있습니다. 브라우저 설정에서 허용해 주세요."})]})]}),(0,n.jsxs)("div",{className:"px-5 py-4 border-b border-border",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,n.jsx)("span",{className:"text-sm",children:"\uD83D\uDCCB"}),(0,n.jsx)("span",{className:"text-xs font-bold text-text-primary",children:"하위 할일"}),X.length>0&&(0,n.jsxs)("span",{className:"text-[10px] text-text-muted",children:[ec,"/",X.length]})]}),X.length>0&&(0,n.jsx)("div",{className:"h-1 bg-border rounded-full overflow-hidden mb-3",children:(0,n.jsx)("div",{className:"h-full bg-gradient-to-r from-[#e94560] to-[#8b5cf6] rounded-full transition-all duration-300",style:{width:"".concat(ec/X.length*100,"%")}})}),(0,n.jsx)("div",{className:"space-y-1 mb-3",children:X.map(e=>(0,n.jsxs)("div",{className:"flex items-center gap-2.5 group py-1 px-2 -mx-2 rounded-lg hover:bg-border/30 transition-colors",children:[(0,n.jsx)("button",{onClick:()=>V(e.id),className:"w-4 h-4 rounded border-2 flex items-center justify-center transition-all flex-shrink-0 ".concat(e.completed?"bg-gradient-to-br from-[#e94560] to-[#8b5cf6] border-transparent":"hover:border-[#e94560]"),style:e.completed?void 0:{borderColor:"var(--color-checkbox-border)"},children:e.completed&&(0,n.jsx)("svg",{width:"8",height:"8",viewBox:"0 0 14 14",fill:"none",children:(0,n.jsx)("path",{d:"M3 7L6 10L11 4",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),B===e.id?(0,n.jsx)("input",{ref:A,value:I,onChange:e=>_(e.target.value),onBlur:()=>G(e.id),onKeyDown:t=>{"Enter"===t.key&&G(e.id),"Escape"===t.key&&L(null)},className:"flex-1 text-xs text-text-primary bg-background border border-[#e94560]/50 rounded px-1.5 py-0.5 focus:outline-none"}):(0,n.jsx)("span",{onClick:()=>Z(e),className:"flex-1 text-xs cursor-text ".concat(e.completed?"line-through text-text-inactive":"text-text-primary hover:text-[#e94560]"),title:"클릭하여 수정",children:e.title}),(0,n.jsx)("button",{onClick:()=>Y(e.id),className:"opacity-0 group-hover:opacity-100 w-5 h-5 flex items-center justify-center text-text-muted hover:text-[#e94560] transition-all text-sm",children:"\xd7"})]},e.id))}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-4 h-4 rounded border-2 border-dashed border-border flex-shrink-0"}),(0,n.jsx)("input",{ref:K,type:"text",value:T,onChange:e=>z(e.target.value),onKeyDown:e=>{"Enter"===e.key&&Q(),"Escape"===e.key&&z("")},placeholder:"하위 할일 추가...",className:"flex-1 bg-transparent text-xs text-text-primary placeholder-text-inactive outline-none"}),T.trim()&&(0,n.jsx)("button",{onClick:Q,className:"text-[10px] px-2 py-0.5 bg-[#e94560] text-white rounded font-semibold",children:"추가"})]})]}),(0,n.jsxs)("div",{className:"px-5 py-4 border-b border-border",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,n.jsx)("span",{className:"text-sm",children:"\uD83D\uDCDD"}),(0,n.jsx)("span",{className:"text-xs font-bold text-text-primary",children:"메모"})]}),(0,n.jsx)("textarea",{value:M,onChange:e=>$(e.target.value),placeholder:"메모를 입력하세요...",rows:4,className:"w-full bg-background border border-border rounded-lg px-3 py-2.5 text-xs text-text-primary placeholder-text-inactive resize-none focus:outline-none focus:border-[#e94560] transition-colors leading-relaxed"})]}),(0,n.jsxs)("div",{className:"px-5 py-4 border-b border-border",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-sm",children:"\uD83D\uDCCE"}),(0,n.jsx)("span",{className:"text-xs font-bold text-text-primary",children:"파일 첨부"}),ee.length>0&&(0,n.jsxs)("span",{className:"text-[10px] text-text-muted",children:[ee.length,"개"]})]}),(0,n.jsx)("button",{onClick:()=>{var e;return null===(e=H.current)||void 0===e?void 0:e.click()},className:"text-[10px] px-2.5 py-1 border border-border rounded-lg text-text-secondary hover:border-[#e94560] hover:text-[#e94560] transition-colors font-semibold",children:"+ 파일 추가"}),(0,n.jsx)("input",{ref:H,type:"file",multiple:!0,onChange:ea,className:"hidden"})]}),(0,n.jsx)("p",{className:"text-[10px] text-text-muted mb-3",children:"최대 10 MB \xb7 클릭하면 열기/다운로드"}),et&&en.length>0&&(0,n.jsx)("div",{className:"mb-3 space-y-2",children:en.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("p",{className:"text-[10px] text-text-secondary truncate mb-1",children:e.name}),(0,n.jsx)("div",{className:"w-full h-1.5 bg-border rounded-full overflow-hidden",children:(0,n.jsx)("div",{className:"h-full bg-gradient-to-r from-[#e94560] to-[#533483] rounded-full transition-all duration-300",style:{width:"".concat(e.percent,"%")}})})]}),(0,n.jsxs)("span",{className:"text-[10px] text-text-muted flex-shrink-0 w-8 text-right",children:[e.percent,"%"]})]},t))}),0!==ee.length||et?(0,n.jsx)("div",{className:"space-y-1.5",children:ee.map(e=>(0,n.jsxs)("div",{onClick:()=>ei(e),className:"flex items-center gap-2.5 p-2 bg-background rounded-lg border border-border group transition-colors cursor-pointer hover:border-[#e94560]/40",children:[(0,n.jsx)("span",{className:"text-lg flex-shrink-0",children:eu(e.type)}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("p",{className:"text-xs text-text-primary truncate font-medium",children:e.name}),(0,n.jsxs)("p",{className:"text-[10px] text-text-muted",children:[el(e.size)," \xb7 ",ed(e.addedAt)]})]}),(0,n.jsx)("button",{onClick:t=>{t.stopPropagation(),es(e)},className:"opacity-0 group-hover:opacity-100 w-6 h-6 flex items-center justify-center text-text-muted hover:text-[#e94560] transition-all flex-shrink-0",children:"\xd7"})]},e.id))}):(0,n.jsx)("button",{onClick:()=>{var e;return null===(e=H.current)||void 0===e?void 0:e.click()},className:"w-full py-4 border-2 border-dashed border-border rounded-lg text-center text-text-inactive text-xs hover:border-[#e94560]/40 hover:text-text-muted transition-colors",children:"파일을 클릭하여 첨부"})]}),(0,n.jsxs)("div",{className:"px-5 py-4 border-b border-border",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,n.jsx)("span",{className:"text-sm",children:"⚙️"}),(0,n.jsx)("span",{className:"text-xs font-bold text-text-primary",children:"상태"})]}),(0,n.jsx)("div",{className:"flex gap-2",children:["todo","in_progress","completed"].map(e=>{let t={todo:"#64748b",in_progress:"#f59e0b",completed:"#22c55e"},r=N.status===e;return(0,n.jsx)("button",{onClick:()=>k({status:e}),className:"flex-1 py-1.5 rounded-lg text-[11px] font-semibold border transition-all",style:r?{borderColor:t[e],color:t[e],backgroundColor:"".concat(t[e],"20")}:{borderColor:"transparent",color:"var(--color-text-inactive)"},children:{todo:"할 일",in_progress:"진행 중",completed:"완료"}[e]},e)})})]}),(0,n.jsxs)("div",{className:"px-5 py-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-sm",children:"\uD83D\uDCDD"}),(0,n.jsx)("span",{className:"text-xs font-bold text-text-primary",children:"연결된 노트"}),(null!==(v=null===(t=N.linkedNoteIds)||void 0===t?void 0:t.length)&&void 0!==v?v:0)>0&&(0,n.jsxs)("span",{className:"text-[10px] text-text-muted",children:[N.linkedNoteIds.length,"개"]})]}),(0,n.jsx)("button",{onClick:()=>J(!W),className:"text-[10px] px-2.5 py-1 border border-border rounded-lg text-text-secondary hover:border-[#e94560] hover:text-[#e94560] transition-colors font-semibold",children:"+ 노트 연결"})]}),(null!==(g=N.linkedNoteIds)&&void 0!==g?g:[]).length>0&&(0,n.jsx)("div",{className:"space-y-1.5 mb-3",children:(null!==(j=N.linkedNoteIds)&&void 0!==j?j:[]).map(e=>{let t=F.find(t=>t.id===e);return t?(0,n.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-background rounded-lg border border-border group hover:border-[#8b5cf6]/40 transition-colors",children:[(0,n.jsxs)("button",{onClick:()=>{w(),S.push("/notes?note=".concat(e))},className:"flex items-center gap-2 flex-1 min-w-0 text-left hover:opacity-80 transition-opacity",title:"노트로 이동",children:[(0,n.jsx)("span",{className:"text-base flex-shrink-0",children:t.icon||"\uD83D\uDCDD"}),(0,n.jsx)("span",{className:"text-xs text-text-primary truncate",children:t.title}),(0,n.jsx)("span",{className:"text-[9px] text-[#8b5cf6] flex-shrink-0 opacity-0 group-hover:opacity-100",children:"↗"})]}),(0,n.jsx)("button",{onClick:t=>{var r;t.stopPropagation(),k({linkedNoteIds:(null!==(r=N.linkedNoteIds)&&void 0!==r?r:[]).filter(t=>t!==e)})},className:"opacity-0 group-hover:opacity-100 w-5 h-5 flex items-center justify-center text-text-muted hover:text-[#e94560] transition-all text-sm flex-shrink-0",children:"\xd7"})]},e):null})}),W&&(0,n.jsxs)("div",{className:"border border-border rounded-lg bg-background overflow-hidden max-h-40 overflow-y-auto",children:[F.filter(e=>{var t;return!(null!==(t=N.linkedNoteIds)&&void 0!==t?t:[]).includes(e.id)}).map(e=>(0,n.jsxs)("button",{onClick:()=>{var t;k({linkedNoteIds:[...null!==(t=N.linkedNoteIds)&&void 0!==t?t:[],e.id]}),J(!1)},className:"w-full flex items-center gap-2 px-3 py-2 text-left hover:bg-background-hover transition-colors",children:[(0,n.jsx)("span",{className:"text-sm",children:e.icon||"\uD83D\uDCDD"}),(0,n.jsx)("span",{className:"text-xs text-text-primary truncate",children:e.title})]},e.id)),0===F.filter(e=>{var t;return!(null!==(t=N.linkedNoteIds)&&void 0!==t?t:[]).includes(e.id)}).length&&(0,n.jsx)("p",{className:"text-xs text-text-muted text-center py-3",children:"연결 가능한 노트가 없습니다"})]}),"completed"===N.status&&(null!==(y=null===(r=N.linkedNoteIds)||void 0===r?void 0:r.length)&&void 0!==y?y:0)>0&&(0,n.jsxs)("p",{className:"text-[10px] text-amber-400 mt-2 flex items-center gap-1",children:[(0,n.jsx)("span",{children:"⚠️"}),(0,n.jsx)("span",{children:"완료된 할일의 노트 연결은 자동으로 해제됩니다"})]})]})]}),(0,n.jsx)("div",{className:"px-5 py-4 border-t border-border flex-shrink-0",children:(0,n.jsx)("button",{onClick:()=>{confirm("이 할일을 삭제할까요?")&&(D(),w())},className:"w-full py-2.5 rounded-xl border border-[#e94560]/30 text-[#e94560] text-sm font-semibold hover:bg-[#e94560]/10 transition-colors",children:"할일 삭제"})})]})]})}},354:function(e,t,r){r.d(t,{FV:function(){return m},Qs:function(){return x},TH:function(){return d},dU:function(){return i},mB:function(){return a},nd:function(){return l},pD:function(){return s}});var n=r(7955),o=r(1579);let a=10485760;async function s(e,t,r,a,s){let i="users/".concat(e,"/tasks/").concat(t,"/").concat(a,"/").concat(r.name),l=(0,n.iH)(o.tO,i),d=(0,n.B0)(l,r);return new Promise((e,t)=>{d.on("state_changed",e=>{let t=Math.round(e.bytesTransferred/e.totalBytes*100);null==s||s(t)},e=>t(e),async()=>{e({downloadURL:await (0,n.Jt)(d.snapshot.ref),storagePath:i})})})}async function i(e){try{await (0,n.oq)((0,n.iH)(o.tO,e))}catch(e){}}async function l(e){await Promise.all(e.map(e=>e.storagePath?i(e.storagePath):Promise.resolve()))}function d(e,t,r){if(["image/","video/","audio/","application/pdf","text/"].some(e=>r.startsWith(e))){if(!window.open(e,"_blank")){let r=document.createElement("a");r.href=e,r.download=t,r.target="_blank",document.body.appendChild(r),r.click(),document.body.removeChild(r)}}else{let r=document.createElement("a");r.href=e,r.download=t,r.target="_blank",document.body.appendChild(r),r.click(),document.body.removeChild(r)}}let c="attachments";function u(){return new Promise((e,t)=>{let r=indexedDB.open("ai-todo-files",1);r.onupgradeneeded=()=>{r.result.createObjectStore(c)},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)})}async function x(e,t,r){var n,o;let a=await u(),s=await new Promise((t,r)=>{let n=a.transaction(c,"readonly").objectStore(c).get(e);n.onsuccess=()=>{var e;return t(null!==(e=n.result)&&void 0!==e?e:null)},n.onerror=()=>r(n.error)});if(!s){alert("파일을 찾을 수 없습니다.\n(다른 기기에서 추가된 파일이거나 브라우저 데이터가 삭제되었을 수 있습니다)");return}let i=s.name||t,l=s.type||r||({jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",bmp:"image/bmp",svg:"image/svg+xml",ico:"image/x-icon",avif:"image/avif",mp4:"video/mp4",webm:"video/webm",mov:"video/quicktime",avi:"video/x-msvideo",mkv:"video/x-matroska",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",flac:"audio/flac",aac:"audio/aac",m4a:"audio/mp4",pdf:"application/pdf",txt:"text/plain",md:"text/markdown",csv:"text/csv",html:"text/html",xml:"text/xml",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",doc:"application/msword",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xls:"application/vnd.ms-excel",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",ppt:"application/vnd.ms-powerpoint",zip:"application/zip","7z":"application/x-7z-compressed",rar:"application/vnd.rar",tar:"application/x-tar",gz:"application/gzip",json:"application/json",js:"text/javascript",ts:"text/typescript",py:"text/x-python",java:"text/x-java-source",c:"text/x-csrc",cpp:"text/x-c++src"})[null!==(o=null===(n=i.split(".").pop())||void 0===n?void 0:n.toLowerCase())&&void 0!==o?o:""]||"application/octet-stream",d=new Blob([s.blob],{type:l}),x=URL.createObjectURL(d);if(["image/","video/","audio/","application/pdf","text/"].some(e=>l.startsWith(e))){if(!window.open(x,"_blank")){let e=document.createElement("a");e.href=x,e.download=i,document.body.appendChild(e),e.click(),document.body.removeChild(e)}}else{let e=document.createElement("a");e.href=x,e.download=i,document.body.appendChild(e),e.click(),document.body.removeChild(e)}setTimeout(()=>URL.revokeObjectURL(x),15e3)}async function m(e){if(!e.length)return;let t=await u();return new Promise((r,n)=>{let o=t.transaction(c,"readwrite"),a=o.objectStore(c);e.forEach(e=>a.delete(e)),o.oncomplete=()=>r(),o.onerror=()=>n(o.error)})}},1730:function(e,t,r){r.d(t,{P:function(){return c},a:function(){return u}});var n=r(6717),o=r(7387),a=r(7253),s=r(1579),i=r(1097);let l=(0,o.createContext)({tasks:[],lists:[],notes:[],folders:[],mindmaps:[],loading:!0,storageUsed:0});function d(e){return new Blob([e]).size}function c(e){let{children:t}=e,{user:r,loading:c}=(0,i.a)(),[u,x]=(0,o.useState)([]),[m,p]=(0,o.useState)([]),[f,h]=(0,o.useState)([]),[b,v]=(0,o.useState)([]),[g,j]=(0,o.useState)([]),[y,N]=(0,o.useState)(!0),w=(0,o.useRef)([]);(0,o.useEffect)(()=>{if(c)return;if(w.current.forEach(e=>e()),w.current=[],!r){x([]),p([]),h([]),v([]),j([]),N(!1);return}N(!0);let e=r.uid,t=0,n=()=>{++t>=5&&N(!1)},o=(0,a.cf)((0,a.IO)((0,a.hJ)(s.db,"users",e,"tasks"),(0,a.Xo)("createdAt","desc")),e=>{x(e.docs.map(e=>({id:e.id,...e.data()}))),n()},()=>n()),i=(0,a.cf)((0,a.hJ)(s.db,"users",e,"lists"),e=>{p(e.docs.map(e=>({id:e.id,...e.data()}))),n()},()=>n()),l=(0,a.cf)((0,a.IO)((0,a.hJ)(s.db,"users",e,"notes"),(0,a.Xo)("createdAt","desc")),e=>{h(e.docs.map(e=>({id:e.id,...e.data()}))),n()},()=>n()),d=(0,a.cf)((0,a.hJ)(s.db,"users",e,"folders"),e=>{v(e.docs.map(e=>({id:e.id,...e.data()}))),n()},()=>n()),u=(0,a.cf)((0,a.IO)((0,a.hJ)(s.db,"users",e,"mindmaps"),(0,a.Xo)("createdAt","desc")),e=>{j(e.docs.map(e=>({id:e.id,...e.data()}))),n()},()=>n());return w.current=[o,i,l,d,u],()=>{w.current.forEach(e=>e()),w.current=[]}},[r,c]);let k=function(e,t,r){var n,o,a,s;let i=0;for(let t of e){for(let e of(i+=d(t.title||"")+d(t.memo||""),null!==(n=t.subTasks)&&void 0!==n?n:[]))i+=d(e.title||"");for(let e of null!==(o=t.attachments)&&void 0!==o?o:[])i+=e.size}for(let e of t)for(let t of(i+=d(e.title||""),null!==(a=e.blocks)&&void 0!==a?a:[]))i+=d(t.content||"")+d(t.children||"");for(let e of r)for(let t of(i+=d(e.title||""),null!==(s=e.nodes)&&void 0!==s?s:[]))i+=d(t.text||""),t.imageSize&&(i+=t.imageSize);return i}(u,f,g);return(0,n.jsx)(l.Provider,{value:{tasks:u,lists:m,notes:f,folders:b,mindmaps:g,loading:y,storageUsed:k},children:t})}function u(){return(0,o.useContext)(l)}},2423:function(e,t,r){r.d(t,{D:function(){return o},e:function(){return a}});var n=r(7387);function o(e){let t=(0,n.useRef)(new Map);(0,n.useEffect)(()=>{if(!("Notification"in window)||"granted"!==Notification.permission)return;t.current.forEach(clearTimeout),t.current.clear();let r=Date.now();for(let n of e){if(!n.reminder||!n.id)continue;let e=new Date(n.reminder).getTime()-r;if(e<=0||e>2147483647)continue;let o=setTimeout(()=>{try{new Notification("⏰ ".concat(n.title),{body:n.memo||"알림 시간이 되었습니다.",tag:"task-".concat(n.id)})}catch(e){console.warn("Notification 오류:",e)}t.current.delete(n.id)},e);t.current.set(n.id,o)}return()=>{t.current.forEach(clearTimeout),t.current.clear()}},[e])}async function a(){return"Notification"in window&&("granted"===Notification.permission||"denied"!==Notification.permission&&"granted"===await Notification.requestPermission())}},8519:function(e,t,r){var n=r(5878);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})}}]);