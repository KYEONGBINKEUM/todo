(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[90],{4537:function(e,t,n){Promise.resolve().then(n.bind(n,370))},370:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var o=n(6717),i=n(7387),r=n(1097),a=n(9936),s=n(6813),l=n(7955),d=n(1579),c=n(354),u=n(1730);let m=["#e94560","#8b5cf6","#06b6d4","#22c55e","#f59e0b","#ec4899"];function x(){let{user:e}=(0,r.a)(),{t}=(0,a.QT)(),{mindmaps:n,loading:x}=(0,u.a)(),h=(0,i.useRef)(!1),[p,f]=(0,i.useState)([]),[g,v]=(0,i.useState)(""),[b,w]=(0,i.useState)(""),[y,j]=(0,i.useState)(0),[N,k]=(0,i.useState)(0),[D,S]=(0,i.useState)(1),[C,P]=(0,i.useState)(new Set),[z,M]=(0,i.useState)(null),[E,X]=(0,i.useState)(null),[Y,T]=(0,i.useState)({x:0,y:0}),[L,R]=(0,i.useState)(null),[I,O]=(0,i.useState)(!1),[B,U]=(0,i.useState)({x:0,y:0}),[_,H]=(0,i.useState)("curved"),[A,q]=(0,i.useState)(null),[F,J]=(0,i.useState)({x:0,y:0}),W=(0,i.useRef)(null),[K,Q]=(0,i.useState)(null),G=(0,i.useRef)({startX:0,startY:0,lastDist:0,isPan:!1,isNodeDrag:!1,nodeId:null,offsetX:0,offsetY:0,moved:!1,longPressTimer:null}),V=(0,i.useRef)(null),Z=(0,i.useRef)(null),$=1===C.size?[...C][0]:null;(0,i.useEffect)(()=>{if(x||h.current)return;h.current=!0;let e=n.map(e=>{var t,n,o,i,r,a,s;return{id:e.id,title:e.title,nodes:e.nodes||[],edges:e.edges||[],viewportX:null!==(i=e.viewportX)&&void 0!==i?i:0,viewportY:null!==(r=e.viewportY)&&void 0!==r?r:0,zoom:null!==(a=e.zoom)&&void 0!==a?a:1,starred:null!==(s=e.starred)&&void 0!==s&&s,createdAt:(null===(o=e.createdAt)||void 0===o?void 0:null===(n=o.toDate)||void 0===n?void 0:null===(t=n.call(o))||void 0===t?void 0:t.toISOString())||new Date().toISOString()}});f(e),e.length>0&&v(e[0].id)},[x]);let ee=p.find(e=>e.id===g);(0,i.useEffect)(()=>{ee&&(j(ee.viewportX),k(ee.viewportY),S(ee.zoom||1))},[g]);let et=(0,i.useCallback)(async t=>{if(e)try{await (0,s.mb)(e.uid,t.id,{title:t.title,nodes:t.nodes,edges:t.edges,viewportX:t.viewportX,viewportY:t.viewportY,zoom:t.zoom})}catch(e){console.error("Failed to save mindmap:",e)}},[e]),en=(0,i.useCallback)(e=>{Z.current&&clearTimeout(Z.current),Z.current=setTimeout(()=>et(e),500)},[et]),eo=e=>{f(t=>{let n=t.map(t=>t.id===g?e(t):t),o=n.find(e=>e.id===g);return o&&en(o),n})},ei=async()=>{let t=Date.now().toString(),n={id:t,title:"새 마인드맵",nodes:[{id:"root",text:"중심 아이디어",x:400,y:300,width:180,height:70,color:m[0]}],edges:[],viewportX:0,viewportY:0,zoom:1,starred:!1,createdAt:new Date().toISOString()};if(f(e=>[n,...e]),v(t),e)try{let o=await (0,s.GE)(e.uid,{title:n.title,nodes:n.nodes,edges:n.edges,viewportX:0,viewportY:0,zoom:1});f(e=>e.map(e=>e.id===t?{...e,id:o}:e)),v(o)}catch(e){console.error("Failed to create mindmap:",e)}},er=async t=>{if(!confirm("이 마인드맵을 삭제하시겠습니까?"))return;let n=p.find(e=>e.id===t);if(n){for(let e of n.nodes)if(e.imagePath)try{await (0,l.oq)((0,l.iH)(d.tO,e.imagePath))}catch(e){}}if(f(e=>e.filter(e=>e.id!==t)),g===t){var o;v((null===(o=p.filter(e=>e.id!==t)[0])||void 0===o?void 0:o.id)||"")}if(e)try{await (0,s.ZY)(e.uid,t)}catch(e){console.error(e)}},ea=async t=>{if(f(e=>e.map(e=>e.id===t?{...e,starred:!e.starred}:e)),e){let n=p.find(e=>e.id===t);if(n)try{await (0,s.mb)(e.uid,t,{starred:!n.starred})}catch(e){}}},es=e=>{eo(t=>({...t,title:e}))},el=async e=>{if(!ee)return;let t=ee.nodes.find(t=>t.id===e);if(null==t?void 0:t.imagePath)try{await (0,l.oq)((0,l.iH)(d.tO,t.imagePath))}catch(e){}eo(t=>({...t,nodes:t.nodes.filter(t=>t.id!==e),edges:t.edges.filter(t=>t.from!==e&&t.to!==e)})),P(t=>{let n=new Set(t);return n.delete(e),n})},ed=async()=>{if(ee&&0!==C.size){for(let e of C){let t=ee.nodes.find(t=>t.id===e);if(null==t?void 0:t.imagePath)try{await (0,l.oq)((0,l.iH)(d.tO,t.imagePath))}catch(e){}}eo(e=>({...e,nodes:e.nodes.filter(e=>!C.has(e.id)),edges:e.edges.filter(e=>!C.has(e.from)&&!C.has(e.to))})),P(new Set)}},ec=(e,t)=>{eo(n=>({...n,nodes:n.nodes.map(n=>n.id===e?{...n,text:t}:n)}))},eu=(e,t)=>{eo(n=>({...n,nodes:n.nodes.map(n=>n.id===e?{...n,color:t}:n)}))},em=async(t,n)=>{if(e&&ee){if(n.size>c.mB){alert("이미지는 10MB 이하만 가능합니다.");return}Q(t);try{let o="users/".concat(e.uid,"/mindmaps/").concat(ee.id,"/").concat(t,"/").concat(n.name),i=(0,l.iH)(d.tO,o),r=(0,l.B0)(i,n);await new Promise((e,i)=>{r.on("state_changed",null,i,async()=>{let i=await (0,l.Jt)(r.snapshot.ref);eo(e=>({...e,nodes:e.nodes.map(e=>e.id===t?{...e,imageURL:i,imagePath:o,imageSize:n.size}:e)})),e()})})}catch(e){console.error("Image upload failed:",e)}Q(null)}},ex=async e=>{if(!ee)return;let t=ee.nodes.find(t=>t.id===e);if(null==t?void 0:t.imagePath)try{await (0,l.oq)((0,l.iH)(d.tO,t.imagePath))}catch(e){}eo(t=>({...t,nodes:t.nodes.map(t=>t.id===e?{...t,imageURL:void 0,imagePath:void 0,imageSize:void 0}:t)}))},eh=(e,t)=>{if(!ee||ee.edges.some(n=>n.from===e&&n.to===t||n.from===t&&n.to===e))return;let n={id:"e-".concat(Date.now()),from:e,to:t,style:_,color:"#888"};eo(e=>({...e,edges:[...e.edges,n]}))},ep=e=>{eo(t=>({...t,edges:t.edges.filter(t=>t.id!==e)})),M(null)},ef=(e,t)=>{let n=e.x+e.width/2,o=e.y+e.height/2;switch(t){case"top":return{x:n,y:e.y};case"right":return{x:e.x+e.width,y:o};case"bottom":return{x:n,y:e.y+e.height};case"left":return{x:e.x,y:o};default:return{x:n,y:o}}},eg=(e,t,n)=>{let o=e.x+e.width/2,i=e.y+e.height/2,r=t-o,a=n-i;return Math.abs(r)>Math.abs(a)?r>0?"right":"left":a>0?"bottom":"top"},ev=(e,t,n)=>{let o=eg(e,t.x+t.width/2,t.y+t.height/2),i=eg(t,e.x+e.width/2,e.y+e.height/2),r=ef(e,o),a=ef(t,i);if("straight"===n)return"M ".concat(r.x," ").concat(r.y," L ").concat(a.x," ").concat(a.y);let s=a.x-r.x,l=a.y-r.y,d=Math.min(.4*Math.sqrt(s*s+l*l),120),c={top:[0,-1],right:[1,0],bottom:[0,1],left:[-1,0]}[o]||[0,0],u={top:[0,-1],right:[1,0],bottom:[0,1],left:[-1,0]}[i]||[0,0],m=r.x+c[0]*d,x=r.y+c[1]*d,h=a.x+u[0]*d,p=a.y+u[1]*d;return"M ".concat(r.x," ").concat(r.y," C ").concat(m," ").concat(x,", ").concat(h," ").concat(p,", ").concat(a.x," ").concat(a.y)},eb=()=>{if(I&&(O(!1),eo(e=>({...e,viewportX:y,viewportY:N}))),E){X(null);let e=p.find(e=>e.id===g);e&&en(e)}A&&q(null)},ew=(e,t)=>{var n;if(e.stopPropagation(),A)return;if(e.ctrlKey||e.metaKey){P(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n});return}C.has(t)||P(new Set([t])),M(null);let o=null===(n=V.current)||void 0===n?void 0:n.getBoundingClientRect(),i=null==ee?void 0:ee.nodes.find(e=>e.id===t);i&&o&&(X(t),T({x:(e.clientX-o.left-y)/D-i.x,y:(e.clientY-o.top-N)/D-i.y}))},ey=e=>{A&&A.nodeId!==e&&(eh(A.nodeId,e),q(null))},ej=(e,t,n)=>{e.stopPropagation(),e.preventDefault(),q({nodeId:t,side:n})};(0,i.useEffect)(()=>{let e=e=>{L||(("Delete"===e.key||"Backspace"===e.key)&&(z?ep(z):C.size>0&&ed()),"Escape"===e.key&&(P(new Set),M(null),R(null),q(null)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)});let eN=b?p.filter(e=>e.title.toLowerCase().includes(b.toLowerCase())):p;return x?(0,o.jsx)("div",{className:"p-8 flex items-center justify-center min-h-[50vh]",children:(0,o.jsx)("div",{className:"w-6 h-6 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin"})}):(0,o.jsxs)("div",{className:"flex h-full",children:[(0,o.jsxs)("div",{className:"".concat(ee?"hidden md:flex":"flex"," w-full md:w-72 flex-col border-r border-border bg-background"),children:[(0,o.jsxs)("div",{className:"p-4 border-b border-border",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,o.jsxs)("h2",{className:"text-lg font-bold text-text-primary",children:["\uD83E\uDDE0 ",t("nav.mindmap")]}),(0,o.jsx)("button",{onClick:ei,className:"px-3 py-1.5 bg-gradient-to-r from-[#e94560] to-[#533483] text-white text-xs font-bold rounded-lg hover:opacity-90 transition-opacity",children:"+ 새로 만들기"})]}),(0,o.jsx)("input",{type:"text",value:b,onChange:e=>w(e.target.value),placeholder:"마인드맵 검색...",className:"w-full px-3 py-2 bg-background-card border border-border rounded-lg text-sm text-text-primary placeholder-text-muted focus:outline-none focus:border-[#e94560]"})]}),(0,o.jsxs)("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:[eN.map(e=>(0,o.jsxs)("div",{className:"group flex items-center gap-2 px-3 py-2.5 rounded-lg cursor-pointer transition-all ".concat(e.id===g?"bg-[#e94560]/10 text-[#e94560]":"text-text-secondary hover:bg-background-card hover:text-text-primary"),onClick:()=>v(e.id),children:[(0,o.jsx)("span",{className:"text-base flex-shrink-0",children:"\uD83E\uDDE0"}),(0,o.jsx)("span",{className:"flex-1 text-sm font-medium truncate",children:e.title||"제목 없음"}),(0,o.jsx)("span",{className:"text-[10px] text-text-muted flex-shrink-0",children:e.nodes.length}),(0,o.jsxs)("div",{className:"opacity-0 group-hover:opacity-100 flex gap-0.5 flex-shrink-0",children:[(0,o.jsx)("button",{onClick:t=>{t.stopPropagation(),ea(e.id)},className:"text-[10px] transition-all ".concat(e.starred?"text-amber-400 !opacity-100":"text-text-muted hover:text-amber-400"),children:e.starred?"★":"☆"}),(0,o.jsx)("button",{onClick:t=>{t.stopPropagation(),er(e.id)},className:"text-text-inactive hover:text-[#e94560] transition-all text-sm",children:"\xd7"})]})]},e.id)),0===eN.length&&(0,o.jsxs)("div",{className:"text-center py-12 text-text-muted",children:[(0,o.jsx)("p",{className:"text-4xl mb-3",children:"\uD83E\uDDE0"}),(0,o.jsx)("p",{className:"text-sm",children:"마인드맵이 없습니다"}),(0,o.jsx)("p",{className:"text-[11px] text-text-inactive mt-1",children:"새로 만들기 버튼을 눌러 시작하세요"})]})]})]}),ee?(0,o.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between px-3 md:px-4 py-2 border-b border-border bg-background/80 flex-shrink-0 gap-2",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,o.jsx)("button",{onClick:()=>v(""),className:"md:hidden flex items-center text-text-secondary hover:text-text-primary mr-1 flex-shrink-0",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:(0,o.jsx)("path",{d:"M10 3L5 8L10 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,o.jsx)("input",{value:ee.title,onChange:e=>es(e.target.value),className:"bg-transparent text-sm font-bold text-text-primary outline-none w-28 md:w-40 min-w-0",placeholder:"마인드맵 제목..."})]}),(0,o.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,o.jsxs)("button",{onClick:()=>{var e;if(!ee)return;let t=null===(e=V.current)||void 0===e?void 0:e.getBoundingClientRect(),n=t?(t.width/2-y)/D:400,o=t?(t.height/2-N)/D:300,i={id:"n-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,5)),text:"",x:n-90+(Math.random()-.5)*100,y:o-35+(Math.random()-.5)*100,width:180,height:70,color:m[ee.nodes.length%m.length]};eo(e=>({...e,nodes:[...e.nodes,i]})),P(new Set([i.id])),R(i.id)},title:"노드 추가",className:"h-7 px-2 md:px-2.5 flex items-center gap-1 bg-[#e94560]/10 text-[#e94560] rounded-lg text-[11px] font-semibold hover:bg-[#e94560]/20 transition-colors",children:[(0,o.jsx)("span",{className:"md:hidden",children:"+"}),(0,o.jsx)("span",{className:"hidden md:inline",children:"+ 노드"})]}),(0,o.jsx)("div",{className:"w-px h-4 bg-border mx-0.5 hidden md:block"}),(0,o.jsx)("button",{onClick:()=>H("curved"===_?"straight":"curved"),title:"curved"===_?"직선으로 전환":"곡선으로 전환",className:"hidden md:flex h-7 px-2 items-center gap-1 text-text-muted hover:text-text-primary rounded-lg text-[11px] hover:bg-border transition-colors",children:"curved"===_?"〰️ 곡선":"\uD83D\uDCCF 직선"}),(0,o.jsx)("div",{className:"w-px h-4 bg-border mx-0.5 hidden md:block"}),(0,o.jsx)("button",{onClick:()=>{let e=Math.min(2.5,1.2*D);S(e),eo(t=>({...t,zoom:e}))},className:"w-7 h-7 flex items-center justify-center text-text-muted hover:text-text-primary hover:bg-border rounded transition-colors text-xs",title:"확대",children:"+"}),(0,o.jsxs)("span",{className:"text-[10px] text-text-muted w-8 md:w-10 text-center",children:[Math.round(100*D),"%"]}),(0,o.jsx)("button",{onClick:()=>{let e=Math.max(.25,.8*D);S(e),eo(t=>({...t,zoom:e}))},className:"w-7 h-7 flex items-center justify-center text-text-muted hover:text-text-primary hover:bg-border rounded transition-colors text-xs",title:"축소",children:"−"}),(0,o.jsx)("button",{onClick:()=>{j(0),k(0),S(1),eo(e=>({...e,viewportX:0,viewportY:0,zoom:1}))},className:"hidden md:flex h-7 px-2 text-[10px] text-text-muted hover:text-text-primary hover:bg-border rounded transition-colors items-center",title:"뷰 초기화",children:"초기화"}),C.size>=2&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"w-px h-4 bg-border mx-0.5"}),(0,o.jsxs)("button",{onClick:()=>{if(!ee||C.size<2)return;let e=[...C];for(let t=0;t<e.length-1;t++){let n=e[t],o=e[t+1];if(!ee.edges.some(e=>e.from===n&&e.to===o||e.from===o&&e.to===n)){let e={id:"e-".concat(Date.now(),"-").concat(t),from:n,to:o,style:_,color:"#888"};eo(t=>({...t,edges:[...t.edges,e]}))}}},className:"h-7 px-2 md:px-2.5 flex items-center gap-1 bg-[#8b5cf6]/10 text-[#8b5cf6] rounded-lg text-[11px] font-semibold hover:bg-[#8b5cf6]/20 transition-colors",title:"선택된 노드 연결",children:[(0,o.jsx)("span",{className:"hidden md:inline",children:"\uD83D\uDD17 연결"}),(0,o.jsx)("span",{className:"md:hidden",children:"\uD83D\uDD17"})]}),(0,o.jsxs)("button",{onClick:ed,className:"h-7 px-2 md:px-2.5 flex items-center gap-1 text-[#e94560] hover:bg-[#e94560]/10 rounded-lg text-[11px] font-semibold transition-colors",title:"선택된 노드 삭제",children:[(0,o.jsx)("span",{className:"hidden md:inline",children:"\uD83D\uDDD1 삭제"}),(0,o.jsx)("span",{className:"md:hidden",children:"\uD83D\uDDD1"})]})]}),1===C.size&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"w-px h-4 bg-border mx-0.5"}),(0,o.jsxs)("button",{onClick:()=>{$&&el($)},className:"h-7 px-2 md:px-2.5 flex items-center gap-1 text-[#e94560] hover:bg-[#e94560]/10 rounded-lg text-[11px] font-semibold transition-colors",children:[(0,o.jsx)("span",{className:"hidden md:inline",children:"\uD83D\uDDD1 삭제"}),(0,o.jsx)("span",{className:"md:hidden",children:"\uD83D\uDDD1"})]})]}),z&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"w-px h-4 bg-border mx-0.5"}),(0,o.jsx)("button",{onClick:()=>ep(z),className:"h-7 px-2 md:px-2.5 flex items-center gap-1 text-[#e94560] hover:bg-[#e94560]/10 rounded-lg text-[11px] font-semibold transition-colors",children:"\uD83D\uDDD1"})]})]})]}),(0,o.jsxs)("div",{ref:V,className:"flex-1 overflow-hidden relative cursor-grab active:cursor-grabbing",onMouseDown:e=>{(e.target===V.current||e.target.classList.contains("canvas-bg"))&&(P(new Set),M(null),R(null),O(!0),U({x:e.clientX-y,y:e.clientY-N}))},onMouseMove:e=>{var t;let n=null===(t=V.current)||void 0===t?void 0:t.getBoundingClientRect();if(n&&J({x:(e.clientX-n.left-y)/D,y:(e.clientY-n.top-N)/D}),I){j(e.clientX-B.x),k(e.clientY-B.y);return}if(E){let t=(e.clientX-((null==n?void 0:n.left)||0)-y)/D-Y.x,o=(e.clientY-((null==n?void 0:n.top)||0)-N)/D-Y.y;f(e=>e.map(e=>e.id===g?{...e,nodes:e.nodes.map(e=>e.id===E?{...e,x:t,y:o}:e)}:e))}},onMouseUp:eb,onMouseLeave:eb,onWheel:e=>{e.preventDefault();let t=e.deltaY>0?.92:1.08;S(e=>{let n=Math.max(.25,Math.min(2.5,e*t));return eo(e=>({...e,zoom:n})),n})},onTouchStart:e=>{let t=G.current;if(t.longPressTimer&&(clearTimeout(t.longPressTimer),t.longPressTimer=null),2===e.touches.length){let n=e.touches[0].clientX-e.touches[1].clientX,o=e.touches[0].clientY-e.touches[1].clientY;t.lastDist=Math.sqrt(n*n+o*o),t.isPan=!1,t.isNodeDrag=!1;return}let n=e.touches[0];t.startX=n.clientX,t.startY=n.clientY,t.moved=!1;let o=e.target.closest("[data-node-id]");if(o){var i;let e=o.getAttribute("data-node-id"),r=null===(i=V.current)||void 0===i?void 0:i.getBoundingClientRect(),a=null==ee?void 0:ee.nodes.find(t=>t.id===e);a&&r&&(t.isNodeDrag=!0,t.nodeId=e,t.offsetX=(n.clientX-r.left-y)/D-a.x,t.offsetY=(n.clientY-r.top-N)/D-a.y,C.has(e)||P(new Set([e])),M(null),t.longPressTimer=setTimeout(()=>{P(t=>{let n=new Set(t);return n.has(e)&&n.size>1?n.delete(e):n.add(e),n}),t.isNodeDrag=!1},500));return}t.isPan=!0,t.isNodeDrag=!1,U({x:n.clientX-y,y:n.clientY-N})},onTouchMove:e=>{let t=G.current;if(t.longPressTimer&&(clearTimeout(t.longPressTimer),t.longPressTimer=null),2===e.touches.length){let n=e.touches[0].clientX-e.touches[1].clientX,o=e.touches[0].clientY-e.touches[1].clientY,i=Math.sqrt(n*n+o*o);if(t.lastDist>0){let e=i/t.lastDist;S(t=>{let n=Math.max(.25,Math.min(2.5,t*e));return eo(e=>({...e,zoom:n})),n})}t.lastDist=i;return}let n=e.touches[0],o=n.clientX-t.startX,i=n.clientY-t.startY;if((Math.abs(o)>5||Math.abs(i)>5)&&(t.moved=!0),t.isNodeDrag&&t.nodeId){var r;e.preventDefault();let o=null===(r=V.current)||void 0===r?void 0:r.getBoundingClientRect();if(!o)return;let i=(n.clientX-o.left-y)/D-t.offsetX,a=(n.clientY-o.top-N)/D-t.offsetY;f(e=>e.map(e=>e.id===g?{...e,nodes:e.nodes.map(e=>e.id===t.nodeId?{...e,x:i,y:a}:e)}:e));return}t.isPan&&(j(n.clientX-B.x),k(n.clientY-B.y))},onTouchEnd:e=>{let t=G.current;if(t.longPressTimer&&(clearTimeout(t.longPressTimer),t.longPressTimer=null),t.isPan&&(t.isPan=!1,eo(e=>({...e,viewportX:y,viewportY:N}))),t.isNodeDrag&&t.nodeId){if(t.moved){let e=p.find(e=>e.id===g);e&&en(e)}else P(new Set([t.nodeId]));t.isNodeDrag=!1,t.nodeId=null}if(!t.moved&&!t.isNodeDrag&&!t.isPan){let t=e.target;(t===V.current||t.classList.contains("canvas-bg"))&&(P(new Set),M(null),R(null))}t.lastDist=0},style:{touchAction:"none"},children:[(0,o.jsx)("div",{className:"canvas-bg absolute inset-0",style:{backgroundImage:"radial-gradient(circle, var(--color-border) 1px, transparent 1px)",backgroundSize:"".concat(24*D,"px ").concat(24*D,"px"),backgroundPosition:"".concat(y,"px ").concat(N,"px")}}),(0,o.jsxs)("div",{style:{transform:"translate(".concat(y,"px, ").concat(N,"px) scale(").concat(D,")"),transformOrigin:"0 0",position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:[(0,o.jsxs)("svg",{style:{position:"absolute",top:0,left:0,width:"10000px",height:"10000px",pointerEvents:"none",overflow:"visible"},children:[ee.edges.map(e=>{let t=ee.nodes.find(t=>t.id===e.from),n=ee.nodes.find(t=>t.id===e.to);if(!t||!n)return null;let i=ev(t,n,e.style);return(0,o.jsxs)("g",{children:[(0,o.jsx)("path",{d:i,fill:"none",stroke:"transparent",strokeWidth:"16",style:{pointerEvents:"stroke",cursor:"pointer"},onClick:t=>{t.stopPropagation(),M(e.id),P(new Set)}}),(0,o.jsx)("path",{d:i,fill:"none",stroke:z===e.id?"#e94560":e.color||"#888",strokeWidth:z===e.id?3:2,strokeLinecap:"round",style:{pointerEvents:"none"}}),(()=>{let i=eg(n,t.x+t.width/2,t.y+t.height/2),r=ef(n,i);return(0,o.jsx)("polygon",{points:"-6,-4 0,0 -6,4",fill:z===e.id?"#e94560":e.color||"#888",transform:"translate(".concat(r.x,",").concat(r.y,") rotate(").concat({top:90,right:180,bottom:270,left:0}[i]||0,")"),style:{pointerEvents:"none"}})})()]},e.id)}),A&&(()=>{let e=ee.nodes.find(e=>e.id===A.nodeId);if(!e)return null;let t=ef(e,A.side);return(0,o.jsx)("path",{d:"M ".concat(t.x," ").concat(t.y," L ").concat(F.x," ").concat(F.y),fill:"none",stroke:"#e94560",strokeWidth:"2",strokeDasharray:"6 4",style:{pointerEvents:"none"}})})()]}),ee.nodes.map(e=>{let t=C.has(e.id),n=L===e.id;return(0,o.jsx)("div",{"data-node-id":e.id,style:{position:"absolute",left:"".concat(e.x,"px"),top:"".concat(e.y,"px"),width:"".concat(e.width,"px"),minHeight:"".concat(e.height,"px"),zIndex:t?100:10},className:"rounded-xl shadow-lg transition-shadow ".concat(t?"ring-2 ring-[#e94560] shadow-xl":"hover:shadow-xl"),onMouseDown:t=>ew(t,e.id),onMouseUp:()=>ey(e.id),onDoubleClick:()=>{R(e.id),P(new Set([e.id]))},children:(0,o.jsxs)("div",{className:"w-full h-full rounded-xl p-3 relative",style:{backgroundColor:e.color,minHeight:"".concat(e.height,"px")},children:[(t||A)&&["top","right","bottom","left"].map(t=>{let n={top:{left:"50%",top:"-5px",transform:"translateX(-50%)"},right:{right:"-5px",top:"50%",transform:"translateY(-50%)"},bottom:{left:"50%",bottom:"-5px",transform:"translateX(-50%)"},left:{left:"-5px",top:"50%",transform:"translateY(-50%)"}}[t];return(0,o.jsx)("div",{className:"absolute w-[10px] h-[10px] bg-white border-2 border-[#888] rounded-full cursor-crosshair hover:border-[#e94560] hover:scale-125 transition-all z-50",style:n,onMouseDown:n=>ej(n,e.id,t)},t)}),t&&1===C.size&&!n&&(0,o.jsxs)("div",{className:"absolute -top-8 left-0 flex gap-1 z-50",children:[m.map(t=>(0,o.jsx)("button",{onClick:n=>{n.stopPropagation(),eu(e.id,t)},className:"w-5 h-5 rounded-full border-2 border-white/50 hover:scale-110 transition-transform shadow-sm",style:{backgroundColor:t}},t)),(0,o.jsx)("button",{onClick:t=>{var n,o;t.stopPropagation(),null===(n=W.current)||void 0===n||n.setAttribute("data-node-id",e.id),null===(o=W.current)||void 0===o||o.click()},className:"w-5 h-5 rounded-full bg-white/90 flex items-center justify-center text-[10px] hover:scale-110 transition-transform shadow-sm",title:"이미지 추가",children:"\uD83D\uDCF7"}),(0,o.jsx)("button",{onClick:t=>{t.stopPropagation(),el(e.id)},className:"w-5 h-5 rounded-full bg-white/90 flex items-center justify-center text-[10px] hover:scale-110 transition-transform shadow-sm text-[#e94560]",title:"삭제",children:"\xd7"})]}),e.imageURL&&(0,o.jsxs)("div",{className:"mb-2 relative group/img",children:[(0,o.jsx)("img",{src:e.imageURL,alt:"",className:"w-full rounded-lg object-cover max-h-32",draggable:!1}),t&&(0,o.jsx)("button",{onClick:t=>{t.stopPropagation(),ex(e.id)},className:"absolute top-1 right-1 w-5 h-5 bg-black/50 text-white rounded-full text-xs flex items-center justify-center hover:bg-black/70",children:"\xd7"})]}),K===e.id&&(0,o.jsxs)("div",{className:"mb-2 flex items-center gap-2 text-white/80 text-xs",children:[(0,o.jsx)("div",{className:"w-4 h-4 border-2 border-white/50 border-t-white rounded-full animate-spin"}),"업로드 중..."]}),n?(0,o.jsx)("textarea",{value:e.text,onChange:t=>ec(e.id,t.target.value),onBlur:()=>R(null),onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),onKeyDown:e=>{"Escape"===e.key&&R(null)},autoFocus:!0,className:"w-full bg-transparent text-white outline-none resize-none text-sm placeholder-white/50",placeholder:"아이디어를 입력하세요...",rows:Math.max(2,e.text.split("\n").length),style:{cursor:"text"}}):(0,o.jsx)("div",{className:"text-white text-sm whitespace-pre-wrap break-words select-none",style:{minHeight:"24px",cursor:"move"},children:e.text||(0,o.jsx)("span",{className:"opacity-50",children:"더블클릭하여 편집"})})]})},e.id)})]}),C.size>=2&&(0,o.jsxs)("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 bg-[#8b5cf6] text-white px-3 py-1.5 rounded-full text-xs font-semibold shadow-lg z-50",children:[C.size,"개 선택됨"]}),A&&(0,o.jsxs)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-background-card border border-border px-4 py-2 rounded-full text-xs text-text-muted shadow-lg z-50",children:["다른 노드에 드롭하여 연결 \xb7 ",(0,o.jsx)("span",{className:"text-text-inactive",children:"Esc로 취소"})]}),(0,o.jsx)("div",{className:"absolute bottom-3 right-3 md:hidden text-[9px] text-text-inactive bg-background/80 px-2 py-1 rounded-full",children:"길게 눌러 다중선택"}),(0,o.jsx)("input",{ref:W,type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t,n;let o=null===(t=e.target.files)||void 0===t?void 0:t[0],i=null===(n=W.current)||void 0===n?void 0:n.getAttribute("data-node-id");o&&i&&em(i,o),e.target.value=""}})]})]}):(0,o.jsx)("div",{className:"flex-1 hidden md:flex items-center justify-center",children:(0,o.jsxs)("div",{className:"text-center text-text-muted",children:[(0,o.jsx)("p",{className:"text-6xl mb-4",children:"\uD83E\uDDE0"}),(0,o.jsx)("p",{className:"text-lg font-bold mb-2",children:"마인드맵"}),(0,o.jsx)("p",{className:"text-sm text-text-inactive mb-6",children:"아이디어를 시각적으로 정리하고 연결하세요"}),(0,o.jsx)("button",{onClick:ei,className:"px-6 py-2.5 bg-gradient-to-r from-[#e94560] to-[#533483] text-white text-sm font-bold rounded-xl hover:opacity-90 transition-opacity",children:"+ 새 마인드맵 만들기"})]})})]})}function h(){return(0,o.jsx)(i.Suspense,{fallback:(0,o.jsx)("div",{className:"p-8 flex items-center justify-center min-h-[50vh]",children:(0,o.jsx)("div",{className:"w-6 h-6 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin"})}),children:(0,o.jsx)(x,{})})}},354:function(e,t,n){"use strict";n.d(t,{FV:function(){return x},Qs:function(){return m},TH:function(){return d},dU:function(){return s},mB:function(){return r},nd:function(){return l},pD:function(){return a}});var o=n(7955),i=n(1579);let r=10485760;async function a(e,t,n,r,a){let s="users/".concat(e,"/tasks/").concat(t,"/").concat(r,"/").concat(n.name),l=(0,o.iH)(i.tO,s),d=(0,o.B0)(l,n);return new Promise((e,t)=>{d.on("state_changed",e=>{let t=Math.round(e.bytesTransferred/e.totalBytes*100);null==a||a(t)},e=>t(e),async()=>{e({downloadURL:await (0,o.Jt)(d.snapshot.ref),storagePath:s})})})}async function s(e){try{await (0,o.oq)((0,o.iH)(i.tO,e))}catch(e){}}async function l(e){await Promise.all(e.map(e=>e.storagePath?s(e.storagePath):Promise.resolve()))}function d(e,t,n){if(["image/","video/","audio/","application/pdf","text/"].some(e=>n.startsWith(e))){if(!window.open(e,"_blank")){let n=document.createElement("a");n.href=e,n.download=t,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}else{let n=document.createElement("a");n.href=e,n.download=t,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}let c="attachments";function u(){return new Promise((e,t)=>{let n=indexedDB.open("ai-todo-files",1);n.onupgradeneeded=()=>{n.result.createObjectStore(c)},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)})}async function m(e,t,n){var o,i;let r=await u(),a=await new Promise((t,n)=>{let o=r.transaction(c,"readonly").objectStore(c).get(e);o.onsuccess=()=>{var e;return t(null!==(e=o.result)&&void 0!==e?e:null)},o.onerror=()=>n(o.error)});if(!a){alert("파일을 찾을 수 없습니다.\n(다른 기기에서 추가된 파일이거나 브라우저 데이터가 삭제되었을 수 있습니다)");return}let s=a.name||t,l=a.type||n||({jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",bmp:"image/bmp",svg:"image/svg+xml",ico:"image/x-icon",avif:"image/avif",mp4:"video/mp4",webm:"video/webm",mov:"video/quicktime",avi:"video/x-msvideo",mkv:"video/x-matroska",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",flac:"audio/flac",aac:"audio/aac",m4a:"audio/mp4",pdf:"application/pdf",txt:"text/plain",md:"text/markdown",csv:"text/csv",html:"text/html",xml:"text/xml",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",doc:"application/msword",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xls:"application/vnd.ms-excel",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",ppt:"application/vnd.ms-powerpoint",zip:"application/zip","7z":"application/x-7z-compressed",rar:"application/vnd.rar",tar:"application/x-tar",gz:"application/gzip",json:"application/json",js:"text/javascript",ts:"text/typescript",py:"text/x-python",java:"text/x-java-source",c:"text/x-csrc",cpp:"text/x-c++src"})[null!==(i=null===(o=s.split(".").pop())||void 0===o?void 0:o.toLowerCase())&&void 0!==i?i:""]||"application/octet-stream",d=new Blob([a.blob],{type:l}),m=URL.createObjectURL(d);if(["image/","video/","audio/","application/pdf","text/"].some(e=>l.startsWith(e))){if(!window.open(m,"_blank")){let e=document.createElement("a");e.href=m,e.download=s,document.body.appendChild(e),e.click(),document.body.removeChild(e)}}else{let e=document.createElement("a");e.href=m,e.download=s,document.body.appendChild(e),e.click(),document.body.removeChild(e)}setTimeout(()=>URL.revokeObjectURL(m),15e3)}async function x(e){if(!e.length)return;let t=await u();return new Promise((n,o)=>{let i=t.transaction(c,"readwrite"),r=i.objectStore(c);e.forEach(e=>r.delete(e)),i.oncomplete=()=>n(),i.onerror=()=>o(i.error)})}},1730:function(e,t,n){"use strict";n.d(t,{P:function(){return c},a:function(){return u}});var o=n(6717),i=n(7387),r=n(7253),a=n(1579),s=n(1097);let l=(0,i.createContext)({tasks:[],lists:[],notes:[],folders:[],mindmaps:[],loading:!0,storageUsed:0});function d(e){return new Blob([e]).size}function c(e){let{children:t}=e,{user:n,loading:c}=(0,s.a)(),[u,m]=(0,i.useState)([]),[x,h]=(0,i.useState)([]),[p,f]=(0,i.useState)([]),[g,v]=(0,i.useState)([]),[b,w]=(0,i.useState)([]),[y,j]=(0,i.useState)(!0),N=(0,i.useRef)([]);(0,i.useEffect)(()=>{if(c)return;if(N.current.forEach(e=>e()),N.current=[],!n){m([]),h([]),f([]),v([]),w([]),j(!1);return}j(!0);let e=n.uid,t=0,o=()=>{++t>=5&&j(!1)},i=(0,r.cf)((0,r.IO)((0,r.hJ)(a.db,"users",e,"tasks"),(0,r.Xo)("createdAt","desc")),e=>{m(e.docs.map(e=>({id:e.id,...e.data()}))),o()},()=>o()),s=(0,r.cf)((0,r.hJ)(a.db,"users",e,"lists"),e=>{h(e.docs.map(e=>({id:e.id,...e.data()}))),o()},()=>o()),l=(0,r.cf)((0,r.IO)((0,r.hJ)(a.db,"users",e,"notes"),(0,r.Xo)("createdAt","desc")),e=>{f(e.docs.map(e=>({id:e.id,...e.data()}))),o()},()=>o()),d=(0,r.cf)((0,r.hJ)(a.db,"users",e,"folders"),e=>{v(e.docs.map(e=>({id:e.id,...e.data()}))),o()},()=>o()),u=(0,r.cf)((0,r.IO)((0,r.hJ)(a.db,"users",e,"mindmaps"),(0,r.Xo)("createdAt","desc")),e=>{w(e.docs.map(e=>({id:e.id,...e.data()}))),o()},()=>o());return N.current=[i,s,l,d,u],()=>{N.current.forEach(e=>e()),N.current=[]}},[n,c]);let k=function(e,t,n){var o,i,r,a;let s=0;for(let t of e){for(let e of(s+=d(t.title||"")+d(t.memo||""),null!==(o=t.subTasks)&&void 0!==o?o:[]))s+=d(e.title||"");for(let e of null!==(i=t.attachments)&&void 0!==i?i:[])s+=e.size}for(let e of t)for(let t of(s+=d(e.title||""),null!==(r=e.blocks)&&void 0!==r?r:[]))s+=d(t.content||"")+d(t.children||"");for(let e of n)for(let t of(s+=d(e.title||""),null!==(a=e.nodes)&&void 0!==a?a:[]))s+=d(t.text||""),t.imageSize&&(s+=t.imageSize);return s}(u,p,b);return(0,o.jsx)(l.Provider,{value:{tasks:u,lists:x,notes:p,folders:g,mindmaps:b,loading:y,storageUsed:k},children:t})}function u(){return(0,i.useContext)(l)}}},function(e){e.O(0,[815,419,412,936,407,809,744],function(){return e(e.s=4537)}),_N_E=e.O()}]);