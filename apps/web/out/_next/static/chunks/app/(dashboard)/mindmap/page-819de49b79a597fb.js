(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[90],{4537:function(e,t,n){Promise.resolve().then(n.bind(n,370))},370:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var r=n(6717),o=n(7387),i=n(1097),s=n(9936),a=n(6813),l=n(7955),d=n(1579),c=n(354),u=n(1730);let m=["#e94560","#8b5cf6","#06b6d4","#22c55e","#f59e0b","#ec4899"];function x(){let{user:e}=(0,i.a)(),{t}=(0,s.QT)(),{mindmaps:n,loading:x}=(0,u.a)(),p=(0,o.useRef)(!1),[h,f]=(0,o.useState)([]),[g,v]=(0,o.useState)(""),[b,w]=(0,o.useState)(""),y=(0,o.useRef)({x:0,y:0,zoom:1}),[,j]=(0,o.useState)(0),k=()=>j(e=>e+1),N=(0,o.useRef)({mode:"none",startX:0,startY:0,offsetX:0,offsetY:0,nodeId:null,moved:!1}),[D,z]=(0,o.useState)(new Set),[C,S]=(0,o.useState)(null),[P,E]=(0,o.useState)(null),[M,L]=(0,o.useState)("curved"),[X,Y]=(0,o.useState)(null),[R,T]=(0,o.useState)({x:0,y:0}),O=(0,o.useRef)(null),[B,I]=(0,o.useState)(null),U=(0,o.useRef)({lastDist:0,longPressTimer:null}),_=(0,o.useRef)(new Map),H=(0,o.useRef)(!1),A=(0,o.useRef)(null),q=(0,o.useRef)(null),F=(0,o.useRef)(h);F.current=h;let K=1===D.size?[...D][0]:null,W=h.find(e=>e.id===g),J=(0,o.useRef)(W);J.current=W;let Z=(0,o.useRef)(D);Z.current=D;let Q=(0,o.useRef)(g);Q.current=g;let G=y.current,V=e=>(_.current.has(e)||_.current.set(e,{past:[],future:[]}),_.current.get(e)),$=(e,t)=>{if(H.current)return;let n=V(e);n.past.push(t),n.past.length>50&&n.past.shift(),n.future=[]},ee=!!g&&V(g).past.length>0,et=!!g&&V(g).future.length>0,en=()=>{if(!W||!ee)return;let e=V(g),t=e.past.pop();e.future.push({nodes:[...W.nodes],edges:[...W.edges]}),H.current=!0,es(e=>({...e,nodes:t.nodes,edges:t.edges})),H.current=!1},er=()=>{if(!W||!et)return;let e=V(g),t=e.future.pop();e.past.push({nodes:[...W.nodes],edges:[...W.edges]}),H.current=!0,es(e=>({...e,nodes:t.nodes,edges:t.edges})),H.current=!1};(0,o.useEffect)(()=>{if(x||p.current)return;p.current=!0;let e=n.map(e=>{var t,n,r,o,i,s,a;return{id:e.id,title:e.title,nodes:e.nodes||[],edges:e.edges||[],viewportX:null!==(o=e.viewportX)&&void 0!==o?o:0,viewportY:null!==(i=e.viewportY)&&void 0!==i?i:0,zoom:null!==(s=e.zoom)&&void 0!==s?s:1,starred:null!==(a=e.starred)&&void 0!==a&&a,createdAt:(null===(r=e.createdAt)||void 0===r?void 0:null===(n=r.toDate)||void 0===n?void 0:null===(t=n.call(r))||void 0===t?void 0:t.toISOString())||new Date().toISOString()}});f(e),e.length>0&&v(e[0].id)},[x]),(0,o.useEffect)(()=>{W&&(y.current={x:W.viewportX,y:W.viewportY,zoom:W.zoom||1},k())},[g]);let eo=(0,o.useCallback)(async t=>{if(e)try{await (0,a.mb)(e.uid,t.id,{title:t.title,nodes:t.nodes,edges:t.edges,viewportX:t.viewportX,viewportY:t.viewportY,zoom:t.zoom})}catch(e){console.error("Failed to save mindmap:",e)}},[e]),ei=(0,o.useCallback)(e=>{q.current&&clearTimeout(q.current),q.current=setTimeout(()=>eo(e),500)},[eo]),es=e=>{f(t=>{let n=t.map(t=>t.id===Q.current?e(t):t),r=n.find(e=>e.id===Q.current);return r&&ei(r),n})},ea=e=>{let t=F.current.find(e=>e.id===Q.current);t&&$(Q.current,{nodes:[...t.nodes],edges:[...t.edges]}),es(e)},el=async()=>{let t=Date.now().toString(),n={id:t,title:"새 마인드맵",nodes:[{id:"root",text:"중심 아이디어",x:400,y:300,width:180,height:70,color:m[0]}],edges:[],viewportX:0,viewportY:0,zoom:1,starred:!1,createdAt:new Date().toISOString()};if(f(e=>[n,...e]),v(t),e)try{let r=await (0,a.GE)(e.uid,{title:n.title,nodes:n.nodes,edges:n.edges,viewportX:0,viewportY:0,zoom:1});f(e=>e.map(e=>e.id===t?{...e,id:r}:e)),v(r)}catch(e){console.error("Failed to create mindmap:",e)}},ed=async t=>{if(!confirm("이 마인드맵을 삭제하시겠습니까?"))return;let n=h.find(e=>e.id===t);if(n){for(let e of n.nodes)if(e.imagePath)try{await (0,l.oq)((0,l.iH)(d.tO,e.imagePath))}catch(e){}}if(f(e=>e.filter(e=>e.id!==t)),g===t){var r;v((null===(r=h.filter(e=>e.id!==t)[0])||void 0===r?void 0:r.id)||"")}if(e)try{await (0,a.ZY)(e.uid,t)}catch(e){console.error(e)}},ec=async t=>{if(f(e=>e.map(e=>e.id===t?{...e,starred:!e.starred}:e)),e){let n=h.find(e=>e.id===t);if(n)try{await (0,a.mb)(e.uid,t,{starred:!n.starred})}catch(e){}}},eu=e=>{es(t=>({...t,title:e}))},em=async e=>{if(!J.current)return;let t=J.current.nodes.find(t=>t.id===e);if(null==t?void 0:t.imagePath)try{await (0,l.oq)((0,l.iH)(d.tO,t.imagePath))}catch(e){}ea(t=>({...t,nodes:t.nodes.filter(t=>t.id!==e),edges:t.edges.filter(t=>t.from!==e&&t.to!==e)})),z(t=>{let n=new Set(t);return n.delete(e),n})},ex=async()=>{let e=J.current,t=Z.current;if(e&&0!==t.size){for(let n of t){let t=e.nodes.find(e=>e.id===n);if(null==t?void 0:t.imagePath)try{await (0,l.oq)((0,l.iH)(d.tO,t.imagePath))}catch(e){}}ea(e=>({...e,nodes:e.nodes.filter(e=>!t.has(e.id)),edges:e.edges.filter(e=>!t.has(e.from)&&!t.has(e.to))})),z(new Set)}},ep=(e,t)=>{es(n=>({...n,nodes:n.nodes.map(n=>n.id===e?{...n,text:t}:n)}))},eh=(e,t)=>{ea(n=>({...n,nodes:n.nodes.map(n=>n.id===e?{...n,color:t}:n)}))},ef=async(t,n)=>{if(e&&J.current){if(n.size>c.mB){alert("이미지는 10MB 이하만 가능합니다.");return}I(t);try{let r=Q.current,o="users/".concat(e.uid,"/mindmaps/").concat(r,"/").concat(t,"/").concat(n.name),i=(0,l.iH)(d.tO,o),s=(0,l.B0)(i,n);await new Promise((e,r)=>{s.on("state_changed",null,r,async()=>{let r=await (0,l.Jt)(s.snapshot.ref);ea(e=>({...e,nodes:e.nodes.map(e=>e.id===t?{...e,imageURL:r,imagePath:o,imageSize:n.size}:e)})),e()})})}catch(e){console.error("Image upload failed:",e)}I(null)}},eg=async e=>{if(!J.current)return;let t=J.current.nodes.find(t=>t.id===e);if(null==t?void 0:t.imagePath)try{await (0,l.oq)((0,l.iH)(d.tO,t.imagePath))}catch(e){}ea(t=>({...t,nodes:t.nodes.map(t=>t.id===e?{...t,imageURL:void 0,imagePath:void 0,imageSize:void 0}:t)}))},ev=(e,t)=>{let n=J.current;if(!n||n.edges.some(n=>n.from===e&&n.to===t||n.from===t&&n.to===e))return;let r={id:"e-".concat(Date.now()),from:e,to:t,style:M,color:"#888"};ea(e=>({...e,edges:[...e.edges,r]}))},eb=e=>{ea(t=>({...t,edges:t.edges.filter(t=>t.id!==e)})),S(null)},ew=(e,t)=>{let n=e.x+e.width/2,r=e.y+e.height/2;switch(t){case"top":return{x:n,y:e.y};case"right":return{x:e.x+e.width,y:r};case"bottom":return{x:n,y:e.y+e.height};case"left":return{x:e.x,y:r};default:return{x:n,y:r}}},ey=(e,t,n)=>{let r=e.x+e.width/2,o=e.y+e.height/2,i=t-r,s=n-o;return Math.abs(i)>Math.abs(s)?i>0?"right":"left":s>0?"bottom":"top"},ej=(e,t,n)=>{let r=ey(e,t.x+t.width/2,t.y+t.height/2),o=ey(t,e.x+e.width/2,e.y+e.height/2),i=ew(e,r),s=ew(t,o);if("straight"===n)return"M ".concat(i.x," ").concat(i.y," L ").concat(s.x," ").concat(s.y);let a=s.x-i.x,l=s.y-i.y,d=Math.min(.4*Math.sqrt(a*a+l*l),120),c={top:[0,-1],right:[1,0],bottom:[0,1],left:[-1,0]}[r]||[0,0],u={top:[0,-1],right:[1,0],bottom:[0,1],left:[-1,0]}[o]||[0,0];return"M ".concat(i.x," ").concat(i.y," C ").concat(i.x+c[0]*d," ").concat(i.y+c[1]*d,", ").concat(s.x+u[0]*d," ").concat(s.y+u[1]*d,", ").concat(s.x," ").concat(s.y)},ek=(e,t)=>{let n=N.current;n.mode="pan",n.startX=e-G.x,n.startY=t-G.y,n.moved=!1},eN=(e,t,n)=>{var r,o;let i=N.current,s=null===(r=A.current)||void 0===r?void 0:r.getBoundingClientRect(),a=null===(o=J.current)||void 0===o?void 0:o.nodes.find(e=>e.id===n);if(!a||!s)return;i.mode="node",i.nodeId=n,i.offsetX=(e-s.left-G.x)/G.zoom-a.x,i.offsetY=(t-s.top-G.y)/G.zoom-a.y,i.moved=!1;let l=J.current;l&&$(Q.current,{nodes:[...l.nodes],edges:[...l.edges]})},eD=(0,o.useCallback)((e,t)=>{let n=N.current;if("pan"===n.mode){y.current.x=e-n.startX,y.current.y=t-n.startY,n.moved=!0,k();return}if("node"===n.mode&&n.nodeId){var r;let o=null===(r=A.current)||void 0===r?void 0:r.getBoundingClientRect();if(!o)return;let i=(e-o.left-y.current.x)/y.current.zoom-n.offsetX,s=(t-o.top-y.current.y)/y.current.zoom-n.offsetY;n.moved=!0,f(e=>e.map(e=>e.id===Q.current?{...e,nodes:e.nodes.map(e=>e.id===n.nodeId?{...e,x:i,y:s}:e)}:e))}},[]),ez=(0,o.useCallback)(()=>{let e=N.current;if("pan"===e.mode){let{x:e,y:t}=y.current;es(n=>({...n,viewportX:e,viewportY:t}))}if("node"===e.mode&&e.nodeId){if(e.moved){let e=F.current.find(e=>e.id===Q.current);e&&ei(e)}else{let e=V(Q.current);e.past.length>0&&e.past.pop()}}e.mode="none",e.nodeId=null},[ei]);(0,o.useEffect)(()=>{let e=e=>{var t;"none"!==N.current.mode&&eD(e.clientX,e.clientY);let n=null===(t=A.current)||void 0===t?void 0:t.getBoundingClientRect();n&&T({x:(e.clientX-n.left-y.current.x)/y.current.zoom,y:(e.clientY-n.top-y.current.y)/y.current.zoom})},t=()=>{"none"!==N.current.mode&&ez()};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[eD,ez]);let eC=(e,t)=>{if(e.stopPropagation(),!X){if(e.ctrlKey||e.metaKey){z(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n});return}Z.current.has(t)||z(new Set([t])),S(null),eN(e.clientX,e.clientY,t)}},eS=e=>{X&&X.nodeId!==e&&(ev(X.nodeId,e),Y(null))},eP=(e,t,n)=>{e.stopPropagation(),e.preventDefault(),Y({nodeId:t,side:n})};(0,o.useEffect)(()=>{let e=e=>{!P&&(("Delete"===e.key||"Backspace"===e.key)&&(C?eb(C):Z.current.size>0&&ex()),"Escape"===e.key&&(z(new Set),S(null),E(null),Y(null)),(e.ctrlKey||e.metaKey)&&"z"===e.key&&!e.shiftKey&&(e.preventDefault(),en()),(e.ctrlKey||e.metaKey)&&("Z"===e.key||"z"===e.key&&e.shiftKey)&&(e.preventDefault(),er()))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)});let eE=b?h.filter(e=>e.title.toLowerCase().includes(b.toLowerCase())):h;return x?(0,r.jsx)("div",{className:"p-8 flex items-center justify-center min-h-[50vh]",children:(0,r.jsx)("div",{className:"w-6 h-6 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin"})}):(0,r.jsxs)("div",{className:"flex h-full",children:[(0,r.jsxs)("div",{className:"".concat(W?"hidden md:flex":"flex"," w-full md:w-72 flex-col border-r border-border bg-background"),children:[(0,r.jsxs)("div",{className:"p-4 border-b border-border",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("h2",{className:"text-lg font-bold text-text-primary",children:["\uD83E\uDDE0 ",t("nav.mindmap")]}),(0,r.jsx)("button",{onClick:el,className:"px-3 py-1.5 bg-gradient-to-r from-[#e94560] to-[#533483] text-white text-xs font-bold rounded-lg hover:opacity-90 transition-opacity",children:"+ 새로 만들기"})]}),(0,r.jsx)("input",{type:"text",value:b,onChange:e=>w(e.target.value),placeholder:"마인드맵 검색...",className:"w-full px-3 py-2 bg-background-card border border-border rounded-lg text-sm text-text-primary placeholder-text-muted focus:outline-none focus:border-[#e94560]"})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:[eE.map(e=>(0,r.jsxs)("div",{className:"group flex items-center gap-2 px-3 py-2.5 rounded-lg cursor-pointer transition-all ".concat(e.id===g?"bg-[#e94560]/10 text-[#e94560]":"text-text-secondary hover:bg-background-card hover:text-text-primary"),onClick:()=>v(e.id),children:[(0,r.jsx)("span",{className:"text-base flex-shrink-0",children:"\uD83E\uDDE0"}),(0,r.jsx)("span",{className:"flex-1 text-sm font-medium truncate",children:e.title||"제목 없음"}),(0,r.jsx)("span",{className:"text-[10px] text-text-muted flex-shrink-0",children:e.nodes.length}),(0,r.jsxs)("div",{className:"opacity-0 group-hover:opacity-100 flex gap-0.5 flex-shrink-0",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),ec(e.id)},className:"text-[10px] transition-all ".concat(e.starred?"text-amber-400 !opacity-100":"text-text-muted hover:text-amber-400"),children:e.starred?"★":"☆"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),ed(e.id)},className:"text-text-inactive hover:text-[#e94560] transition-all text-sm",children:"\xd7"})]})]},e.id)),0===eE.length&&(0,r.jsxs)("div",{className:"text-center py-12 text-text-muted",children:[(0,r.jsx)("p",{className:"text-4xl mb-3",children:"\uD83E\uDDE0"}),(0,r.jsx)("p",{className:"text-sm",children:"마인드맵이 없습니다"}),(0,r.jsx)("p",{className:"text-[11px] text-text-inactive mt-1",children:"새로 만들기 버튼을 눌러 시작하세요"})]})]})]}),W?(0,r.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-3 md:px-4 py-2 border-b border-border bg-background/80 flex-shrink-0 gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,r.jsx)("button",{onClick:()=>v(""),className:"md:hidden flex items-center text-text-secondary hover:text-text-primary mr-1 flex-shrink-0",children:(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:(0,r.jsx)("path",{d:"M10 3L5 8L10 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,r.jsx)("input",{value:W.title,onChange:e=>eu(e.target.value),className:"bg-transparent text-sm font-bold text-text-primary outline-none w-28 md:w-40 min-w-0",placeholder:"마인드맵 제목..."})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,r.jsx)("button",{onClick:en,disabled:!ee,title:"되돌리기 (Ctrl+Z)",className:"w-7 h-7 flex items-center justify-center text-text-inactive hover:text-text-primary hover:bg-border rounded transition-colors disabled:opacity-20 disabled:cursor-not-allowed",children:(0,r.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("polyline",{points:"1 4 1 10 7 10"}),(0,r.jsx)("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})]})}),(0,r.jsx)("button",{onClick:er,disabled:!et,title:"다시 실행 (Ctrl+Shift+Z)",className:"w-7 h-7 flex items-center justify-center text-text-inactive hover:text-text-primary hover:bg-border rounded transition-colors disabled:opacity-20 disabled:cursor-not-allowed",children:(0,r.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("polyline",{points:"23 4 23 10 17 10"}),(0,r.jsx)("path",{d:"M20.49 15a9 9 0 1 1-2.13-9.36L23 10"})]})}),(0,r.jsx)("div",{className:"w-px h-4 bg-border mx-0.5"}),(0,r.jsxs)("button",{onClick:()=>{var e;if(!W)return;let t=null===(e=A.current)||void 0===e?void 0:e.getBoundingClientRect(),n=t?(t.width/2-G.x)/G.zoom:400,r=t?(t.height/2-G.y)/G.zoom:300,o={id:"n-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,5)),text:"",x:n-90+(Math.random()-.5)*100,y:r-35+(Math.random()-.5)*100,width:180,height:70,color:m[W.nodes.length%m.length]};ea(e=>({...e,nodes:[...e.nodes,o]})),z(new Set([o.id])),E(o.id)},title:"노드 추가",className:"h-7 px-2 md:px-2.5 flex items-center gap-1 bg-[#e94560]/10 text-[#e94560] rounded-lg text-[11px] font-semibold hover:bg-[#e94560]/20 transition-colors",children:[(0,r.jsx)("span",{className:"md:hidden",children:"+"}),(0,r.jsx)("span",{className:"hidden md:inline",children:"+ 노드"})]}),(0,r.jsx)("div",{className:"w-px h-4 bg-border mx-0.5 hidden md:block"}),(0,r.jsx)("button",{onClick:()=>L("curved"===M?"straight":"curved"),title:"curved"===M?"직선으로 전환":"곡선으로 전환",className:"hidden md:flex h-7 px-2 items-center gap-1 text-text-muted hover:text-text-primary rounded-lg text-[11px] hover:bg-border transition-colors",children:"curved"===M?"〰️ 곡선":"\uD83D\uDCCF 직선"}),(0,r.jsx)("div",{className:"w-px h-4 bg-border mx-0.5 hidden md:block"}),(0,r.jsx)("button",{onClick:()=>{y.current.zoom=Math.min(2.5,1.2*G.zoom),es(e=>({...e,zoom:y.current.zoom})),k()},className:"w-7 h-7 flex items-center justify-center text-text-muted hover:text-text-primary hover:bg-border rounded transition-colors text-xs",title:"확대",children:"+"}),(0,r.jsxs)("span",{className:"text-[10px] text-text-muted w-8 md:w-10 text-center",children:[Math.round(100*G.zoom),"%"]}),(0,r.jsx)("button",{onClick:()=>{y.current.zoom=Math.max(.25,.8*G.zoom),es(e=>({...e,zoom:y.current.zoom})),k()},className:"w-7 h-7 flex items-center justify-center text-text-muted hover:text-text-primary hover:bg-border rounded transition-colors text-xs",title:"축소",children:"−"}),(0,r.jsx)("button",{onClick:()=>{y.current={x:0,y:0,zoom:1},es(e=>({...e,viewportX:0,viewportY:0,zoom:1})),k()},className:"hidden md:flex h-7 px-2 text-[10px] text-text-muted hover:text-text-primary hover:bg-border rounded transition-colors items-center",title:"뷰 초기화",children:"초기화"}),D.size>=2&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-px h-4 bg-border mx-0.5"}),(0,r.jsxs)("button",{onClick:()=>{let e=J.current,t=[...Z.current];if(!e||t.length<2)return;$(Q.current,{nodes:[...e.nodes],edges:[...e.edges]}),H.current=!0;let n=[...e.edges];for(let e=0;e<t.length-1;e++){let r=t[e],o=t[e+1];n.some(e=>e.from===r&&e.to===o||e.from===o&&e.to===r)||n.push({id:"e-".concat(Date.now(),"-").concat(e),from:r,to:o,style:M,color:"#888"})}es(e=>({...e,edges:n})),H.current=!1},className:"h-7 px-2 md:px-2.5 flex items-center gap-1 bg-[#8b5cf6]/10 text-[#8b5cf6] rounded-lg text-[11px] font-semibold hover:bg-[#8b5cf6]/20 transition-colors",title:"선택된 노드 연결",children:[(0,r.jsx)("span",{className:"hidden md:inline",children:"\uD83D\uDD17 연결"}),(0,r.jsx)("span",{className:"md:hidden",children:"\uD83D\uDD17"})]}),(0,r.jsxs)("button",{onClick:ex,className:"h-7 px-2 md:px-2.5 flex items-center gap-1 text-[#e94560] hover:bg-[#e94560]/10 rounded-lg text-[11px] font-semibold transition-colors",title:"선택된 노드 삭제",children:[(0,r.jsx)("span",{className:"hidden md:inline",children:"\uD83D\uDDD1 삭제"}),(0,r.jsx)("span",{className:"md:hidden",children:"\uD83D\uDDD1"})]})]}),1===D.size&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-px h-4 bg-border mx-0.5"}),(0,r.jsxs)("button",{onClick:()=>{K&&em(K)},className:"h-7 px-2 md:px-2.5 flex items-center gap-1 text-[#e94560] hover:bg-[#e94560]/10 rounded-lg text-[11px] font-semibold transition-colors",children:[(0,r.jsx)("span",{className:"hidden md:inline",children:"\uD83D\uDDD1 삭제"}),(0,r.jsx)("span",{className:"md:hidden",children:"\uD83D\uDDD1"})]})]}),C&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-px h-4 bg-border mx-0.5"}),(0,r.jsx)("button",{onClick:()=>eb(C),className:"h-7 px-2 md:px-2.5 flex items-center gap-1 text-[#e94560] hover:bg-[#e94560]/10 rounded-lg text-[11px] font-semibold transition-colors",children:"\uD83D\uDDD1"})]})]})]}),(0,r.jsxs)("div",{ref:A,className:"flex-1 overflow-hidden relative cursor-grab active:cursor-grabbing",onMouseDown:e=>{e.target.closest("[data-node-id]")||(z(new Set),S(null),E(null),ek(e.clientX,e.clientY))},onWheel:e=>{e.preventDefault();let t=e.deltaY>0?.92:1.08,n=Math.max(.25,Math.min(2.5,y.current.zoom*t));y.current.zoom=n,es(e=>({...e,zoom:n})),k()},onTouchStart:e=>{let t=U.current;if(t.longPressTimer&&(clearTimeout(t.longPressTimer),t.longPressTimer=null),2===e.touches.length){let n=e.touches[0].clientX-e.touches[1].clientX,r=e.touches[0].clientY-e.touches[1].clientY;t.lastDist=Math.sqrt(n*n+r*r),N.current.mode="none";return}let n=e.touches[0],r=e.target.closest("[data-node-id]");if(r){let e=r.getAttribute("data-node-id");Z.current.has(e)||z(new Set([e])),S(null),eN(n.clientX,n.clientY,e),t.longPressTimer=setTimeout(()=>{z(t=>{let n=new Set(t);return n.has(e)&&n.size>1?n.delete(e):n.add(e),n}),N.current.mode="none"},500);return}z(new Set),S(null),E(null),ek(n.clientX,n.clientY)},onTouchMove:e=>{let t=U.current;if(t.longPressTimer&&(clearTimeout(t.longPressTimer),t.longPressTimer=null),2===e.touches.length){let n=e.touches[0].clientX-e.touches[1].clientX,r=e.touches[0].clientY-e.touches[1].clientY,o=Math.sqrt(n*n+r*r);if(t.lastDist>0){let e=o/t.lastDist,n=Math.max(.25,Math.min(2.5,y.current.zoom*e));y.current.zoom=n,es(e=>({...e,zoom:n})),k()}t.lastDist=o;return}"none"!==N.current.mode&&(e.preventDefault(),eD(e.touches[0].clientX,e.touches[0].clientY))},onTouchEnd:()=>{let e=U.current;e.longPressTimer&&(clearTimeout(e.longPressTimer),e.longPressTimer=null),e.lastDist=0,"none"!==N.current.mode&&ez()},style:{touchAction:"none"},children:[(0,r.jsx)("div",{className:"canvas-bg absolute inset-0",style:{backgroundImage:"radial-gradient(circle, var(--color-border) 1px, transparent 1px)",backgroundSize:"".concat(24*G.zoom,"px ").concat(24*G.zoom,"px"),backgroundPosition:"".concat(G.x,"px ").concat(G.y,"px")}}),(0,r.jsxs)("div",{style:{transform:"translate(".concat(G.x,"px, ").concat(G.y,"px) scale(").concat(G.zoom,")"),transformOrigin:"0 0",position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:[(0,r.jsxs)("svg",{style:{position:"absolute",top:0,left:0,width:"10000px",height:"10000px",pointerEvents:"none",overflow:"visible"},children:[W.edges.map(e=>{let t=W.nodes.find(t=>t.id===e.from),n=W.nodes.find(t=>t.id===e.to);if(!t||!n)return null;let o=ej(t,n,e.style);return(0,r.jsxs)("g",{children:[(0,r.jsx)("path",{d:o,fill:"none",stroke:"transparent",strokeWidth:"16",style:{pointerEvents:"stroke",cursor:"pointer"},onClick:t=>{t.stopPropagation(),S(e.id),z(new Set)}}),(0,r.jsx)("path",{d:o,fill:"none",stroke:C===e.id?"#e94560":e.color||"#888",strokeWidth:C===e.id?3:2,strokeLinecap:"round",style:{pointerEvents:"none"}}),(()=>{let o=ey(n,t.x+t.width/2,t.y+t.height/2),i=ew(n,o);return(0,r.jsx)("polygon",{points:"-6,-4 0,0 -6,4",fill:C===e.id?"#e94560":e.color||"#888",transform:"translate(".concat(i.x,",").concat(i.y,") rotate(").concat({top:90,right:180,bottom:270,left:0}[o]||0,")"),style:{pointerEvents:"none"}})})()]},e.id)}),X&&(()=>{let e=W.nodes.find(e=>e.id===X.nodeId);if(!e)return null;let t=ew(e,X.side);return(0,r.jsx)("path",{d:"M ".concat(t.x," ").concat(t.y," L ").concat(R.x," ").concat(R.y),fill:"none",stroke:"#e94560",strokeWidth:"2",strokeDasharray:"6 4",style:{pointerEvents:"none"}})})()]}),W.nodes.map(e=>{let t=D.has(e.id),n=P===e.id;return(0,r.jsx)("div",{"data-node-id":e.id,style:{position:"absolute",left:"".concat(e.x,"px"),top:"".concat(e.y,"px"),width:"".concat(e.width,"px"),minHeight:"".concat(e.height,"px"),zIndex:t?100:10},className:"rounded-xl shadow-lg transition-shadow ".concat(t?"ring-2 ring-[#e94560] shadow-xl":"hover:shadow-xl"),onMouseDown:t=>eC(t,e.id),onMouseUp:()=>eS(e.id),onDoubleClick:()=>{E(e.id),z(new Set([e.id]))},children:(0,r.jsxs)("div",{className:"w-full h-full rounded-xl p-3 relative",style:{backgroundColor:e.color,minHeight:"".concat(e.height,"px")},children:[(t||X)&&["top","right","bottom","left"].map(t=>{let n={top:{left:"50%",top:"-5px",transform:"translateX(-50%)"},right:{right:"-5px",top:"50%",transform:"translateY(-50%)"},bottom:{left:"50%",bottom:"-5px",transform:"translateX(-50%)"},left:{left:"-5px",top:"50%",transform:"translateY(-50%)"}}[t];return(0,r.jsx)("div",{className:"absolute w-[10px] h-[10px] bg-white border-2 border-[#888] rounded-full cursor-crosshair hover:border-[#e94560] hover:scale-125 transition-all z-50",style:n,onMouseDown:n=>eP(n,e.id,t)},t)}),t&&1===D.size&&!n&&(0,r.jsxs)("div",{className:"absolute -top-8 left-0 flex gap-1 z-50",children:[m.map(t=>(0,r.jsx)("button",{onClick:n=>{n.stopPropagation(),eh(e.id,t)},className:"w-5 h-5 rounded-full border-2 border-white/50 hover:scale-110 transition-transform shadow-sm",style:{backgroundColor:t}},t)),(0,r.jsx)("button",{onClick:t=>{var n,r;t.stopPropagation(),null===(n=O.current)||void 0===n||n.setAttribute("data-node-id",e.id),null===(r=O.current)||void 0===r||r.click()},className:"w-5 h-5 rounded-full bg-white/90 flex items-center justify-center text-[10px] hover:scale-110 transition-transform shadow-sm",title:"이미지 추가",children:"\uD83D\uDCF7"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),em(e.id)},className:"w-5 h-5 rounded-full bg-white/90 flex items-center justify-center text-[10px] hover:scale-110 transition-transform shadow-sm text-[#e94560]",title:"삭제",children:"\xd7"})]}),e.imageURL&&(0,r.jsxs)("div",{className:"mb-2 relative group/img",children:[(0,r.jsx)("img",{src:e.imageURL,alt:"",className:"w-full rounded-lg object-cover max-h-32",draggable:!1}),t&&(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eg(e.id)},className:"absolute top-1 right-1 w-5 h-5 bg-black/50 text-white rounded-full text-xs flex items-center justify-center hover:bg-black/70",children:"\xd7"})]}),B===e.id&&(0,r.jsxs)("div",{className:"mb-2 flex items-center gap-2 text-white/80 text-xs",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white/50 border-t-white rounded-full animate-spin"}),"업로드 중..."]}),n?(0,r.jsx)("textarea",{value:e.text,onChange:t=>ep(e.id,t.target.value),onBlur:()=>E(null),onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),onKeyDown:e=>{"Escape"===e.key&&E(null)},autoFocus:!0,className:"w-full bg-transparent text-white outline-none resize-none text-sm placeholder-white/50",placeholder:"아이디어를 입력하세요...",rows:Math.max(2,e.text.split("\n").length),style:{cursor:"text"}}):(0,r.jsx)("div",{className:"text-white text-sm whitespace-pre-wrap break-words select-none",style:{minHeight:"24px",cursor:"move"},children:e.text||(0,r.jsx)("span",{className:"opacity-50",children:"더블클릭하여 편집"})})]})},e.id)})]}),D.size>=2&&(0,r.jsxs)("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 bg-[#8b5cf6] text-white px-3 py-1.5 rounded-full text-xs font-semibold shadow-lg z-50",children:[D.size,"개 선택됨"]}),X&&(0,r.jsxs)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-background-card border border-border px-4 py-2 rounded-full text-xs text-text-muted shadow-lg z-50",children:["다른 노드에 드롭하여 연결 \xb7 ",(0,r.jsx)("span",{className:"text-text-inactive",children:"Esc로 취소"})]}),(0,r.jsx)("div",{className:"absolute bottom-3 right-3 md:hidden text-[9px] text-text-inactive bg-background/80 px-2 py-1 rounded-full",children:"길게 눌러 다중선택"}),(0,r.jsx)("input",{ref:O,type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t,n;let r=null===(t=e.target.files)||void 0===t?void 0:t[0],o=null===(n=O.current)||void 0===n?void 0:n.getAttribute("data-node-id");r&&o&&ef(o,r),e.target.value=""}})]})]}):(0,r.jsx)("div",{className:"flex-1 hidden md:flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center text-text-muted",children:[(0,r.jsx)("p",{className:"text-6xl mb-4",children:"\uD83E\uDDE0"}),(0,r.jsx)("p",{className:"text-lg font-bold mb-2",children:"마인드맵"}),(0,r.jsx)("p",{className:"text-sm text-text-inactive mb-6",children:"아이디어를 시각적으로 정리하고 연결하세요"}),(0,r.jsx)("button",{onClick:el,className:"px-6 py-2.5 bg-gradient-to-r from-[#e94560] to-[#533483] text-white text-sm font-bold rounded-xl hover:opacity-90 transition-opacity",children:"+ 새 마인드맵 만들기"})]})})]})}function p(){return(0,r.jsx)(o.Suspense,{fallback:(0,r.jsx)("div",{className:"p-8 flex items-center justify-center min-h-[50vh]",children:(0,r.jsx)("div",{className:"w-6 h-6 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin"})}),children:(0,r.jsx)(x,{})})}},354:function(e,t,n){"use strict";n.d(t,{FV:function(){return x},Qs:function(){return m},TH:function(){return d},dU:function(){return a},mB:function(){return i},nd:function(){return l},pD:function(){return s}});var r=n(7955),o=n(1579);let i=10485760;async function s(e,t,n,i,s){let a="users/".concat(e,"/tasks/").concat(t,"/").concat(i,"/").concat(n.name),l=(0,r.iH)(o.tO,a),d=(0,r.B0)(l,n);return new Promise((e,t)=>{d.on("state_changed",e=>{let t=Math.round(e.bytesTransferred/e.totalBytes*100);null==s||s(t)},e=>t(e),async()=>{e({downloadURL:await (0,r.Jt)(d.snapshot.ref),storagePath:a})})})}async function a(e){try{await (0,r.oq)((0,r.iH)(o.tO,e))}catch(e){}}async function l(e){await Promise.all(e.map(e=>e.storagePath?a(e.storagePath):Promise.resolve()))}function d(e,t,n){if(["image/","video/","audio/","application/pdf","text/"].some(e=>n.startsWith(e))){if(!window.open(e,"_blank")){let n=document.createElement("a");n.href=e,n.download=t,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}else{let n=document.createElement("a");n.href=e,n.download=t,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}let c="attachments";function u(){return new Promise((e,t)=>{let n=indexedDB.open("ai-todo-files",1);n.onupgradeneeded=()=>{n.result.createObjectStore(c)},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)})}async function m(e,t,n){var r,o;let i=await u(),s=await new Promise((t,n)=>{let r=i.transaction(c,"readonly").objectStore(c).get(e);r.onsuccess=()=>{var e;return t(null!==(e=r.result)&&void 0!==e?e:null)},r.onerror=()=>n(r.error)});if(!s){alert("파일을 찾을 수 없습니다.\n(다른 기기에서 추가된 파일이거나 브라우저 데이터가 삭제되었을 수 있습니다)");return}let a=s.name||t,l=s.type||n||({jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",bmp:"image/bmp",svg:"image/svg+xml",ico:"image/x-icon",avif:"image/avif",mp4:"video/mp4",webm:"video/webm",mov:"video/quicktime",avi:"video/x-msvideo",mkv:"video/x-matroska",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",flac:"audio/flac",aac:"audio/aac",m4a:"audio/mp4",pdf:"application/pdf",txt:"text/plain",md:"text/markdown",csv:"text/csv",html:"text/html",xml:"text/xml",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",doc:"application/msword",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xls:"application/vnd.ms-excel",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",ppt:"application/vnd.ms-powerpoint",zip:"application/zip","7z":"application/x-7z-compressed",rar:"application/vnd.rar",tar:"application/x-tar",gz:"application/gzip",json:"application/json",js:"text/javascript",ts:"text/typescript",py:"text/x-python",java:"text/x-java-source",c:"text/x-csrc",cpp:"text/x-c++src"})[null!==(o=null===(r=a.split(".").pop())||void 0===r?void 0:r.toLowerCase())&&void 0!==o?o:""]||"application/octet-stream",d=new Blob([s.blob],{type:l}),m=URL.createObjectURL(d);if(["image/","video/","audio/","application/pdf","text/"].some(e=>l.startsWith(e))){if(!window.open(m,"_blank")){let e=document.createElement("a");e.href=m,e.download=a,document.body.appendChild(e),e.click(),document.body.removeChild(e)}}else{let e=document.createElement("a");e.href=m,e.download=a,document.body.appendChild(e),e.click(),document.body.removeChild(e)}setTimeout(()=>URL.revokeObjectURL(m),15e3)}async function x(e){if(!e.length)return;let t=await u();return new Promise((n,r)=>{let o=t.transaction(c,"readwrite"),i=o.objectStore(c);e.forEach(e=>i.delete(e)),o.oncomplete=()=>n(),o.onerror=()=>r(o.error)})}},1730:function(e,t,n){"use strict";n.d(t,{P:function(){return c},a:function(){return u}});var r=n(6717),o=n(7387),i=n(7253),s=n(1579),a=n(1097);let l=(0,o.createContext)({tasks:[],lists:[],notes:[],folders:[],mindmaps:[],loading:!0,storageUsed:0});function d(e){return new Blob([e]).size}function c(e){let{children:t}=e,{user:n,loading:c}=(0,a.a)(),[u,m]=(0,o.useState)([]),[x,p]=(0,o.useState)([]),[h,f]=(0,o.useState)([]),[g,v]=(0,o.useState)([]),[b,w]=(0,o.useState)([]),[y,j]=(0,o.useState)(!0),k=(0,o.useRef)([]);(0,o.useEffect)(()=>{if(c)return;if(k.current.forEach(e=>e()),k.current=[],!n){m([]),p([]),f([]),v([]),w([]),j(!1);return}j(!0);let e=n.uid,t=0,r=()=>{++t>=5&&j(!1)},o=(0,i.cf)((0,i.IO)((0,i.hJ)(s.db,"users",e,"tasks"),(0,i.Xo)("createdAt","desc")),e=>{m(e.docs.map(e=>({id:e.id,...e.data()}))),r()},()=>r()),a=(0,i.cf)((0,i.hJ)(s.db,"users",e,"lists"),e=>{p(e.docs.map(e=>({id:e.id,...e.data()}))),r()},()=>r()),l=(0,i.cf)((0,i.IO)((0,i.hJ)(s.db,"users",e,"notes"),(0,i.Xo)("createdAt","desc")),e=>{f(e.docs.map(e=>({id:e.id,...e.data()}))),r()},()=>r()),d=(0,i.cf)((0,i.hJ)(s.db,"users",e,"folders"),e=>{v(e.docs.map(e=>({id:e.id,...e.data()}))),r()},()=>r()),u=(0,i.cf)((0,i.IO)((0,i.hJ)(s.db,"users",e,"mindmaps"),(0,i.Xo)("createdAt","desc")),e=>{w(e.docs.map(e=>({id:e.id,...e.data()}))),r()},()=>r());return k.current=[o,a,l,d,u],()=>{k.current.forEach(e=>e()),k.current=[]}},[n,c]);let N=function(e,t,n){var r,o,i,s;let a=0;for(let t of e){for(let e of(a+=d(t.title||"")+d(t.memo||""),null!==(r=t.subTasks)&&void 0!==r?r:[]))a+=d(e.title||"");for(let e of null!==(o=t.attachments)&&void 0!==o?o:[])a+=e.size}for(let e of t)for(let t of(a+=d(e.title||""),null!==(i=e.blocks)&&void 0!==i?i:[]))a+=d(t.content||"")+d(t.children||"");for(let e of n)for(let t of(a+=d(e.title||""),null!==(s=e.nodes)&&void 0!==s?s:[]))a+=d(t.text||""),t.imageSize&&(a+=t.imageSize);return a}(u,h,b);return(0,r.jsx)(l.Provider,{value:{tasks:u,lists:x,notes:h,folders:g,mindmaps:b,loading:y,storageUsed:N},children:t})}function u(){return(0,o.useContext)(l)}}},function(e){e.O(0,[815,419,412,936,407,809,744],function(){return e(e.s=4537)}),_N_E=e.O()}]);