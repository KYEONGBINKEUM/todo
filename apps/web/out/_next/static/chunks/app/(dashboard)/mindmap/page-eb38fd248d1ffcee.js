(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[90],{4537:function(e,t,o){Promise.resolve().then(o.bind(o,370))},370:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return p}});var n=o(6717),r=o(7387),i=o(1097),a=o(9936),s=o(6813),l=o(7955),d=o(1579),c=o(354),u=o(1730);let x=["#e94560","#8b5cf6","#06b6d4","#22c55e","#f59e0b","#ec4899"];function m(){let{user:e}=(0,i.a)(),{t}=(0,a.QT)(),{mindmaps:o,loading:m}=(0,u.a)(),p=(0,r.useRef)(!1),[h,f]=(0,r.useState)([]),[g,v]=(0,r.useState)(""),[b,w]=(0,r.useState)(""),[y,j]=(0,r.useState)(0),[k,N]=(0,r.useState)(0),[C,D]=(0,r.useState)(1),[S,E]=(0,r.useState)(null),[P,z]=(0,r.useState)(null),[M,L]=(0,r.useState)(null),[O,X]=(0,r.useState)({x:0,y:0}),[R,Y]=(0,r.useState)(null),[B,U]=(0,r.useState)(!1),[I,_]=(0,r.useState)({x:0,y:0}),[H,A]=(0,r.useState)("curved"),[F,J]=(0,r.useState)(null),[T,W]=(0,r.useState)({x:0,y:0}),q=(0,r.useRef)(null),[Q,G]=(0,r.useState)(null),K=(0,r.useRef)(null),V=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(m||p.current)return;p.current=!0;let e=o.map(e=>{var t,o,n,r,i,a,s;return{id:e.id,title:e.title,nodes:e.nodes||[],edges:e.edges||[],viewportX:null!==(r=e.viewportX)&&void 0!==r?r:0,viewportY:null!==(i=e.viewportY)&&void 0!==i?i:0,zoom:null!==(a=e.zoom)&&void 0!==a?a:1,starred:null!==(s=e.starred)&&void 0!==s&&s,createdAt:(null===(n=e.createdAt)||void 0===n?void 0:null===(o=n.toDate)||void 0===o?void 0:null===(t=o.call(n))||void 0===t?void 0:t.toISOString())||new Date().toISOString()}});f(e),e.length>0&&v(e[0].id)},[m]);let Z=h.find(e=>e.id===g);(0,r.useEffect)(()=>{Z&&(j(Z.viewportX),N(Z.viewportY),D(Z.zoom||1))},[g]);let $=(0,r.useCallback)(async t=>{if(e)try{await (0,s.mb)(e.uid,t.id,{title:t.title,nodes:t.nodes,edges:t.edges,viewportX:t.viewportX,viewportY:t.viewportY,zoom:t.zoom})}catch(e){console.error("Failed to save mindmap:",e)}},[e]),ee=(0,r.useCallback)(e=>{V.current&&clearTimeout(V.current),V.current=setTimeout(()=>$(e),500)},[$]),et=e=>{f(t=>{let o=t.map(t=>t.id===g?e(t):t),n=o.find(e=>e.id===g);return n&&ee(n),o})},eo=async()=>{let t=Date.now().toString(),o={id:t,title:"새 마인드맵",nodes:[{id:"root",text:"중심 아이디어",x:400,y:300,width:180,height:70,color:x[0]}],edges:[],viewportX:0,viewportY:0,zoom:1,starred:!1,createdAt:new Date().toISOString()};if(f(e=>[o,...e]),v(t),e)try{let n=await (0,s.GE)(e.uid,{title:o.title,nodes:o.nodes,edges:o.edges,viewportX:0,viewportY:0,zoom:1});f(e=>e.map(e=>e.id===t?{...e,id:n}:e)),v(n)}catch(e){console.error("Failed to create mindmap:",e)}},en=async t=>{if(!confirm("이 마인드맵을 삭제하시겠습니까?"))return;let o=h.find(e=>e.id===t);if(o){for(let e of o.nodes)if(e.imagePath)try{await (0,l.oq)((0,l.iH)(d.tO,e.imagePath))}catch(e){}}if(f(e=>e.filter(e=>e.id!==t)),g===t){var n;v((null===(n=h.filter(e=>e.id!==t)[0])||void 0===n?void 0:n.id)||"")}if(e)try{await (0,s.ZY)(e.uid,t)}catch(e){console.error(e)}},er=async t=>{if(f(e=>e.map(e=>e.id===t?{...e,starred:!e.starred}:e)),e){let o=h.find(e=>e.id===t);if(o)try{await (0,s.mb)(e.uid,t,{starred:!o.starred})}catch(e){}}},ei=e=>{et(t=>({...t,title:e}))},ea=async e=>{if(!Z)return;let t=Z.nodes.find(t=>t.id===e);if(null==t?void 0:t.imagePath)try{await (0,l.oq)((0,l.iH)(d.tO,t.imagePath))}catch(e){}et(t=>({...t,nodes:t.nodes.filter(t=>t.id!==e),edges:t.edges.filter(t=>t.from!==e&&t.to!==e)})),S===e&&E(null)},es=(e,t)=>{et(o=>({...o,nodes:o.nodes.map(o=>o.id===e?{...o,text:t}:o)}))},el=(e,t)=>{et(o=>({...o,nodes:o.nodes.map(o=>o.id===e?{...o,color:t}:o)}))},ed=async(t,o)=>{if(e&&Z){if(o.size>c.mB){alert("이미지는 10MB 이하만 가능합니다.");return}G(t);try{let n="users/".concat(e.uid,"/mindmaps/").concat(Z.id,"/").concat(t,"/").concat(o.name),r=(0,l.iH)(d.tO,n),i=(0,l.B0)(r,o);await new Promise((e,r)=>{i.on("state_changed",null,r,async()=>{let r=await (0,l.Jt)(i.snapshot.ref);et(e=>({...e,nodes:e.nodes.map(e=>e.id===t?{...e,imageURL:r,imagePath:n,imageSize:o.size}:e)})),e()})})}catch(e){console.error("Image upload failed:",e)}G(null)}},ec=async e=>{if(!Z)return;let t=Z.nodes.find(t=>t.id===e);if(null==t?void 0:t.imagePath)try{await (0,l.oq)((0,l.iH)(d.tO,t.imagePath))}catch(e){}et(t=>({...t,nodes:t.nodes.map(t=>t.id===e?{...t,imageURL:void 0,imagePath:void 0,imageSize:void 0}:t)}))},eu=(e,t)=>{if(!Z||Z.edges.some(o=>o.from===e&&o.to===t||o.from===t&&o.to===e))return;let o={id:"e-".concat(Date.now()),from:e,to:t,style:H,color:"#888"};et(e=>({...e,edges:[...e.edges,o]}))},ex=e=>{et(t=>({...t,edges:t.edges.filter(t=>t.id!==e)})),z(null)},em=(e,t)=>{let o=e.x+e.width/2,n=e.y+e.height/2;switch(t){case"top":return{x:o,y:e.y};case"right":return{x:e.x+e.width,y:n};case"bottom":return{x:o,y:e.y+e.height};case"left":return{x:e.x,y:n};default:return{x:o,y:n}}},ep=(e,t,o)=>{let n=e.x+e.width/2,r=e.y+e.height/2,i=t-n,a=o-r;return Math.abs(i)>Math.abs(a)?i>0?"right":"left":a>0?"bottom":"top"},eh=(e,t,o)=>{let n=ep(e,t.x+t.width/2,t.y+t.height/2),r=ep(t,e.x+e.width/2,e.y+e.height/2),i=em(e,n),a=em(t,r);if("straight"===o)return"M ".concat(i.x," ").concat(i.y," L ").concat(a.x," ").concat(a.y);let s=a.x-i.x,l=a.y-i.y,d=Math.min(.4*Math.sqrt(s*s+l*l),120),c={top:[0,-1],right:[1,0],bottom:[0,1],left:[-1,0]}[n]||[0,0],u={top:[0,-1],right:[1,0],bottom:[0,1],left:[-1,0]}[r]||[0,0],x=i.x+c[0]*d,m=i.y+c[1]*d,p=a.x+u[0]*d,h=a.y+u[1]*d;return"M ".concat(i.x," ").concat(i.y," C ").concat(x," ").concat(m,", ").concat(p," ").concat(h,", ").concat(a.x," ").concat(a.y)},ef=()=>{if(B&&(U(!1),et(e=>({...e,viewportX:y,viewportY:k}))),M){L(null);let e=h.find(e=>e.id===g);e&&ee(e)}F&&J(null)},eg=(e,t)=>{var o;if(e.stopPropagation(),F)return;E(t),z(null);let n=null===(o=K.current)||void 0===o?void 0:o.getBoundingClientRect(),r=null==Z?void 0:Z.nodes.find(e=>e.id===t);r&&n&&(L(t),X({x:(e.clientX-n.left-y)/C-r.x,y:(e.clientY-n.top-k)/C-r.y}))},ev=e=>{F&&F.nodeId!==e&&(eu(F.nodeId,e),J(null))},eb=(e,t,o)=>{e.stopPropagation(),e.preventDefault(),J({nodeId:t,side:o})};(0,r.useEffect)(()=>{let e=e=>{R||(("Delete"===e.key||"Backspace"===e.key)&&(P?ex(P):S&&ea(S)),"Escape"===e.key&&(E(null),z(null),Y(null),J(null)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)});let ew=b?h.filter(e=>e.title.toLowerCase().includes(b.toLowerCase())):h;return m?(0,n.jsx)("div",{className:"p-8 flex items-center justify-center min-h-[50vh]",children:(0,n.jsx)("div",{className:"w-6 h-6 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin"})}):(0,n.jsxs)("div",{className:"flex h-full",children:[(0,n.jsxs)("div",{className:"".concat(Z?"hidden md:flex":"flex"," w-full md:w-72 flex-col border-r border-border bg-background"),children:[(0,n.jsxs)("div",{className:"p-4 border-b border-border",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("h2",{className:"text-lg font-bold text-text-primary",children:["\uD83E\uDDE0 ",t("nav.mindmap")]}),(0,n.jsx)("button",{onClick:eo,className:"px-3 py-1.5 bg-gradient-to-r from-[#e94560] to-[#533483] text-white text-xs font-bold rounded-lg hover:opacity-90 transition-opacity",children:"+ 새로 만들기"})]}),(0,n.jsx)("input",{type:"text",value:b,onChange:e=>w(e.target.value),placeholder:"마인드맵 검색...",className:"w-full px-3 py-2 bg-background-card border border-border rounded-lg text-sm text-text-primary placeholder-text-muted focus:outline-none focus:border-[#e94560]"})]}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:[ew.map(e=>(0,n.jsxs)("div",{className:"group flex items-center gap-2 px-3 py-2.5 rounded-lg cursor-pointer transition-all ".concat(e.id===g?"bg-[#e94560]/10 text-[#e94560]":"text-text-secondary hover:bg-background-card hover:text-text-primary"),onClick:()=>v(e.id),children:[(0,n.jsx)("span",{className:"text-base flex-shrink-0",children:"\uD83E\uDDE0"}),(0,n.jsx)("span",{className:"flex-1 text-sm font-medium truncate",children:e.title||"제목 없음"}),(0,n.jsx)("span",{className:"text-[10px] text-text-muted flex-shrink-0",children:e.nodes.length}),(0,n.jsxs)("div",{className:"opacity-0 group-hover:opacity-100 flex gap-0.5 flex-shrink-0",children:[(0,n.jsx)("button",{onClick:t=>{t.stopPropagation(),er(e.id)},className:"text-[10px] transition-all ".concat(e.starred?"text-amber-400 !opacity-100":"text-text-muted hover:text-amber-400"),children:e.starred?"★":"☆"}),(0,n.jsx)("button",{onClick:t=>{t.stopPropagation(),en(e.id)},className:"text-text-inactive hover:text-[#e94560] transition-all text-sm",children:"\xd7"})]})]},e.id)),0===ew.length&&(0,n.jsxs)("div",{className:"text-center py-12 text-text-muted",children:[(0,n.jsx)("p",{className:"text-4xl mb-3",children:"\uD83E\uDDE0"}),(0,n.jsx)("p",{className:"text-sm",children:"마인드맵이 없습니다"}),(0,n.jsx)("p",{className:"text-[11px] text-text-inactive mt-1",children:"새로 만들기 버튼을 눌러 시작하세요"})]})]})]}),Z?(0,n.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border-b border-border bg-background/80 flex-shrink-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>v(""),className:"md:hidden flex items-center text-text-secondary hover:text-text-primary mr-1",children:(0,n.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:(0,n.jsx)("path",{d:"M10 3L5 8L10 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,n.jsx)("input",{value:Z.title,onChange:e=>ei(e.target.value),className:"bg-transparent text-sm font-bold text-text-primary outline-none w-40",placeholder:"마인드맵 제목..."})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("button",{onClick:()=>{var e;if(!Z)return;let t=null===(e=K.current)||void 0===e?void 0:e.getBoundingClientRect(),o=t?(t.width/2-y)/C:400,n=t?(t.height/2-k)/C:300,r={id:"n-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,5)),text:"",x:o-90+(Math.random()-.5)*100,y:n-35+(Math.random()-.5)*100,width:180,height:70,color:x[Z.nodes.length%x.length]};et(e=>({...e,nodes:[...e.nodes,r]})),E(r.id),Y(r.id)},title:"노드 추가",className:"h-7 px-2.5 flex items-center gap-1 bg-[#e94560]/10 text-[#e94560] rounded-lg text-[11px] font-semibold hover:bg-[#e94560]/20 transition-colors",children:"+ 노드"}),(0,n.jsx)("div",{className:"w-px h-4 bg-border mx-1"}),(0,n.jsx)("button",{onClick:()=>A("curved"===H?"straight":"curved"),title:"curved"===H?"직선으로 전환":"곡선으로 전환",className:"h-7 px-2 flex items-center gap-1 text-text-muted hover:text-text-primary rounded-lg text-[11px] hover:bg-border transition-colors",children:"curved"===H?"〰️ 곡선":"\uD83D\uDCCF 직선"}),(0,n.jsx)("div",{className:"w-px h-4 bg-border mx-1"}),(0,n.jsx)("button",{onClick:()=>{let e=Math.min(2.5,1.2*C);D(e),et(t=>({...t,zoom:e}))},className:"w-7 h-7 flex items-center justify-center text-text-muted hover:text-text-primary hover:bg-border rounded transition-colors text-xs",title:"확대",children:"+"}),(0,n.jsxs)("span",{className:"text-[10px] text-text-muted w-10 text-center",children:[Math.round(100*C),"%"]}),(0,n.jsx)("button",{onClick:()=>{let e=Math.max(.25,.8*C);D(e),et(t=>({...t,zoom:e}))},className:"w-7 h-7 flex items-center justify-center text-text-muted hover:text-text-primary hover:bg-border rounded transition-colors text-xs",title:"축소",children:"−"}),(0,n.jsx)("button",{onClick:()=>{j(0),N(0),D(1),et(e=>({...e,viewportX:0,viewportY:0,zoom:1}))},className:"h-7 px-2 text-[10px] text-text-muted hover:text-text-primary hover:bg-border rounded transition-colors",title:"뷰 초기화",children:"초기화"}),(S||P)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-px h-4 bg-border mx-1"}),(0,n.jsx)("button",{onClick:()=>{P?ex(P):S&&ea(S)},className:"h-7 px-2.5 flex items-center gap-1 text-[#e94560] hover:bg-[#e94560]/10 rounded-lg text-[11px] font-semibold transition-colors",children:"\uD83D\uDDD1 삭제"})]})]})]}),(0,n.jsxs)("div",{ref:K,className:"flex-1 overflow-hidden relative cursor-grab active:cursor-grabbing",onMouseDown:e=>{(e.target===K.current||e.target.classList.contains("canvas-bg"))&&(E(null),z(null),Y(null),U(!0),_({x:e.clientX-y,y:e.clientY-k}))},onMouseMove:e=>{var t;let o=null===(t=K.current)||void 0===t?void 0:t.getBoundingClientRect();if(o&&W({x:(e.clientX-o.left-y)/C,y:(e.clientY-o.top-k)/C}),B){j(e.clientX-I.x),N(e.clientY-I.y);return}if(M){let t=(e.clientX-((null==o?void 0:o.left)||0)-y)/C-O.x,n=(e.clientY-((null==o?void 0:o.top)||0)-k)/C-O.y;f(e=>e.map(e=>e.id===g?{...e,nodes:e.nodes.map(e=>e.id===M?{...e,x:t,y:n}:e)}:e))}},onMouseUp:ef,onMouseLeave:ef,onWheel:e=>{e.preventDefault();let t=e.deltaY>0?.92:1.08;D(e=>{let o=Math.max(.25,Math.min(2.5,e*t));return et(e=>({...e,zoom:o})),o})},style:{touchAction:"none"},children:[(0,n.jsx)("div",{className:"canvas-bg absolute inset-0",style:{backgroundImage:"radial-gradient(circle, var(--color-border) 1px, transparent 1px)",backgroundSize:"".concat(24*C,"px ").concat(24*C,"px"),backgroundPosition:"".concat(y,"px ").concat(k,"px")}}),(0,n.jsxs)("div",{style:{transform:"translate(".concat(y,"px, ").concat(k,"px) scale(").concat(C,")"),transformOrigin:"0 0",position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:[(0,n.jsxs)("svg",{style:{position:"absolute",top:0,left:0,width:"10000px",height:"10000px",pointerEvents:"none",overflow:"visible"},children:[Z.edges.map(e=>{let t=Z.nodes.find(t=>t.id===e.from),o=Z.nodes.find(t=>t.id===e.to);if(!t||!o)return null;let r=eh(t,o,e.style);return(0,n.jsxs)("g",{children:[(0,n.jsx)("path",{d:r,fill:"none",stroke:"transparent",strokeWidth:"16",style:{pointerEvents:"stroke",cursor:"pointer"},onClick:t=>{t.stopPropagation(),z(e.id),E(null)}}),(0,n.jsx)("path",{d:r,fill:"none",stroke:P===e.id?"#e94560":e.color||"#888",strokeWidth:P===e.id?3:2,strokeLinecap:"round",style:{pointerEvents:"none"}}),(()=>{let r=ep(o,t.x+t.width/2,t.y+t.height/2),i=em(o,r);return(0,n.jsx)("polygon",{points:"-6,-4 0,0 -6,4",fill:P===e.id?"#e94560":e.color||"#888",transform:"translate(".concat(i.x,",").concat(i.y,") rotate(").concat({top:90,right:180,bottom:270,left:0}[r]||0,")"),style:{pointerEvents:"none"}})})()]},e.id)}),F&&(()=>{let e=Z.nodes.find(e=>e.id===F.nodeId);if(!e)return null;let t=em(e,F.side);return(0,n.jsx)("path",{d:"M ".concat(t.x," ").concat(t.y," L ").concat(T.x," ").concat(T.y),fill:"none",stroke:"#e94560",strokeWidth:"2",strokeDasharray:"6 4",style:{pointerEvents:"none"}})})()]}),Z.nodes.map(e=>{let t=S===e.id,o=R===e.id;return(0,n.jsx)("div",{style:{position:"absolute",left:"".concat(e.x,"px"),top:"".concat(e.y,"px"),width:"".concat(e.width,"px"),minHeight:"".concat(e.height,"px"),zIndex:t?100:10},className:"rounded-xl shadow-lg transition-shadow ".concat(t?"ring-2 ring-[#e94560] shadow-xl":"hover:shadow-xl"),onMouseDown:t=>eg(t,e.id),onMouseUp:()=>ev(e.id),onDoubleClick:()=>{Y(e.id),E(e.id)},children:(0,n.jsxs)("div",{className:"w-full h-full rounded-xl p-3 relative",style:{backgroundColor:e.color,minHeight:"".concat(e.height,"px")},children:[(t||F)&&["top","right","bottom","left"].map(t=>{let o={top:{left:"50%",top:"-5px",transform:"translateX(-50%)"},right:{right:"-5px",top:"50%",transform:"translateY(-50%)"},bottom:{left:"50%",bottom:"-5px",transform:"translateX(-50%)"},left:{left:"-5px",top:"50%",transform:"translateY(-50%)"}}[t];return(0,n.jsx)("div",{className:"absolute w-[10px] h-[10px] bg-white border-2 border-[#888] rounded-full cursor-crosshair hover:border-[#e94560] hover:scale-125 transition-all z-50",style:o,onMouseDown:o=>eb(o,e.id,t)},t)}),t&&!o&&(0,n.jsxs)("div",{className:"absolute -top-8 left-0 flex gap-1 z-50",children:[x.map(t=>(0,n.jsx)("button",{onClick:o=>{o.stopPropagation(),el(e.id,t)},className:"w-5 h-5 rounded-full border-2 border-white/50 hover:scale-110 transition-transform shadow-sm",style:{backgroundColor:t}},t)),(0,n.jsx)("button",{onClick:t=>{var o,n;t.stopPropagation(),null===(o=q.current)||void 0===o||o.setAttribute("data-node-id",e.id),null===(n=q.current)||void 0===n||n.click()},className:"w-5 h-5 rounded-full bg-white/90 flex items-center justify-center text-[10px] hover:scale-110 transition-transform shadow-sm",title:"이미지 추가",children:"\uD83D\uDCF7"}),(0,n.jsx)("button",{onClick:t=>{t.stopPropagation(),ea(e.id)},className:"w-5 h-5 rounded-full bg-white/90 flex items-center justify-center text-[10px] hover:scale-110 transition-transform shadow-sm text-[#e94560]",title:"삭제",children:"\xd7"})]}),e.imageURL&&(0,n.jsxs)("div",{className:"mb-2 relative group/img",children:[(0,n.jsx)("img",{src:e.imageURL,alt:"",className:"w-full rounded-lg object-cover max-h-32",draggable:!1}),t&&(0,n.jsx)("button",{onClick:t=>{t.stopPropagation(),ec(e.id)},className:"absolute top-1 right-1 w-5 h-5 bg-black/50 text-white rounded-full text-xs flex items-center justify-center hover:bg-black/70",children:"\xd7"})]}),Q===e.id&&(0,n.jsxs)("div",{className:"mb-2 flex items-center gap-2 text-white/80 text-xs",children:[(0,n.jsx)("div",{className:"w-4 h-4 border-2 border-white/50 border-t-white rounded-full animate-spin"}),"업로드 중..."]}),o?(0,n.jsx)("textarea",{value:e.text,onChange:t=>es(e.id,t.target.value),onBlur:()=>Y(null),onMouseDown:e=>e.stopPropagation(),onKeyDown:e=>{"Escape"===e.key&&Y(null)},autoFocus:!0,className:"w-full bg-transparent text-white outline-none resize-none text-sm placeholder-white/50",placeholder:"아이디어를 입력하세요...",rows:Math.max(2,e.text.split("\n").length),style:{cursor:"text"}}):(0,n.jsx)("div",{className:"text-white text-sm whitespace-pre-wrap break-words select-none",style:{minHeight:"24px",cursor:"move"},children:e.text||(0,n.jsx)("span",{className:"opacity-50",children:"더블클릭하여 편집"})})]})},e.id)})]}),F&&(0,n.jsxs)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-background-card border border-border px-4 py-2 rounded-full text-xs text-text-muted shadow-lg z-50",children:["다른 노드에 드롭하여 연결 \xb7 ",(0,n.jsx)("span",{className:"text-text-inactive",children:"Esc로 취소"})]}),(0,n.jsx)("input",{ref:q,type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t,o;let n=null===(t=e.target.files)||void 0===t?void 0:t[0],r=null===(o=q.current)||void 0===o?void 0:o.getAttribute("data-node-id");n&&r&&ed(r,n),e.target.value=""}})]})]}):(0,n.jsx)("div",{className:"flex-1 hidden md:flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center text-text-muted",children:[(0,n.jsx)("p",{className:"text-6xl mb-4",children:"\uD83E\uDDE0"}),(0,n.jsx)("p",{className:"text-lg font-bold mb-2",children:"마인드맵"}),(0,n.jsx)("p",{className:"text-sm text-text-inactive mb-6",children:"아이디어를 시각적으로 정리하고 연결하세요"}),(0,n.jsx)("button",{onClick:eo,className:"px-6 py-2.5 bg-gradient-to-r from-[#e94560] to-[#533483] text-white text-sm font-bold rounded-xl hover:opacity-90 transition-opacity",children:"+ 새 마인드맵 만들기"})]})})]})}function p(){return(0,n.jsx)(r.Suspense,{fallback:(0,n.jsx)("div",{className:"p-8 flex items-center justify-center min-h-[50vh]",children:(0,n.jsx)("div",{className:"w-6 h-6 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin"})}),children:(0,n.jsx)(m,{})})}},354:function(e,t,o){"use strict";o.d(t,{FV:function(){return m},Qs:function(){return x},TH:function(){return d},dU:function(){return s},mB:function(){return i},nd:function(){return l},pD:function(){return a}});var n=o(7955),r=o(1579);let i=10485760;async function a(e,t,o,i,a){let s="users/".concat(e,"/tasks/").concat(t,"/").concat(i,"/").concat(o.name),l=(0,n.iH)(r.tO,s),d=(0,n.B0)(l,o);return new Promise((e,t)=>{d.on("state_changed",e=>{let t=Math.round(e.bytesTransferred/e.totalBytes*100);null==a||a(t)},e=>t(e),async()=>{e({downloadURL:await (0,n.Jt)(d.snapshot.ref),storagePath:s})})})}async function s(e){try{await (0,n.oq)((0,n.iH)(r.tO,e))}catch(e){}}async function l(e){await Promise.all(e.map(e=>e.storagePath?s(e.storagePath):Promise.resolve()))}function d(e,t,o){if(["image/","video/","audio/","application/pdf","text/"].some(e=>o.startsWith(e))){if(!window.open(e,"_blank")){let o=document.createElement("a");o.href=e,o.download=t,o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}else{let o=document.createElement("a");o.href=e,o.download=t,o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}let c="attachments";function u(){return new Promise((e,t)=>{let o=indexedDB.open("ai-todo-files",1);o.onupgradeneeded=()=>{o.result.createObjectStore(c)},o.onsuccess=()=>e(o.result),o.onerror=()=>t(o.error)})}async function x(e,t,o){var n,r;let i=await u(),a=await new Promise((t,o)=>{let n=i.transaction(c,"readonly").objectStore(c).get(e);n.onsuccess=()=>{var e;return t(null!==(e=n.result)&&void 0!==e?e:null)},n.onerror=()=>o(n.error)});if(!a){alert("파일을 찾을 수 없습니다.\n(다른 기기에서 추가된 파일이거나 브라우저 데이터가 삭제되었을 수 있습니다)");return}let s=a.name||t,l=a.type||o||({jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",bmp:"image/bmp",svg:"image/svg+xml",ico:"image/x-icon",avif:"image/avif",mp4:"video/mp4",webm:"video/webm",mov:"video/quicktime",avi:"video/x-msvideo",mkv:"video/x-matroska",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",flac:"audio/flac",aac:"audio/aac",m4a:"audio/mp4",pdf:"application/pdf",txt:"text/plain",md:"text/markdown",csv:"text/csv",html:"text/html",xml:"text/xml",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",doc:"application/msword",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xls:"application/vnd.ms-excel",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",ppt:"application/vnd.ms-powerpoint",zip:"application/zip","7z":"application/x-7z-compressed",rar:"application/vnd.rar",tar:"application/x-tar",gz:"application/gzip",json:"application/json",js:"text/javascript",ts:"text/typescript",py:"text/x-python",java:"text/x-java-source",c:"text/x-csrc",cpp:"text/x-c++src"})[null!==(r=null===(n=s.split(".").pop())||void 0===n?void 0:n.toLowerCase())&&void 0!==r?r:""]||"application/octet-stream",d=new Blob([a.blob],{type:l}),x=URL.createObjectURL(d);if(["image/","video/","audio/","application/pdf","text/"].some(e=>l.startsWith(e))){if(!window.open(x,"_blank")){let e=document.createElement("a");e.href=x,e.download=s,document.body.appendChild(e),e.click(),document.body.removeChild(e)}}else{let e=document.createElement("a");e.href=x,e.download=s,document.body.appendChild(e),e.click(),document.body.removeChild(e)}setTimeout(()=>URL.revokeObjectURL(x),15e3)}async function m(e){if(!e.length)return;let t=await u();return new Promise((o,n)=>{let r=t.transaction(c,"readwrite"),i=r.objectStore(c);e.forEach(e=>i.delete(e)),r.oncomplete=()=>o(),r.onerror=()=>n(r.error)})}},1730:function(e,t,o){"use strict";o.d(t,{P:function(){return c},a:function(){return u}});var n=o(6717),r=o(7387),i=o(7253),a=o(1579),s=o(1097);let l=(0,r.createContext)({tasks:[],lists:[],notes:[],folders:[],mindmaps:[],loading:!0,storageUsed:0});function d(e){return new Blob([e]).size}function c(e){let{children:t}=e,{user:o,loading:c}=(0,s.a)(),[u,x]=(0,r.useState)([]),[m,p]=(0,r.useState)([]),[h,f]=(0,r.useState)([]),[g,v]=(0,r.useState)([]),[b,w]=(0,r.useState)([]),[y,j]=(0,r.useState)(!0),k=(0,r.useRef)([]);(0,r.useEffect)(()=>{if(c)return;if(k.current.forEach(e=>e()),k.current=[],!o){x([]),p([]),f([]),v([]),w([]),j(!1);return}j(!0);let e=o.uid,t=0,n=()=>{++t>=5&&j(!1)},r=(0,i.cf)((0,i.IO)((0,i.hJ)(a.db,"users",e,"tasks"),(0,i.Xo)("createdAt","desc")),e=>{x(e.docs.map(e=>({id:e.id,...e.data()}))),n()},()=>n()),s=(0,i.cf)((0,i.hJ)(a.db,"users",e,"lists"),e=>{p(e.docs.map(e=>({id:e.id,...e.data()}))),n()},()=>n()),l=(0,i.cf)((0,i.IO)((0,i.hJ)(a.db,"users",e,"notes"),(0,i.Xo)("createdAt","desc")),e=>{f(e.docs.map(e=>({id:e.id,...e.data()}))),n()},()=>n()),d=(0,i.cf)((0,i.hJ)(a.db,"users",e,"folders"),e=>{v(e.docs.map(e=>({id:e.id,...e.data()}))),n()},()=>n()),u=(0,i.cf)((0,i.IO)((0,i.hJ)(a.db,"users",e,"mindmaps"),(0,i.Xo)("createdAt","desc")),e=>{w(e.docs.map(e=>({id:e.id,...e.data()}))),n()},()=>n());return k.current=[r,s,l,d,u],()=>{k.current.forEach(e=>e()),k.current=[]}},[o,c]);let N=function(e,t,o){var n,r,i,a;let s=0;for(let t of e){for(let e of(s+=d(t.title||"")+d(t.memo||""),null!==(n=t.subTasks)&&void 0!==n?n:[]))s+=d(e.title||"");for(let e of null!==(r=t.attachments)&&void 0!==r?r:[])s+=e.size}for(let e of t)for(let t of(s+=d(e.title||""),null!==(i=e.blocks)&&void 0!==i?i:[]))s+=d(t.content||"")+d(t.children||"");for(let e of o)for(let t of(s+=d(e.title||""),null!==(a=e.nodes)&&void 0!==a?a:[]))s+=d(t.text||""),t.imageSize&&(s+=t.imageSize);return s}(u,h,b);return(0,n.jsx)(l.Provider,{value:{tasks:u,lists:m,notes:h,folders:g,mindmaps:b,loading:y,storageUsed:N},children:t})}function u(){return(0,r.useContext)(l)}}},function(e){e.O(0,[815,419,412,936,407,809,744],function(){return e(e.s=4537)}),_N_E=e.O()}]);