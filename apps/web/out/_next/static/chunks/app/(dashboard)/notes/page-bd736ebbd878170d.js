(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[751],{8886:function(e,t,n){Promise.resolve().then(n.bind(n,9060))},9060:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var r=n(7573),l=n(7653),s=n(1695),i=n(4193),a=n(9937),o=n(6921),d=n(2052);let c=["\uD83D\uDCCB","\uD83D\uDCAC","\uD83D\uDCA1","\uD83D\uDCDD","\uD83D\uDCD6","\uD83C\uDFAF","\uD83D\uDD2C","\uD83D\uDCCA","\uD83D\uDDC2️","✏️","\uD83E\uDDE0","⚡"],x=[{type:"text",icon:"T",label:"텍스트",desc:"일반 텍스트 블록",keywords:"text paragraph"},{type:"heading1",icon:"H1",label:"제목 1",desc:"큰 제목",keywords:"heading1 h1 title"},{type:"heading2",icon:"H2",label:"제목 2",desc:"중간 제목",keywords:"heading2 h2"},{type:"heading3",icon:"H3",label:"제목 3",desc:"작은 제목",keywords:"heading3 h3"},{type:"bullet",icon:"•",label:"글머리 목록",desc:"글머리 기호 목록",keywords:"bullet list unordered"},{type:"numbered",icon:"1.",label:"번호 목록",desc:"번호가 매겨진 목록",keywords:"numbered list ordered"},{type:"todo",icon:"☑",label:"할 일",desc:"체크리스트 항목",keywords:"todo checkbox check"},{type:"quote",icon:'"',label:"인용문",desc:"인용 블록",keywords:"quote blockquote"},{type:"code",icon:"</>",label:"코드",desc:"코드 블록",keywords:"code snippet"},{type:"link",icon:"\uD83D\uDD17",label:"링크",desc:"URL 링크 블록",keywords:"link url"},{type:"toggle",icon:"▶",label:"토글",desc:"접을 수 있는 블록",keywords:"toggle collapse expand"},{type:"divider",icon:"—",label:"구분선",desc:"수평 구분선",keywords:"divider line separator hr"}];function u(){let{user:e}=(0,i.a)(),{t}=(0,a.QT)(),n=(0,s.useSearchParams)(),{notes:u,folders:p,loading:h}=(0,d.a)(),f=(0,l.useRef)(!1),[b,g]=(0,l.useState)([]),[v,k]=(0,l.useState)([]),[y,j]=(0,l.useState)([]),[N,w]=(0,l.useState)(""),[D,C]=(0,l.useState)(""),[S,I]=(0,l.useState)(!1),[T,L]=(0,l.useState)(!1),[E,P]=(0,l.useState)(""),[O,F]=(0,l.useState)(!0),[A,_]=(0,l.useState)(!1),[R,M]=(0,l.useState)(null),[z,K]=(0,l.useState)(""),[B,J]=(0,l.useState)(null),[W,H]=(0,l.useState)(""),[q,U]=(0,l.useState)(null),[X,Q]=(0,l.useState)(!1),[Z,G]=(0,l.useState)(!1),V=(0,l.useRef)(new Map),Y=(0,l.useRef)(!1),$=(0,l.useRef)(null),ee=(0,l.useRef)(""),[et,en]=(0,l.useState)(new Set),[er,el]=(0,l.useState)(new Set),[es,ei]=(0,l.useState)(null),[ea,eo]=(0,l.useState)(null),[ed,ec]=(0,l.useState)(!1),[ex,eu]=(0,l.useState)(null),[ep,em]=(0,l.useState)(""),[eh,ef]=(0,l.useState)(0),eb=(0,l.useRef)(null);(0,l.useEffect)(()=>{if(h||f.current)return;f.current=!0;let e=u.map(e=>{var t,n,r,l,s,i,a;return{id:e.id,title:e.title,icon:e.icon,blocks:e.blocks,created_at:(null===(r=e.createdAt)||void 0===r?void 0:null===(n=r.toDate)||void 0===n?void 0:null===(t=n.call(r))||void 0===t?void 0:t.toISOString())||new Date().toISOString(),updated_at:(null===(i=e.updatedAt)||void 0===i?void 0:null===(s=i.toDate)||void 0===s?void 0:null===(l=s.call(i))||void 0===l?void 0:l.toISOString())||new Date().toISOString(),pinned:e.pinned,tags:e.tags,folderId:e.folderId,linkedTaskId:e.linkedTaskId||null,linkedTaskIds:e.linkedTaskIds||[],starred:null!==(a=e.starred)&&void 0!==a&&a}});g(e);let t=n.get("note");t&&e.find(e=>e.id===t)?w(t):e.length>0&&w(e[0].id);let r=p.map(e=>{var t,n,r;return{id:e.id,name:e.name,color:e.color,icon:e.icon,parentId:null!==(t=e.parentId)&&void 0!==t?t:null,deleted:null!==(n=e.deleted)&&void 0!==n&&n,deletedAt:null!==(r=e.deletedAt)&&void 0!==r?r:null}}),l=r.filter(e=>!e.deleted),s=r.filter(e=>e.deleted);k(l),j(s),en(new Set(l.map(e=>e.id))),F(!1)},[h]);let eg=(0,l.useCallback)(async t=>{if(e)try{await (0,o.Qk)(e.uid,t.id,{title:t.title,icon:t.icon,blocks:t.blocks,pinned:t.pinned,starred:t.starred,tags:t.tags,folderId:t.folderId,linkedTaskId:t.linkedTaskId,linkedTaskIds:t.linkedTaskIds})}catch(e){console.error("Failed to save note:",e)}},[e]),ev=b.find(e=>e.id===N),ek=D?b.filter(e=>e.title.toLowerCase().includes(D.toLowerCase())||e.blocks.some(e=>e.content.toLowerCase().includes(D.toLowerCase()))):b,ey=(0,l.useRef)(null),ej=(0,l.useCallback)(e=>{ey.current&&clearTimeout(ey.current),ey.current=setTimeout(()=>{eg(e)},400)},[eg]),eN=e=>(V.current.has(e)||V.current.set(e,{past:[],future:[]}),V.current.get(e)),ew=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Y.current)return;let r=JSON.stringify(t);if(r===ee.current)return;let l=()=>{let t=eN(e);t.past.push(JSON.parse(r)),t.past.length>50&&t.past.shift(),t.future=[],ee.current=r};n?($.current&&(clearTimeout($.current),$.current=null),l()):($.current||l(),$.current&&clearTimeout($.current),$.current=setTimeout(()=>{$.current=null},500))},eD=()=>{if(!ev)return;let e=eN(ev.id);if(!e.past.length)return;let t=e.past.pop();e.future.push(JSON.parse(JSON.stringify(ev.blocks))),Y.current=!0,g(e=>{let n=e.map(e=>e.id===ev.id?{...e,blocks:t,updated_at:new Date().toISOString()}:e),r=n.find(e=>e.id===ev.id);return r&&ej(r),n}),Y.current=!1},eC=()=>{if(!ev)return;let e=eN(ev.id);if(!e.future.length)return;let t=e.future.pop();e.past.push(JSON.parse(JSON.stringify(ev.blocks))),Y.current=!0,g(e=>{let n=e.map(e=>e.id===ev.id?{...e,blocks:t,updated_at:new Date().toISOString()}:e),r=n.find(e=>e.id===ev.id);return r&&ej(r),n}),Y.current=!1},eS=!!ev&&eN(ev.id).past.length>0,eI=!!ev&&eN(ev.id).future.length>0;(0,l.useEffect)(()=>{let e=e=>{ev&&!X&&((e.ctrlKey||e.metaKey)&&"z"===e.key&&!e.shiftKey&&(e.preventDefault(),eD()),(e.ctrlKey||e.metaKey)&&("y"===e.key||"z"===e.key&&e.shiftKey)&&(e.preventDefault(),eC()))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)});let eT=async t=>{let n=Date.now().toString(),r={id:n,title:"제목 없음",icon:"\uD83D\uDCDD",blocks:[{id:"".concat(Date.now(),"-b1"),type:"text",content:""}],created_at:new Date().toISOString(),updated_at:new Date().toISOString(),pinned:!1,starred:!1,tags:[],folderId:null!=t?t:null,linkedTaskId:null,linkedTaskIds:[]};if(g(e=>[r,...e]),w(n),e)try{let t=await (0,o.AL)(e.uid,{title:r.title,icon:r.icon,blocks:r.blocks,pinned:r.pinned,tags:r.tags,folderId:r.folderId,linkedTaskId:r.linkedTaskId,linkedTaskIds:r.linkedTaskIds});g(e=>e.map(e=>e.id===n?{...e,id:t}:e)),w(t)}catch(e){console.error("Failed to create note:",e)}},eL=async t=>{if(g(e=>e.filter(e=>e.id!==t)),N===t){var n;w((null===(n=b.filter(e=>e.id!==t)[0])||void 0===n?void 0:n.id)||"")}if(e)try{await (0,o.f_)(e.uid,t)}catch(e){console.error("Failed to delete note:",e)}},eE=e=>{g(t=>{let n=t.map(t=>t.id===N?{...t,title:e,updated_at:new Date().toISOString()}:t),r=n.find(e=>e.id===N);return r&&ej(r),n})},eP=e=>{g(t=>{let n=t.map(t=>t.id===N?{...t,icon:e}:t),r=n.find(e=>e.id===N);return r&&ej(r),n}),I(!1)},eO=e=>{g(t=>{let n=t.map(t=>t.id===e?{...t,pinned:!t.pinned}:t),r=n.find(t=>t.id===e);return r&&eg(r),n})},eF=e=>{g(t=>{let n=t.map(t=>t.id===e?{...t,starred:!t.starred}:t),r=n.find(t=>t.id===e);return r&&eg(r),n})},eA=(e,t)=>{g(n=>{let r=n.map(n=>n.id===e?{...n,folderId:t}:n),l=r.find(t=>t.id===e);return l&&eg(l),r})},e_=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0,r=(null!=n?n:E).trim();if(!r)return;let l=["#e94560","#8b5cf6","#06b6d4","#22c55e","#f59e0b","#ec4899"],s=["\uD83D\uDCC1","\uD83D\uDCC2","\uD83D\uDDC2️","\uD83D\uDCE6"],i=Date.now().toString(),a={id:i,name:r,color:l[v.length%l.length],icon:s[v.length%s.length],parentId:t};if(k(e=>[...e,a]),en(e=>new Set([...e,i])),n||(P(""),L(!1)),J(null),H(""),e)try{let n=await (0,o.oN)(e.uid,{name:r,color:a.color,icon:a.icon,parentId:t});k(e=>e.map(e=>e.id===i?{...e,id:n}:e)),en(e=>{let t=new Set(e);return t.delete(i),t.add(n),t})}catch(e){console.error("Failed to create folder:",e)}},eR=async t=>{if(!z.trim()){M(null);return}if(k(e=>e.map(e=>e.id===t?{...e,name:z.trim()}:e)),M(null),e)try{await (0,o.Tb)(e.uid,t,{name:z.trim()})}catch(e){console.error("Failed to rename folder:",e)}},eM=async t=>{let n=v.find(e=>e.id===t);if(!n)return;let r={...n,deleted:!0,deletedAt:new Date().toISOString()};if(k(e=>e.filter(e=>e.id!==t)),j(e=>[...e,r]),en(e=>{let n=new Set(e);return n.delete(t),n}),e)try{await (0,o.Go)(e.uid,t)}catch(e){console.error("Failed to move folder to trash:",e)}},ez=async t=>{let n=y.find(e=>e.id===t);if(!n)return;let r={...n,deleted:!1,deletedAt:null};if(j(e=>e.filter(e=>e.id!==t)),k(e=>[...e,r]),en(e=>new Set([...e,t])),e)try{await (0,o.zR)(e.uid,t)}catch(e){console.error("Failed to restore folder:",e)}},eK=async t=>{if(j(e=>e.filter(e=>e.id!==t)),e)try{await (0,o.Ff)(e.uid,t)}catch(e){console.error("Failed to permanently delete folder:",e)}},eB=async(t,n)=>{if(k(e=>e.map(e=>e.id===t?{...e,parentId:n}:e)),U(null),e)try{await (0,o.Tb)(e.uid,t,{parentId:n})}catch(e){console.error("Failed to move folder:",e)}},eJ=e=>{en(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},eW=(e,t)=>{g(n=>{let r=n.find(e=>e.id===N);r&&ew(N,r.blocks);let l=n.map(n=>n.id===N?{...n,updated_at:new Date().toISOString(),blocks:n.blocks.map(n=>n.id===e?{...n,content:t}:n)}:n),s=l.find(e=>e.id===N);return s&&ej(s),l})},eH=(e,t)=>{g(n=>{let r=n.find(e=>e.id===N);r&&ew(N,r.blocks);let l=n.map(n=>n.id===N?{...n,blocks:n.blocks.map(n=>n.id===e?{...n,...t}:n)}:n),s=l.find(e=>e.id===N);return s&&ej(s),l})},eq=e=>{g(t=>{let n=t.find(e=>e.id===N);n&&ew(N,n.blocks,!0);let r=t.map(t=>t.id===N?{...t,blocks:t.blocks.map(t=>t.id===e?{...t,checked:!t.checked}:t)}:t),l=r.find(e=>e.id===N);return l&&ej(l),r})},eU=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text",n={id:"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,6)),type:t,content:"",..."todo"===t&&{checked:!1},..."toggle"===t&&{children:""}};g(t=>{let r=t.find(e=>e.id===N);r&&ew(N,r.blocks,!0);let l=t.map(t=>{if(t.id!==N)return t;let r=t.blocks.findIndex(t=>t.id===e),l=[...t.blocks];return l.splice(r+1,0,n),{...t,blocks:l,updated_at:new Date().toISOString()}}),s=l.find(e=>e.id===N);return s&&ej(s),l}),setTimeout(()=>{let e=document.querySelector('[data-block-id="'.concat(n.id,'"]'));null==e||e.focus()},50)},eX=e=>{g(t=>{let n=t.find(e=>e.id===N);n&&ew(N,n.blocks,!0);let r=t.map(t=>t.id!==N||t.blocks.length<=1?t:{...t,blocks:t.blocks.filter(t=>t.id!==e)}),l=r.find(e=>e.id===N);return l&&ej(l),r})},eQ=(e,t)=>{g(n=>{let r=n.find(e=>e.id===N);r&&ew(N,r.blocks,!0);let l=n.map(n=>n.id===N?{...n,blocks:n.blocks.map(n=>n.id===e?{...n,type:t,..."todo"===t?{checked:!1}:{},..."toggle"===t?{children:""}:{},..."link"===t?{url:""}:{}}:n)}:n),s=l.find(e=>e.id===N);return s&&ej(s),l})},eZ=x.filter(e=>{if(!ep)return!0;let t=ep.toLowerCase();return e.label.toLowerCase().includes(t)||e.keywords.includes(t)||e.type.includes(t)}),eG=e=>{ex&&(eQ(ex,e),eW(ex,"")),ec(!1),eu(null),em(""),ef(0)},eV=(e,t)=>{if(ed&&ex===t.id){if("ArrowDown"===e.key){e.preventDefault(),ef(e=>Math.min(e+1,eZ.length-1));return}if("ArrowUp"===e.key){e.preventDefault(),ef(e=>Math.max(e-1,0));return}if("Enter"===e.key){e.preventDefault(),eZ[eh]&&eG(eZ[eh].type);return}if("Escape"===e.key){e.preventDefault(),ec(!1),eu(null),em("");return}}if("Enter"===e.key&&!e.shiftKey){if(ed)return;e.preventDefault();let n=["todo","bullet","numbered"].includes(t.type)?t.type:"text";eU(t.id,n)}if("Backspace"===e.key&&""===t.content&&(e.preventDefault(),"text"!==t.type?eQ(t.id,"text"):eX(t.id))," "===e.key&&"text"===t.type){let n=t.content;"#"===n?(eQ(t.id,"heading1"),eW(t.id,""),e.preventDefault()):"##"===n?(eQ(t.id,"heading2"),eW(t.id,""),e.preventDefault()):"###"===n?(eQ(t.id,"heading3"),eW(t.id,""),e.preventDefault()):"-"===n||"*"===n?(eQ(t.id,"bullet"),eW(t.id,""),e.preventDefault()):"1."===n?(eQ(t.id,"numbered"),eW(t.id,""),e.preventDefault()):"[]"===n||"[ ]"===n?(eQ(t.id,"todo"),eW(t.id,""),e.preventDefault()):">"===n?(eQ(t.id,"quote"),eW(t.id,""),e.preventDefault()):"---"===n?(eQ(t.id,"divider"),eW(t.id,""),e.preventDefault()):"```"===n?(eQ(t.id,"code"),eW(t.id,""),e.preventDefault()):"[["===n?(eQ(t.id,"link"),eW(t.id,""),e.preventDefault()):">>"===n&&(eQ(t.id,"toggle"),eW(t.id,""),e.preventDefault())}},eY=(e,t)=>{eW(e,t),"/"===t?(ec(!0),eu(e),em(""),ef(0)):t.startsWith("/")&&ed&&ex===e?(em(t.slice(1)),ef(0)):ed&&ex===e&&!t.startsWith("/")&&(ec(!1),eu(null),em(""))},e$=(e,t)=>{ei(t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(t))},e0=(e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",eo(t)},e1=()=>{ei(null),eo(null)},e2=(e,t)=>{e.preventDefault(),e1(),null!==es&&es!==t&&ev&&g(e=>{let n=e.find(e=>e.id===N);n&&ew(N,n.blocks,!0);let r=e.map(e=>{if(e.id!==N)return e;let n=[...e.blocks],[r]=n.splice(es,1);return n.splice(t,0,r),{...e,blocks:n,updated_at:new Date().toISOString()}}),l=r.find(e=>e.id===N);return l&&ej(l),r})},e5=e=>{let t=new Date(e),n=Math.floor((Date.now()-t.getTime())/6e4),r=Math.floor(n/60),l=Math.floor(r/24);return n<1?"방금 전":n<60?"".concat(n,"분 전"):r<24?"".concat(r,"시간 전"):l<7?"".concat(l,"일 전"):t.toLocaleDateString("ko-KR",{month:"short",day:"numeric"})},e4=e=>{e.style.height="auto",e.style.height=e.scrollHeight+"px"},e3=e=>{var t,n,l;let s="w-full bg-transparent outline-none resize-none text-text-primary placeholder-text-inactive",i=(t,n)=>({"data-block-id":e.id,value:e.content,onChange:t=>{eY(e.id,t.target.value),e4(t.target)},onKeyDown:t=>eV(t,e),onFocus:e=>e4(e.target),placeholder:X?"":n,rows:1,readOnly:X,className:"".concat(s," ").concat(t," ").concat(X?"cursor-default":"")});switch(e.type){case"heading1":return(0,r.jsx)("textarea",{...i("text-3xl font-extrabold","제목 1")});case"heading2":return(0,r.jsx)("textarea",{...i("text-xl font-bold","제목 2")});case"heading3":return(0,r.jsx)("textarea",{...i("text-lg font-semibold","제목 3")});case"bullet":return(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-[#e94560] mt-1 select-none text-lg leading-none",children:"•"}),(0,r.jsx)("textarea",{...i("text-sm flex-1","리스트 항목")})]});case"numbered":return(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-[#8b5cf6] text-sm mt-0.5 select-none min-w-[1.5em] text-right font-bold",children:(()=>{if(!ev)return"1.";let t=ev.blocks.filter(e=>"numbered"===e.type).findIndex(t=>t.id===e.id);return"".concat(t+1,".")})()}),(0,r.jsx)("textarea",{...i("text-sm flex-1","번호 목록")})]});case"todo":return(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("button",{onClick:()=>eq(e.id),className:"w-5 h-5 mt-0.5 rounded-md border-2 flex items-center justify-center transition-all duration-300 flex-shrink-0 ".concat(e.checked?"bg-gradient-to-br from-[#e94560] to-[#533483] border-transparent":"hover:border-[#e94560]"),style:e.checked?void 0:{borderColor:"var(--color-checkbox-border)"},children:e.checked&&(0,r.jsx)("svg",{width:"10",height:"10",viewBox:"0 0 14 14",fill:"none",children:(0,r.jsx)("path",{d:"M3 7L6 10L11 4",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,r.jsx)("textarea",{...i("text-sm flex-1 ".concat(e.checked?"line-through text-text-inactive":""),"할 일")})]});case"quote":return(0,r.jsxs)("div",{className:"flex items-stretch gap-0 bg-[#e94560]/5 rounded-r-lg py-1",children:[(0,r.jsx)("div",{className:"w-[3px] bg-gradient-to-b from-[#e94560] to-[#533483] rounded-full flex-shrink-0 mr-3"}),(0,r.jsx)("textarea",{...i("text-sm italic text-text-secondary flex-1 bg-transparent","인용문")})]});case"divider":return(0,r.jsx)("div",{className:"py-2",children:(0,r.jsx)("div",{className:"h-px bg-gradient-to-r from-transparent via-border to-transparent"})});case"code":return(0,r.jsxs)("div",{className:"bg-background border border-border rounded-lg p-3 relative",children:[(0,r.jsx)("div",{className:"absolute top-2 right-2 text-[9px] text-text-inactive font-mono",children:"CODE"}),(0,r.jsx)("textarea",{"data-block-id":e.id,value:e.content,onChange:t=>eY(e.id,t.target.value),onKeyDown:t=>{"Enter"===t.key&&t.stopPropagation(),"Tab"===t.key&&(t.preventDefault(),eW(e.id,e.content+"  "))},placeholder:"코드를 입력하세요...",rows:Math.max(3,e.content.split("\n").length),className:"".concat(s," text-xs font-mono leading-relaxed resize-none")})]});case"link":return(0,r.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-background border border-border rounded-lg group",children:[(0,r.jsx)("span",{className:"text-[#3b82f6] flex-shrink-0",children:"\uD83D\uDD17"}),(0,r.jsx)("textarea",{...i("text-sm text-[#3b82f6] underline flex-1","링크 제목")}),(0,r.jsx)("input",{value:null!==(t=e.url)&&void 0!==t?t:"",onChange:t=>eH(e.id,{url:t.target.value}),placeholder:"https://...",className:"text-[11px] text-text-muted bg-transparent outline-none border-l border-border pl-2 w-40 shrink-0"}),e.url&&(0,r.jsx)("button",{onClick:()=>window.open(e.url,"_blank","noopener,noreferrer"),className:"text-[10px] px-2 py-0.5 bg-[#3b82f6]/20 text-[#3b82f6] rounded font-semibold flex-shrink-0",children:"열기"})]});case"toggle":return(0,r.jsxs)("div",{className:"rounded-lg overflow-hidden border border-border/60",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-background/50 cursor-pointer group/toggle",onClick:()=>el(t=>{let n=new Set(t);return n.has(e.id)?n.delete(e.id):n.add(e.id),n}),children:[(0,r.jsx)("span",{className:"text-text-muted transition-transform text-xs ".concat(er.has(e.id)?"rotate-90":""),children:"▶"}),(0,r.jsx)("textarea",{"data-block-id":e.id,value:e.content,onChange:t=>{t.stopPropagation(),eY(e.id,t.target.value),e4(t.target)},onKeyDown:t=>{t.stopPropagation(),eV(t,e)},onClick:e=>e.stopPropagation(),onFocus:e=>e4(e.target),placeholder:"토글 제목...",rows:1,className:"".concat(s," text-sm font-semibold flex-1")})]}),er.has(e.id)&&(0,r.jsx)("div",{className:"px-3 py-2 border-t border-border/40 bg-background/20",children:(0,r.jsx)("textarea",{value:null!==(n=e.children)&&void 0!==n?n:"",onChange:t=>{eH(e.id,{children:t.target.value}),e4(t.target)},onFocus:e=>e4(e.target),placeholder:"내용을 입력하세요...",rows:Math.max(2,(null!==(l=e.children)&&void 0!==l?l:"").split("\n").length),className:"".concat(s," text-sm resize-none leading-relaxed")})})]});default:return(0,r.jsx)("textarea",{...i("text-sm","텍스트를 입력하세요... ( / 로 블록 타입 선택)")})}};if((0,l.useEffect)(()=>{if(!ed)return;let e=e=>{eb.current&&!eb.current.contains(e.target)&&(ec(!1),eu(null))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ed]),O)return(0,r.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-8 h-8 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-text-secondary text-sm",children:t("common.loading")})]})});let e6=ek.filter(e=>e.pinned),e9=e=>ek.filter(t=>t.folderId===e&&!t.pinned),e8=ek.filter(e=>null===e.folderId&&!e.pinned);return(0,r.jsxs)("div",{className:"flex h-full",children:[(0,r.jsxs)("div",{className:"border-r border-border bg-background flex flex-col flex-shrink-0 ".concat(N?"hidden md:flex md:w-72":"flex w-full md:w-72"),children:[(0,r.jsxs)("div",{className:"p-4 border-b border-border",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-lg",children:"\uD83D\uDCDD"}),(0,r.jsx)("h2",{className:"text-lg font-bold text-text-primary",children:t("notes.title")}),(0,r.jsx)("span",{className:"text-xs text-text-muted bg-border px-2 py-0.5 rounded-full",children:ek.length})]}),(0,r.jsx)("button",{onClick:()=>eT(),className:"w-8 h-8 flex items-center justify-center bg-[#e94560] hover:bg-[#ff5a7a] text-white rounded-lg transition-colors text-lg",children:"+"})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,r.jsx)("input",{type:"text",value:D,onChange:e=>C(e.target.value),placeholder:t("notes.search"),className:"w-full pl-9 pr-3 py-2 bg-background-card border border-border rounded-lg text-xs text-text-primary placeholder-text-muted focus:outline-none focus:border-[#e94560] transition-colors"})]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto py-2",children:[e6.length>0&&(0,r.jsxs)("div",{className:"mb-1",children:[(0,r.jsxs)("div",{className:"text-[9px] text-text-muted uppercase tracking-widest font-semibold px-4 py-1",children:["\uD83D\uDCCC ",t("notes.pinned")]}),e6.map(e=>(0,r.jsx)(m,{note:e,isActive:e.id===N,onClick:()=>w(e.id),onDelete:()=>eL(e.id),onTogglePin:()=>eO(e.id),onToggleStar:()=>eF(e.id),getRelativeTime:e5,indent:0},e.id))]}),v.filter(e=>!e.parentId).map(e=>{let n=e9(e.id),l=v.filter(t=>t.parentId===e.id),s=et.has(e.id);e.id;let i=v.filter(t=>!t.parentId&&t.id!==e.id);return(0,r.jsxs)("div",{className:"mb-0.5",children:[(0,r.jsxs)("div",{className:"group flex items-center gap-1 px-3 py-1.5 hover:bg-background-card/60 transition-colors cursor-pointer rounded-lg mx-2",children:[(0,r.jsxs)("button",{onClick:()=>eJ(e.id),className:"flex items-center gap-1.5 flex-1 min-w-0",children:[(0,r.jsx)("span",{className:"text-text-muted transition-transform text-[10px] flex-shrink-0 ".concat(s?"rotate-90":""),children:"▶"}),(0,r.jsx)("span",{className:"text-sm flex-shrink-0",children:e.icon}),R===e.id?(0,r.jsx)("input",{value:z,onChange:e=>K(e.target.value),onBlur:()=>eR(e.id),onKeyDown:t=>{"Enter"===t.key&&eR(e.id),"Escape"===t.key&&M(null)},onClick:e=>e.stopPropagation(),autoFocus:!0,className:"flex-1 text-xs font-semibold bg-transparent outline-none border-b border-[#e94560] min-w-0",style:{color:e.color}}):(0,r.jsx)("span",{className:"text-xs font-semibold truncate flex-1",style:{color:e.color},onDoubleClick:t=>{t.stopPropagation(),M(e.id),K(e.name)},children:e.name}),(0,r.jsx)("span",{className:"text-[10px] text-text-inactive flex-shrink-0",children:n.length+l.length})]}),(0,r.jsxs)("div",{className:"opacity-0 group-hover:opacity-100 flex items-center gap-0.5 flex-shrink-0",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eT(e.id),s||eJ(e.id)},className:"w-5 h-5 flex items-center justify-center text-text-muted hover:text-[#22c55e] transition-all text-sm",title:"노트 추가",children:"+"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),J(e.id),H("")},className:"w-5 h-5 flex items-center justify-center text-text-muted hover:text-[#8b5cf6] transition-all text-[10px]",title:"하위폴더 추가",children:"\uD83D\uDCC1"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eM(e.id)},className:"w-5 h-5 flex items-center justify-center text-text-muted hover:text-[#e94560] transition-all text-xs",title:"휴지통으로 이동",children:"\xd7"})]})]}),B===e.id&&(0,r.jsxs)("div",{className:"flex gap-1 pl-8 pr-3 py-1",children:[(0,r.jsx)("input",{value:W,onChange:e=>H(e.target.value),onKeyDown:t=>{"Enter"===t.key&&e_(e.id,W),"Escape"===t.key&&J(null)},placeholder:"하위폴더 이름...",autoFocus:!0,className:"flex-1 px-2 py-1 bg-background-card border border-[#8b5cf6]/40 rounded text-[11px] text-text-primary placeholder-text-muted focus:outline-none"}),(0,r.jsx)("button",{onClick:()=>e_(e.id,W),className:"px-2 py-1 bg-[#8b5cf6] text-white rounded text-[10px]",children:"추가"}),(0,r.jsx)("button",{onClick:()=>J(null),className:"px-1 py-1 text-text-muted text-[10px]",children:"취소"})]}),s&&l.map(e=>{let n=e9(e.id),l=et.has(e.id),s=q===e.id;return(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsxs)("div",{className:"group flex items-center gap-1 px-3 py-1.5 hover:bg-background-card/60 transition-colors cursor-pointer rounded-lg mx-2",children:[(0,r.jsxs)("button",{onClick:()=>eJ(e.id),className:"flex items-center gap-1.5 flex-1 min-w-0",children:[(0,r.jsx)("span",{className:"text-text-muted transition-transform text-[10px] flex-shrink-0 ".concat(l?"rotate-90":""),children:"▶"}),(0,r.jsx)("span",{className:"text-xs flex-shrink-0",children:e.icon}),R===e.id?(0,r.jsx)("input",{value:z,onChange:e=>K(e.target.value),onBlur:()=>eR(e.id),onKeyDown:t=>{"Enter"===t.key&&eR(e.id),"Escape"===t.key&&M(null)},onClick:e=>e.stopPropagation(),autoFocus:!0,className:"flex-1 text-xs font-semibold bg-transparent outline-none border-b border-[#e94560] min-w-0",style:{color:e.color}}):(0,r.jsx)("span",{className:"text-xs font-semibold truncate flex-1",style:{color:e.color},onDoubleClick:t=>{t.stopPropagation(),M(e.id),K(e.name)},children:e.name}),(0,r.jsx)("span",{className:"text-[10px] text-text-inactive flex-shrink-0",children:n.length})]}),(0,r.jsxs)("div",{className:"opacity-0 group-hover:opacity-100 flex items-center gap-0.5 flex-shrink-0",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eT(e.id),l||eJ(e.id)},className:"w-5 h-5 flex items-center justify-center text-text-muted hover:text-[#22c55e] transition-all text-sm",title:"노트 추가",children:"+"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),U(s?null:e.id)},className:"w-5 h-5 flex items-center justify-center text-text-muted hover:text-[#06b6d4] transition-all text-[10px]",title:"이동",children:"↕"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eM(e.id)},className:"w-5 h-5 flex items-center justify-center text-text-muted hover:text-[#e94560] transition-all text-xs",title:"휴지통으로 이동",children:"\xd7"})]})]}),s&&(0,r.jsxs)("div",{className:"ml-6 mr-3 mb-1 p-2 bg-background-card border border-[#06b6d4]/30 rounded-lg",children:[(0,r.jsx)("p",{className:"text-[10px] text-text-muted mb-1.5",children:"이동할 위치 선택:"}),(0,r.jsx)("button",{onClick:()=>eB(e.id,null),className:"block w-full text-left text-[11px] text-text-secondary hover:text-text-primary py-0.5 px-1 rounded hover:bg-background-hover",children:"\uD83D\uDCC2 루트로 이동"}),i.filter(t=>t.id!==e.id).map(t=>(0,r.jsxs)("button",{onClick:()=>eB(e.id,t.id),className:"block w-full text-left text-[11px] py-0.5 px-1 rounded hover:bg-background-hover",style:{color:t.color},children:[t.icon," ",t.name]},t.id)),(0,r.jsx)("button",{onClick:()=>U(null),className:"text-[10px] text-text-muted mt-1",children:"취소"})]}),l&&n.map(e=>(0,r.jsx)(m,{note:e,isActive:e.id===N,onClick:()=>w(e.id),onDelete:()=>eL(e.id),onTogglePin:()=>eO(e.id),onToggleStar:()=>eF(e.id),getRelativeTime:e5,indent:2},e.id)),l&&0===n.length&&(0,r.jsx)("p",{className:"text-[11px] text-text-inactive pl-16 py-0.5",children:t("notes.noNotes")})]},e.id)}),s&&n.map(e=>(0,r.jsx)(m,{note:e,isActive:e.id===N,onClick:()=>w(e.id),onDelete:()=>eL(e.id),onTogglePin:()=>eO(e.id),onToggleStar:()=>eF(e.id),getRelativeTime:e5,indent:1},e.id)),s&&0===n.length&&0===l.length&&(0,r.jsx)("p",{className:"text-[11px] text-text-inactive pl-12 py-1",children:t("notes.noNotes")})]},e.id)}),e8.length>0&&(0,r.jsxs)("div",{className:"mt-1",children:[v.length>0&&(0,r.jsx)("div",{className:"text-[9px] text-text-muted uppercase tracking-widest font-semibold px-4 py-1 mt-2",children:t("notes.other")}),e8.map(e=>(0,r.jsx)(m,{note:e,isActive:e.id===N,onClick:()=>w(e.id),onDelete:()=>eL(e.id),onTogglePin:()=>eO(e.id),onToggleStar:()=>eF(e.id),getRelativeTime:e5,indent:0},e.id))]}),0===ek.length&&(0,r.jsx)("div",{className:"text-center py-12 text-text-muted text-sm",children:D?"검색 결과가 없습니다":"노트가 없습니다"}),(0,r.jsx)("div",{className:"px-3 mt-3",children:T?(0,r.jsxs)("div",{className:"flex gap-1.5",children:[(0,r.jsx)("input",{type:"text",value:E,onChange:e=>P(e.target.value),onKeyDown:e=>"Enter"===e.key&&e_(),placeholder:"폴더 이름...",autoFocus:!0,className:"flex-1 px-2.5 py-1.5 bg-background-card border border-border rounded-lg text-xs text-text-primary placeholder-text-muted focus:outline-none focus:border-[#e94560]"}),(0,r.jsx)("button",{onClick:()=>e_(),className:"px-2.5 py-1.5 bg-[#e94560] text-white rounded-lg text-[10px] font-semibold",children:t("common.add")}),(0,r.jsx)("button",{onClick:()=>L(!1),className:"px-2 py-1.5 text-text-muted text-[10px]",children:t("common.cancel")})]}):(0,r.jsxs)("button",{onClick:()=>L(!0),className:"text-[11px] text-text-inactive hover:text-text-secondary transition-colors flex items-center gap-1",children:[(0,r.jsx)("span",{children:"+"})," ",t("notes.newFolder")]})}),y.length>0&&(0,r.jsxs)("div",{className:"px-3 mt-4 border-t border-border pt-3",children:[(0,r.jsxs)("button",{onClick:()=>_(!A),className:"flex items-center gap-1.5 text-[11px] text-text-muted hover:text-text-secondary transition-colors w-full",children:[(0,r.jsx)("span",{className:"text-[9px] transition-transform ".concat(A?"rotate-90":""),children:"▶"}),(0,r.jsx)("span",{children:"\uD83D\uDDD1️ 휴지통"}),(0,r.jsx)("span",{className:"ml-auto text-[10px] bg-border px-1.5 py-0.5 rounded-full",children:y.length})]}),A&&(0,r.jsx)("div",{className:"mt-1.5 space-y-1",children:y.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded-lg bg-background-card/50 group",children:[(0,r.jsx)("span",{className:"text-xs flex-shrink-0 opacity-50",children:e.icon}),(0,r.jsx)("span",{className:"text-[11px] text-text-muted truncate flex-1",children:e.name}),(0,r.jsx)("button",{onClick:()=>ez(e.id),className:"opacity-0 group-hover:opacity-100 text-[10px] text-[#22c55e] hover:text-[#16a34a] transition-all px-1.5 py-0.5 rounded border border-[#22c55e]/30 flex-shrink-0",title:"복원",children:"복원"}),(0,r.jsx)("button",{onClick:()=>eK(e.id),className:"opacity-0 group-hover:opacity-100 w-4 h-4 flex items-center justify-center text-text-muted hover:text-[#e94560] transition-all text-xs flex-shrink-0",title:"영구 삭제",children:"\xd7"})]},e.id))})]})]})]}),ev?(0,r.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,r.jsxs)("div",{className:"border-b border-border bg-background/50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 md:px-6 py-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 md:gap-3 text-xs text-text-muted min-w-0",children:[(0,r.jsx)("button",{onClick:()=>w(""),className:"md:hidden flex items-center text-text-secondary hover:text-text-primary transition-colors flex-shrink-0",title:"목록으로",children:(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:(0,r.jsx)("path",{d:"M10 3L5 8L10 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,r.jsxs)("span",{className:"truncate hidden md:inline",children:["수정됨 ",e5(ev.updated_at)]}),(0,r.jsx)("span",{className:"hidden md:inline",children:"\xb7"}),(0,r.jsxs)("span",{className:"hidden md:inline",children:[ev.blocks.length," 블록"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,r.jsx)("button",{onClick:eD,disabled:!eS||X,title:"되돌리기 (Ctrl+Z)",className:"w-7 h-7 flex items-center justify-center text-text-inactive hover:text-text-primary hover:bg-border rounded transition-colors disabled:opacity-20 disabled:cursor-not-allowed",children:(0,r.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("polyline",{points:"1 4 1 10 7 10"}),(0,r.jsx)("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})]})}),(0,r.jsx)("button",{onClick:eC,disabled:!eI||X,title:"다시 실행 (Ctrl+Shift+Z)",className:"w-7 h-7 flex items-center justify-center text-text-inactive hover:text-text-primary hover:bg-border rounded transition-colors disabled:opacity-20 disabled:cursor-not-allowed",children:(0,r.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("polyline",{points:"23 4 23 10 17 10"}),(0,r.jsx)("path",{d:"M20.49 15a9 9 0 1 1-2.13-9.36L23 10"})]})}),(0,r.jsx)("div",{className:"w-px h-4 bg-border mx-1"}),(0,r.jsx)("button",{onClick:()=>Q(!X),title:X?"쓰기 모드로 전환":"읽기 모드로 전환",className:"h-7 px-2 md:px-2.5 flex items-center gap-1 md:gap-1.5 rounded-lg text-[11px] font-semibold transition-all ".concat(X?"bg-[#8b5cf6]/15 text-[#8b5cf6] border border-[#8b5cf6]/30":"bg-[#22c55e]/15 text-[#22c55e] border border-[#22c55e]/30"),children:X?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,r.jsx)("circle",{cx:"12",cy:"12",r:"3"})]}),(0,r.jsx)("span",{className:"hidden md:inline",children:" 읽기"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,r.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),(0,r.jsx)("span",{className:"hidden md:inline",children:" 쓰기"})]})}),!X&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-px h-4 bg-border mx-1 hidden md:block"}),(0,r.jsx)("div",{className:"hidden md:flex items-center gap-0.5",children:[{type:"text",label:"T",title:"텍스트"},{type:"heading2",label:"H",title:"제목"},{type:"bullet",label:"•",title:"글머리"},{type:"todo",label:"☑",title:"할 일"},{type:"quote",label:'"',title:"인용"},{type:"code",label:"</>",title:"코드"},{type:"link",label:"\uD83D\uDD17",title:"링크 ([[)"},{type:"toggle",label:"▶",title:"토글 (>>)"},{type:"divider",label:"—",title:"구분선"}].map(e=>(0,r.jsx)("button",{onClick:()=>{eU(ev.blocks[ev.blocks.length-1].id,e.type)},title:e.title,className:"w-7 h-7 flex items-center justify-center text-text-inactive hover:text-text-primary hover:bg-border rounded transition-colors text-[11px] font-mono",children:e.label},e.type))})]}),!X&&(0,r.jsx)("button",{onClick:()=>G(!Z),className:"md:hidden w-7 h-7 flex items-center justify-center rounded transition-colors text-[11px] ".concat(Z?"bg-[#e94560]/15 text-[#e94560]":"text-text-inactive hover:text-text-primary hover:bg-border"),title:"블록 추가",children:(0,r.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,r.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),(0,r.jsx)("div",{className:"w-px h-4 bg-border mx-1 hidden md:block"}),(0,r.jsxs)("select",{value:ev.folderId||"",onChange:e=>eA(ev.id,e.target.value||null),className:"hidden md:block h-7 px-2 bg-background-card text-text-muted text-[10px] border border-border rounded-lg focus:outline-none cursor-pointer",children:[(0,r.jsx)("option",{value:"",children:"폴더 없음"}),v.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.icon," ",e.name]},e.id))]})]})]}),Z&&!X&&(0,r.jsxs)("div",{className:"md:hidden flex items-center gap-1 px-4 pb-2 flex-wrap",children:[[{type:"text",label:"T",title:"텍스트"},{type:"heading2",label:"H",title:"제목"},{type:"bullet",label:"•",title:"글머리"},{type:"todo",label:"☑",title:"할 일"},{type:"quote",label:'"',title:"인용"},{type:"code",label:"</>",title:"코드"},{type:"link",label:"\uD83D\uDD17",title:"링크"},{type:"toggle",label:"▶",title:"토글"},{type:"divider",label:"—",title:"구분선"}].map(e=>(0,r.jsxs)("button",{onClick:()=>{eU(ev.blocks[ev.blocks.length-1].id,e.type),G(!1)},className:"h-8 px-2.5 flex items-center gap-1.5 text-text-inactive hover:text-text-primary bg-background-card hover:bg-border border border-border rounded-lg transition-colors text-[11px]",children:[(0,r.jsx)("span",{className:"font-mono",children:e.label}),(0,r.jsx)("span",{className:"text-[10px] text-text-muted",children:e.title})]},e.type)),(0,r.jsxs)("select",{value:ev.folderId||"",onChange:e=>eA(ev.id,e.target.value||null),className:"h-8 px-2 bg-background-card text-text-muted text-[10px] border border-border rounded-lg focus:outline-none cursor-pointer",children:[(0,r.jsx)("option",{value:"",children:"폴더 없음"}),v.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.icon," ",e.name]},e.id))]})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto px-8 py-6",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"relative inline-block mb-2",children:[(0,r.jsx)("button",{onClick:()=>!X&&I(!S),className:"text-4xl transition-transform ".concat(X?"":"hover:scale-110"),children:ev.icon}),S&&(0,r.jsx)("div",{className:"absolute top-12 left-0 bg-background-card border border-border rounded-xl p-3 shadow-xl z-10 min-w-[240px]",children:(0,r.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, 36px)",gap:"4px"},children:c.map(e=>(0,r.jsx)("button",{onClick:()=>eP(e),style:{width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",borderRadius:"8px"},className:"hover:bg-border transition-colors",children:e},e))})})]}),(0,r.jsx)("input",{value:ev.title,onChange:e=>eE(e.target.value),placeholder:"제목 없음",readOnly:X,className:"w-full bg-transparent text-3xl font-extrabold text-text-primary placeholder-text-inactive outline-none ".concat(X?"cursor-default":"")}),(0,r.jsx)("div",{className:"flex items-center gap-2 mt-3 flex-wrap",children:ev.tags.map(e=>(0,r.jsx)("span",{className:"px-2.5 py-0.5 bg-[#e94560]/10 text-[#e94560] text-[10px] font-semibold rounded-full border border-[#e94560]/20",children:e},e))})]}),(0,r.jsx)("div",{className:"space-y-0.5 relative",children:ev.blocks.map((e,t)=>(0,r.jsxs)("div",{draggable:!X,onDragStart:e=>!X&&e$(e,t),onDragOver:e=>!X&&e0(e,t),onDrop:e=>!X&&e2(e,t),onDragEnd:e1,className:"group relative py-1.5 px-1 -mx-1 rounded transition-colors ".concat(es===t?"opacity-40 scale-95":ea===t?"bg-[#e94560]/5 border border-dashed border-[#e94560]/30 rounded-lg":"hover:bg-white/[0.02]"),children:[!X&&(0,r.jsx)("div",{className:"absolute -left-7 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity hidden md:flex items-center",children:(0,r.jsx)("span",{className:"text-text-inactive text-[10px] cursor-grab active:cursor-grabbing",children:"⋮⋮"})}),(0,r.jsxs)("div",{className:"flex items-start gap-1",children:[(0,r.jsx)("div",{className:"flex-1 min-w-0",children:e3(e)}),!X&&ev.blocks.length>1&&(0,r.jsx)("button",{onClick:()=>eX(e.id),className:"flex-shrink-0 w-6 h-6 mt-0.5 flex items-center justify-center rounded-md text-text-inactive/50 hover:text-[#e94560] hover:bg-[#e94560]/10 active:text-[#e94560] active:bg-[#e94560]/10 transition-colors text-sm md:opacity-0 md:group-hover:opacity-100",title:"블록 삭제",children:"\xd7"})]}),ed&&ex===e.id&&(0,r.jsxs)("div",{ref:eb,className:"absolute left-0 top-full z-50 mt-1 w-72 bg-background-card border border-border rounded-xl shadow-2xl overflow-hidden",style:{maxHeight:"280px"},children:[(0,r.jsx)("div",{className:"p-2 border-b border-border",children:(0,r.jsx)("p",{className:"text-[10px] text-text-muted font-semibold uppercase tracking-wider px-2",children:"블록 타입 선택"})}),(0,r.jsxs)("div",{className:"overflow-y-auto",style:{maxHeight:"240px"},children:[eZ.map((e,t)=>(0,r.jsxs)("button",{onClick:()=>eG(e.type),onMouseEnter:()=>ef(t),className:"w-full flex items-center gap-3 px-3 py-2 text-left transition-colors ".concat(eh===t?"bg-[#e94560]/10 text-[#e94560]":"text-text-secondary hover:bg-background-hover"),children:[(0,r.jsx)("span",{className:"w-8 h-8 flex items-center justify-center bg-border/50 rounded-lg text-xs font-mono flex-shrink-0",children:e.icon}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs font-semibold",children:e.label}),(0,r.jsx)("p",{className:"text-[10px] text-text-muted",children:e.desc})]})]},e.type)),0===eZ.length&&(0,r.jsx)("p",{className:"text-xs text-text-muted text-center py-4",children:"일치하는 블록 타입이 없습니다"})]})]})]},e.id))}),(0,r.jsxs)("button",{onClick:()=>{eU(ev.blocks[ev.blocks.length-1].id)},className:"mt-4 w-full py-2 text-text-inactive hover:text-text-secondary text-sm text-left transition-colors",children:[t("notes.newBlock")," \xa0 ",(0,r.jsx)("span",{className:"text-[10px] opacity-50",children:"Enter로도 추가 가능 \xb7 / 로 블록 타입 선택"})]}),(0,r.jsxs)("div",{className:"mt-12 p-4 bg-background border border-border/50 rounded-xl",children:[(0,r.jsx)("div",{className:"text-[10px] text-text-inactive uppercase tracking-wider font-semibold mb-3",children:t("notes.shortcuts")}),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-x-4 gap-y-1.5 text-[11px] text-text-muted",children:[{key:"/",desc:"블록 선택"},{key:"#",desc:"제목 1"},{key:"##",desc:"제목 2"},{key:"###",desc:"제목 3"},{key:"-",desc:"글머리"},{key:"1.",desc:"번호"},{key:"[]",desc:"체크리스트"},{key:">",desc:"인용문"},{key:"---",desc:"구분선"},{key:"```",desc:"코드"},{key:"[[",desc:"링크"},{key:">>",desc:"토글"}].map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("code",{className:"px-1 py-0.5 bg-border/50 rounded text-[9px] text-[#e94560]/70 font-mono min-w-[2em] text-center",children:e.key}),(0,r.jsx)("span",{children:e.desc})]},t))})]})]})})]}):(0,r.jsx)("div",{className:"hidden md:flex flex-1 items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-6xl mb-4 animate-pulse-slow",children:"\uD83D\uDCDD"}),(0,r.jsx)("p",{className:"text-text-secondary font-semibold text-lg",children:t("notes.selectNote")}),(0,r.jsx)("p",{className:"text-text-muted text-sm mt-1",children:t("notes.orCreate")}),(0,r.jsx)("button",{onClick:()=>eT(),className:"mt-4 px-5 py-2.5 bg-[#e94560] hover:bg-[#ff5a7a] text-white font-semibold rounded-xl text-sm transition-colors",children:t("notes.newNote")})]})})]})}function p(){return(0,r.jsx)(l.Suspense,{fallback:(0,r.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,r.jsx)("div",{className:"w-6 h-6 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin"})}),children:(0,r.jsx)(u,{})})}function m(e){let{note:t,isActive:n,onClick:l,onDelete:s,onTogglePin:i,onToggleStar:a,getRelativeTime:o,indent:d}=e,c=t.blocks.filter(e=>"divider"!==e.type&&e.content).slice(0,1).map(e=>e.content).join("");return(0,r.jsxs)("div",{onClick:l,className:"group relative flex items-center gap-2 py-1.5 pr-2 rounded-lg cursor-pointer transition-all mx-2 ".concat(d>0?"pl-8":"pl-3"," ").concat(n?"bg-background-card border border-[#e94560]/30":"hover:bg-background-card/60 border border-transparent"),children:[(0,r.jsx)("span",{className:"text-base flex-shrink-0",children:t.icon}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-xs font-semibold text-text-primary truncate",children:t.title}),c&&(0,r.jsx)("p",{className:"text-[10px] text-text-inactive truncate",children:c}),(0,r.jsx)("p",{className:"text-[9px] text-text-inactive",children:o(t.updated_at)})]}),(0,r.jsxs)("div",{className:"absolute right-1 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 flex gap-0.5",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),a()},className:"w-5 h-5 flex items-center justify-center rounded text-[10px] ".concat(t.starred?"text-amber-400":"text-text-muted hover:text-amber-400"),children:t.starred?"★":"☆"}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),i()},className:"w-5 h-5 flex items-center justify-center rounded text-[10px] ".concat(t.pinned?"text-[#e94560]":"text-text-muted hover:text-[#e94560]"),children:"\uD83D\uDCCC"}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),s()},className:"w-5 h-5 flex items-center justify-center rounded text-text-muted hover:text-[#e94560] text-xs",children:"\xd7"})]})]})}},2052:function(e,t,n){"use strict";n.d(t,{P:function(){return c},a:function(){return x}});var r=n(7573),l=n(7653),s=n(6228),i=n(1926),a=n(4193);let o=(0,l.createContext)({tasks:[],lists:[],notes:[],folders:[],mindmaps:[],loading:!0,storageUsed:0});function d(e){return new Blob([e]).size}function c(e){let{children:t}=e,{user:n,loading:c}=(0,a.a)(),[x,u]=(0,l.useState)([]),[p,m]=(0,l.useState)([]),[h,f]=(0,l.useState)([]),[b,g]=(0,l.useState)([]),[v,k]=(0,l.useState)([]),[y,j]=(0,l.useState)(!0),N=(0,l.useRef)([]);(0,l.useEffect)(()=>{if(c)return;if(N.current.forEach(e=>e()),N.current=[],!n){u([]),m([]),f([]),g([]),k([]),j(!1);return}j(!0);let e=n.uid,t=0,r=()=>{++t>=5&&j(!1)},l=(0,s.cf)((0,s.IO)((0,s.hJ)(i.db,"users",e,"tasks"),(0,s.Xo)("createdAt","desc")),e=>{u(e.docs.map(e=>({id:e.id,...e.data()}))),r()},()=>r()),a=(0,s.cf)((0,s.hJ)(i.db,"users",e,"lists"),e=>{m(e.docs.map(e=>({id:e.id,...e.data()}))),r()},()=>r()),o=(0,s.cf)((0,s.IO)((0,s.hJ)(i.db,"users",e,"notes"),(0,s.Xo)("createdAt","desc")),e=>{f(e.docs.map(e=>({id:e.id,...e.data()}))),r()},()=>r()),d=(0,s.cf)((0,s.hJ)(i.db,"users",e,"folders"),e=>{g(e.docs.map(e=>({id:e.id,...e.data()}))),r()},()=>r()),x=(0,s.cf)((0,s.IO)((0,s.hJ)(i.db,"users",e,"mindmaps"),(0,s.Xo)("createdAt","desc")),e=>{k(e.docs.map(e=>({id:e.id,...e.data()}))),r()},()=>r());return N.current=[l,a,o,d,x],()=>{N.current.forEach(e=>e()),N.current=[]}},[n,c]);let w=function(e,t,n){var r,l,s,i;let a=0;for(let t of e){for(let e of(a+=d(t.title||"")+d(t.memo||""),null!==(r=t.subTasks)&&void 0!==r?r:[]))a+=d(e.title||"");for(let e of null!==(l=t.attachments)&&void 0!==l?l:[])a+=e.size}for(let e of t)for(let t of(a+=d(e.title||""),null!==(s=e.blocks)&&void 0!==s?s:[]))a+=d(t.content||"")+d(t.children||"");for(let e of n)for(let t of(a+=d(e.title||""),null!==(i=e.nodes)&&void 0!==i?i:[]))a+=d(t.text||""),t.imageSize&&(a+=t.imageSize);return a}(x,h,v);return(0,r.jsx)(o.Provider,{value:{tasks:x,lists:p,notes:h,folders:b,mindmaps:v,loading:y,storageUsed:w},children:t})}function x(){return(0,l.useContext)(o)}},1695:function(e,t,n){"use strict";var r=n(1219);n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[301,787,226,937,293,528,744],function(){return e(e.s=8886)}),_N_E=e.O()}]);