(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[755],{5333:function(e,t,r){Promise.resolve().then(r.bind(r,1194))},1194:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var s=r(7573),a=r(7653),l=r(1695),o=r(4193),n=r(9937),i=r(6921),d=r(1668),c=r(6307),x=r(1676);let u=[{id:"my-tasks",label:"My Tasks",color:"#e94560"}];function p(e){let t={urgent:{bg:"bg-red-500/20",text:"text-red-400",border:"border-red-500/30"},high:{bg:"bg-orange-500/20",text:"text-orange-400",border:"border-orange-500/30"},medium:{bg:"bg-yellow-500/20",text:"text-yellow-400",border:"border-yellow-500/30"},low:{bg:"bg-blue-500/20",text:"text-blue-400",border:"border-blue-500/30"}};return t[e]||t.medium}function m(e){return[...e.matchAll(/@([\w가-힣]+)/g)].map(e=>e[1])}function b(){var e;let t=(0,l.useSearchParams)(),{user:r}=(0,o.a)(),{t:b}=(0,n.QT)(),[h,g]=(0,a.useState)([]),[f,v]=(0,a.useState)(u),[y,j]=(0,a.useState)([]),[N,k]=(0,a.useState)(null),[w,C]=(0,a.useState)(null),[D,S]=(0,a.useState)(null),[_,P]=(0,a.useState)(""),[T,E]=(0,a.useState)(!0),[L,I]=(0,a.useState)(""),[B,J]=(0,a.useState)("medium"),[M,O]=(0,a.useState)(""),[A,U]=(0,a.useState)(!1),[F,H]=(0,a.useState)(!0),[K,R]=(0,a.useState)(null),[Q,V]=(0,a.useState)(null),W=(0,a.useRef)(!1),[Z,q]=(0,a.useState)(null),z=null!==(e=h.find(e=>e.id===Z))&&void 0!==e?e:null;(0,d.D)(h);let G={todo:{label:b("status.todo"),color:"#94a3b8"},in_progress:{label:b("status.inProgress"),color:"#8b5cf6"},completed:{label:b("status.completed"),color:"#22c55e"}};(0,a.useEffect)(()=>{let e=t.get("list");e&&k(e)},[t]);let X=(0,a.useCallback)(async()=>{if(r)try{let[e,t,s]=await Promise.all([(0,i.Ak)(r.uid),(0,i.yr)(r.uid),(0,i.Kk)(r.uid)]),a=[...e].sort((e,t)=>void 0!==e.order&&void 0!==t.order?e.order-t.order:void 0!==e.order?-1:void 0!==t.order?1:0);g(a.map((e,t)=>{var r;return{...e,order:null!==(r=e.order)&&void 0!==r?r:(t+1)*1e3}})),t.length>0&&(v(t),M||O(t[0].id)),j(s.map(e=>({id:e.id,title:e.title,icon:e.icon,tags:e.tags})))}catch(e){console.error("Failed to load tasks:",e)}finally{E(!1)}},[r]);(0,a.useEffect)(()=>{X()},[X]);let Y=h.filter(e=>!N||e.listId===N).filter(e=>!w||e.status===w).filter(e=>{var t;return!D||(null!==(t=e.tags)&&void 0!==t?t:[]).includes(D)}).filter(e=>!_||e.title.toLowerCase().includes(_.toLowerCase())),$=Y.filter(e=>"completed"!==e.status),ee=Y.filter(e=>"completed"===e.status),et=[...new Set(h.flatMap(e=>{var t;return null!==(t=e.tags)&&void 0!==t?t:[]}))].filter(Boolean),er=!N&&!w&&!D&&!_,es=D?y.filter(e=>e.tags.includes(D)||e.title.toLowerCase().includes(D.toLowerCase())):[],ea=e=>f.find(t=>t.id===e)||f[0],el=(e,t)=>{R(t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(t))},eo=(e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",V(t)},en=()=>{R(null),V(null)},ei=async(e,t)=>{if(e.preventDefault(),en(),null===K||K===t||W.current)return;let s=[...Y],[a]=s.splice(K,1);s.splice(t,0,a);let l=s.map((e,t)=>({...e,order:(t+1)*1e3}));if(g(l),r){W.current=!0;try{await Promise.all(l.map(e=>(0,i.xJ)(r.uid,e.id,{order:e.order})))}finally{W.current=!1}}},ed=async e=>{if(!r||!e.id)return;let t="completed"===e.status?"todo":"completed";g(r=>r.map(r=>r.id===e.id?{...r,status:t}:r)),await (0,i.xJ)(r.uid,e.id,{status:t})},ec=async e=>{r&&e.id&&(g(t=>t.map(t=>t.id===e.id?{...t,starred:!t.starred}:t)),await (0,i.xJ)(r.uid,e.id,{starred:!e.starred}))},ex=async e=>{var t;if(!r||!e.id)return;Z===e.id&&q(null);let s=(null!==(t=e.attachments)&&void 0!==t?t:[]).map(e=>e.id);s.length&&await (0,c.FV)(s),g(t=>t.filter(t=>t.id!==e.id)),await (0,i._5)(r.uid,e.id)},eu=async()=>{var e;if(!L.trim()||!r||A)return;U(!0);let t=L.trim(),s=m(t),a="temp-".concat(Date.now()),l=h.reduce((e,t)=>{var r;return Math.max(e,null!==(r=t.order)&&void 0!==r?r:0)},0),o={title:t,status:"todo",priority:B,starred:!1,listId:M||(null===(e=f[0])||void 0===e?void 0:e.id)||"",myDay:!1,tags:s,order:l+1e3};g(e=>[{...o,id:a},...e]),I("");try{let e=await (0,i.gI)(r.uid,o);g(t=>t.map(t=>t.id===a?{...t,id:e}:t))}catch(e){g(e=>e.filter(e=>e.id!==a))}finally{U(!1)}},ep=async e=>{if(!r||!Z)return;let t={...e};void 0!==e.title&&(t.tags=m(e.title)),g(e=>e.map(e=>e.id===Z?{...e,...t}:e)),await (0,i.xJ)(r.uid,Z,t)};return T?(0,s.jsx)("div",{className:"p-8 flex items-center justify-center min-h-[50vh]",children:(0,s.jsx)("div",{className:"w-6 h-6 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin"})}):(0,s.jsxs)("div",{className:"p-8",children:[(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCCB"}),(0,s.jsx)("h2",{className:"text-3xl font-extrabold text-text-primary",children:b("tasks.title")}),(0,s.jsx)("span",{className:"text-sm text-text-muted ml-2",children:Y.length})]}),(0,s.jsx)("p",{className:"text-text-secondary text-sm",children:b("tasks.desc")})]}),(0,s.jsxs)("div",{className:"mb-6 flex gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 flex bg-background-card border border-border rounded-xl overflow-hidden focus-within:border-[#e94560] transition-colors",children:[(0,s.jsx)("input",{type:"text",value:L,onChange:e=>I(e.target.value),onKeyDown:e=>"Enter"===e.key&&eu(),placeholder:b("myDay.addTask"),className:"flex-1 px-4 py-3 bg-transparent text-text-primary placeholder-text-muted text-sm focus:outline-none"}),(0,s.jsxs)("select",{value:B,onChange:e=>J(e.target.value),className:"px-2 bg-transparent text-xs border-l border-border focus:outline-none cursor-pointer text-text-secondary",children:[(0,s.jsx)("option",{value:"urgent",className:"bg-background-card",children:b("priority.urgent")}),(0,s.jsx)("option",{value:"high",className:"bg-background-card",children:b("priority.high")}),(0,s.jsx)("option",{value:"medium",className:"bg-background-card",children:b("priority.medium")}),(0,s.jsx)("option",{value:"low",className:"bg-background-card",children:b("priority.low")})]}),(0,s.jsx)("select",{value:M,onChange:e=>O(e.target.value),className:"px-2 bg-transparent text-text-secondary text-xs border-l border-border focus:outline-none cursor-pointer",children:f.map(e=>(0,s.jsx)("option",{value:e.id,className:"bg-background-card",children:e.label},e.id))})]}),(0,s.jsx)("button",{onClick:eu,disabled:A,className:"px-5 py-3 bg-[#e94560] hover:bg-[#ff5a7a] text-white font-semibold rounded-xl text-sm transition-colors disabled:opacity-50",children:A?"...":b("common.add")})]}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("input",{type:"text",value:_,onChange:e=>P(e.target.value),placeholder:b("tasks.search"),className:"w-full px-4 py-3 bg-background-card border border-border rounded-xl text-text-primary placeholder-text-muted text-sm focus:outline-none focus:border-[#e94560] transition-colors"})}),(0,s.jsxs)("div",{className:"mb-4 flex items-center gap-4 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-[10px] text-text-muted uppercase tracking-wider",children:b("tasks.list")}),(0,s.jsx)("button",{onClick:()=>k(null),className:"px-2.5 py-1 rounded-lg text-xs transition-all ".concat(N?"text-text-secondary hover:bg-background-card":"bg-[#e94560]/20 text-[#e94560]"),children:b("common.all")}),f.map(e=>(0,s.jsxs)("button",{onClick:()=>k(N===e.id?null:e.id),className:"px-2.5 py-1 rounded-lg text-xs transition-all flex items-center gap-1.5 ".concat(N===e.id?"":"text-text-secondary hover:bg-background-card"),style:N===e.id?{color:e.color}:void 0,children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),e.label]},e.id))]}),(0,s.jsx)("div",{className:"w-px h-5 bg-border"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-[10px] text-text-muted uppercase tracking-wider",children:b("tasks.status")}),Object.entries(G).map(e=>{let[t,r]=e;return(0,s.jsx)("button",{onClick:()=>C(w===t?null:t),className:"px-2.5 py-1 rounded-lg text-xs transition-all ".concat(w===t?"":"text-text-secondary hover:bg-background-card"),style:w===t?{color:r.color}:void 0,children:r.label},t)})]})]}),et.length>0&&(0,s.jsxs)("div",{className:"mb-4 flex items-center gap-2 flex-wrap",children:[(0,s.jsx)("span",{className:"text-[10px] text-text-muted uppercase tracking-wider",children:b("tasks.tags")}),D&&(0,s.jsx)("button",{onClick:()=>S(null),className:"px-2.5 py-1 rounded-lg text-xs bg-background-card text-text-secondary border border-border hover:border-border-hover transition-all",children:b("common.all")}),et.map(e=>(0,s.jsxs)("button",{onClick:()=>S(D===e?null:e),className:"px-2.5 py-1 rounded-lg text-xs font-semibold transition-all border ".concat(D===e?"bg-[#8b5cf6]/15 text-[#8b5cf6] border-[#8b5cf6]/30":"text-text-secondary border-border hover:border-border-hover hover:bg-background-card"),children:["@",e]},e))]}),er&&Y.length>1&&(0,s.jsxs)("p",{className:"text-[10px] text-text-inactive mb-2 flex items-center gap-1",children:[(0,s.jsx)("span",{children:"⋮⋮"}),(0,s.jsx)("span",{children:b("tasks.dragHint")})]}),(0,s.jsx)("div",{className:"space-y-2",children:$.map((e,t)=>{var r,a,l;let o=p(e.priority),n=ea(e.listId),i=Z===e.id,d=K===t,c=Q===t,x=null!==(a=e.tags)&&void 0!==a?a:[];return(0,s.jsxs)("div",{draggable:er,onDragStart:er?e=>el(e,t):void 0,onDragOver:er?e=>eo(e,t):void 0,onDrop:er?e=>ei(e,t):void 0,onDragEnd:en,onClick:()=>q(i?null:e.id),className:"group flex items-center gap-3 p-4 bg-background-card border rounded-xl transition-all cursor-pointer select-none ".concat(d?"opacity-40 scale-95":c?"border-[#e94560] shadow-[0_0_12px_rgba(233,69,96,0.15)]":i?"border-[#e94560]/40 shadow-[0_0_12px_rgba(233,69,96,0.08)]":"border-border hover:border-border-hover"),style:{animation:c?void 0:"fadeUp 0.4s ease-out both",animationDelay:"".concat(.03*t,"s")},children:[er&&(0,s.jsx)("span",{className:"opacity-0 group-hover:opacity-100 text-text-inactive text-xs cursor-grab active:cursor-grabbing flex-shrink-0 select-none",title:b("tasks.dragReorder"),children:"⋮⋮"}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),ed(e)},className:"w-6 h-6 rounded-md border-2 flex items-center justify-center transition-all duration-300 flex-shrink-0 hover:border-[#e94560] hover:shadow-[0_0_8px_rgba(233,69,96,0.3)]",style:{borderColor:"var(--color-checkbox-border)"}}),(0,s.jsx)("span",{className:"w-1.5 h-8 rounded-full flex-shrink-0",style:{backgroundColor:n.color}}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("span",{className:"block text-sm text-text-primary",children:e.title}),x.length>0&&(0,s.jsx)("div",{className:"flex items-center gap-1 mt-0.5 flex-wrap",children:x.map(e=>(0,s.jsxs)("button",{onClick:t=>{t.stopPropagation(),S(D===e?null:e)},className:"text-[9px] px-1.5 py-0.5 rounded bg-[#8b5cf6]/10 text-[#8b5cf6] font-semibold hover:bg-[#8b5cf6]/20 transition-colors",children:["@",e]},e))})]}),(null!==(l=null===(r=e.subTasks)||void 0===r?void 0:r.length)&&void 0!==l?l:0)>0&&(0,s.jsxs)("span",{className:"text-[10px] text-text-muted flex-shrink-0",children:["\uD83D\uDCCB ",e.subTasks.filter(e=>e.completed).length,"/",e.subTasks.length]}),e.dueDate&&(0,s.jsxs)("span",{className:"text-[10px] text-text-muted flex-shrink-0",children:["\uD83D\uDCC5 ",e.dueDate.slice(5)]}),(0,s.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full border flex-shrink-0",style:{color:n.color,borderColor:"".concat(n.color,"40"),backgroundColor:"".concat(n.color,"10")},children:n.label}),(0,s.jsx)("span",{className:"px-2 py-0.5 rounded text-[10px] font-semibold border flex-shrink-0 ".concat(o.bg," ").concat(o.text," ").concat(o.border),children:b("priority.".concat(e.priority))}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),ec(e)},className:"text-lg transition-all flex-shrink-0 ".concat(e.starred?"text-amber-400":"text-text-inactive hover:text-amber-400/60"),children:e.starred?"★":"☆"}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),ex(e)},className:"opacity-0 group-hover:opacity-100 text-text-inactive hover:text-[#e94560] transition-all text-lg flex-shrink-0",title:b("common.delete"),children:"\xd7"})]},e.id)})}),0===$.length&&0===ee.length&&(0,s.jsxs)("div",{className:"text-center py-16",children:[(0,s.jsx)("div",{className:"text-5xl mb-4",children:"\uD83D\uDCED"}),(0,s.jsx)("p",{className:"text-text-secondary font-semibold",children:D?"@".concat(D," ").concat(b("tasks.emptyTag")):b("tasks.empty")}),(0,s.jsx)("p",{className:"text-text-muted text-sm mt-1",children:b("tasks.emptyHint")})]}),ee.length>0&&(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsxs)("button",{onClick:()=>H(!F),className:"flex items-center gap-2 text-text-muted text-sm mb-3 hover:text-text-secondary transition-colors w-full",children:[(0,s.jsx)("span",{className:"transition-transform duration-200 text-xs ".concat(F?"rotate-90":""),children:"▶"}),(0,s.jsx)("span",{className:"font-semibold",children:b("status.completed")}),(0,s.jsx)("span",{className:"text-[10px] bg-border px-2 py-0.5 rounded-full",children:ee.length})]}),F&&(0,s.jsx)("div",{className:"space-y-2",children:ee.map((e,t)=>{var r;let a=p(e.priority),l=ea(e.listId),o=Z===e.id,n=null!==(r=e.tags)&&void 0!==r?r:[];return(0,s.jsxs)("div",{onClick:()=>q(o?null:e.id),className:"group flex items-center gap-3 p-4 bg-background-card border rounded-xl transition-all cursor-pointer opacity-60 ".concat(o?"border-[#e94560]/40":"border-border/50 hover:border-border-hover hover:opacity-80"),style:{animation:"fadeUp 0.3s ease-out both",animationDelay:"".concat(.03*t,"s")},children:[(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),ed(e)},className:"w-6 h-6 rounded-md border-2 flex items-center justify-center transition-all duration-300 flex-shrink-0 bg-gradient-to-br from-[#e94560] to-[#533483] border-transparent",children:(0,s.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:(0,s.jsx)("path",{d:"M3 7L6 10L11 4",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,s.jsx)("span",{className:"w-1.5 h-8 rounded-full flex-shrink-0",style:{backgroundColor:l.color}}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("span",{className:"block text-sm line-through text-text-inactive",children:e.title}),n.length>0&&(0,s.jsx)("div",{className:"flex items-center gap-1 mt-0.5 flex-wrap",children:n.map(e=>(0,s.jsxs)("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[#8b5cf6]/10 text-[#8b5cf6]",children:["@",e]},e))})]}),e.dueDate&&(0,s.jsxs)("span",{className:"text-[10px] text-text-muted flex-shrink-0",children:["\uD83D\uDCC5 ",e.dueDate.slice(5)]}),(0,s.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full border flex-shrink-0",style:{color:l.color,borderColor:"".concat(l.color,"40"),backgroundColor:"".concat(l.color,"10")},children:l.label}),(0,s.jsx)("span",{className:"px-2 py-0.5 rounded text-[10px] font-semibold border flex-shrink-0 ".concat(a.bg," ").concat(a.text," ").concat(a.border),children:b("priority.".concat(e.priority))}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),ex(e)},className:"opacity-0 group-hover:opacity-100 text-text-inactive hover:text-[#e94560] transition-all text-lg flex-shrink-0",title:b("common.delete"),children:"\xd7"})]},e.id)})})]}),D&&es.length>0&&(0,s.jsxs)("div",{className:"mt-8",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)("span",{className:"text-sm",children:"\uD83D\uDCDD"}),(0,s.jsxs)("span",{className:"text-xs font-bold text-text-primary",children:["@",D," ",b("tasks.relatedNotes")]}),(0,s.jsx)("span",{className:"text-[10px] text-text-muted",children:es.length})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:es.map(e=>(0,s.jsxs)("div",{className:"p-3 bg-background-card border border-border rounded-xl hover:border-[#8b5cf6]/40 transition-colors cursor-pointer",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:"text-base",children:e.icon}),(0,s.jsx)("span",{className:"text-xs font-semibold text-text-primary truncate",children:e.title})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:e.tags.map(e=>(0,s.jsxs)("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[#8b5cf6]/10 text-[#8b5cf6]",children:["@",e]},e))})]},e.id))})]})]}),z&&(0,s.jsx)(x.Z,{task:z,onClose:()=>q(null),onUpdate:ep,onDelete:()=>ex(z)})]})}function h(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"p-8 flex items-center justify-center min-h-[50vh]",children:(0,s.jsx)("div",{className:"w-6 h-6 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin"})}),children:(0,s.jsx)(b,{})})}}},function(e){e.O(0,[301,787,419,937,676,293,528,744],function(){return e(e.s=5333)}),_N_E=e.O()}]);