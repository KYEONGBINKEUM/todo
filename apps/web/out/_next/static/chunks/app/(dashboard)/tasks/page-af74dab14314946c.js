(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[755],{5620:function(e,t,r){Promise.resolve().then(r.bind(r,5427))},5427:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var s=r(6717),a=r(7387),l=r(8519),n=r(1097),o=r(9936),i=r(6813),d=r(2423),c=r(354),x=r(9907);let u=[{id:"my-tasks",label:"My Tasks",color:"#e94560"}];function m(){var e;let t=(0,l.useSearchParams)(),{user:r}=(0,n.a)(),{t:m}=(0,o.QT)(),[p,b]=(0,a.useState)([]),[h,g]=(0,a.useState)(u),[f,v]=(0,a.useState)([]),[j,k]=(0,a.useState)(null),[y,N]=(0,a.useState)(null),[w,C]=(0,a.useState)(null),[D,S]=(0,a.useState)(""),[_,P]=(0,a.useState)(!0),[T,E]=(0,a.useState)(null),[L,R]=(0,a.useState)(null),B=(0,a.useRef)(!1),[J,O]=(0,a.useState)(null),A=null!==(e=p.find(e=>e.id===J))&&void 0!==e?e:null;(0,d.D)(p);let M={todo:{label:m("status.todo"),color:"#94a3b8"},in_progress:{label:m("status.inProgress"),color:"#8b5cf6"},completed:{label:m("status.completed"),color:"#22c55e"}};(0,a.useEffect)(()=>{let e=t.get("list");e&&k(e)},[t]);let F=(0,a.useCallback)(async()=>{if(r)try{let[e,t,s]=await Promise.all([(0,i.Ak)(r.uid),(0,i.yr)(r.uid),(0,i.Kk)(r.uid)]),a=[...e].sort((e,t)=>void 0!==e.order&&void 0!==t.order?e.order-t.order:void 0!==e.order?-1:void 0!==t.order?1:0);b(a.map((e,t)=>{var r;return{...e,order:null!==(r=e.order)&&void 0!==r?r:(t+1)*1e3}})),t.length>0&&g(t),v(s.map(e=>({id:e.id,title:e.title,icon:e.icon,tags:e.tags})))}catch(e){console.error("Failed to load tasks:",e)}finally{P(!1)}},[r]);(0,a.useEffect)(()=>{F()},[F]);let H=p.filter(e=>!j||e.listId===j).filter(e=>!y||e.status===y).filter(e=>{var t;return!w||(null!==(t=e.tags)&&void 0!==t?t:[]).includes(w)}).filter(e=>!D||e.title.toLowerCase().includes(D.toLowerCase())),I=[...new Set(p.flatMap(e=>{var t;return null!==(t=e.tags)&&void 0!==t?t:[]}))].filter(Boolean),U=!j&&!y&&!w&&!D,K=w?f.filter(e=>e.tags.includes(w)||e.title.toLowerCase().includes(w.toLowerCase())):[],Q=e=>h.find(t=>t.id===e)||h[0],V=(e,t)=>{E(t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(t))},W=(e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",R(t)},Z=()=>{E(null),R(null)},q=async(e,t)=>{if(e.preventDefault(),Z(),null===T||T===t||B.current)return;let s=[...H],[a]=s.splice(T,1);s.splice(t,0,a);let l=s.map((e,t)=>({...e,order:(t+1)*1e3}));if(b(l),r){B.current=!0;try{await Promise.all(l.map(e=>(0,i.xJ)(r.uid,e.id,{order:e.order})))}finally{B.current=!1}}},z=async e=>{if(!r||!e.id)return;let t="completed"===e.status?"todo":"completed";b(r=>r.map(r=>r.id===e.id?{...r,status:t}:r)),await (0,i.xJ)(r.uid,e.id,{status:t})},G=async e=>{r&&e.id&&(b(t=>t.map(t=>t.id===e.id?{...t,starred:!t.starred}:t)),await (0,i.xJ)(r.uid,e.id,{starred:!e.starred}))},X=async e=>{var t;if(!r||!e.id)return;J===e.id&&O(null);let s=(null!==(t=e.attachments)&&void 0!==t?t:[]).map(e=>e.id);s.length&&await (0,c.FV)(s),b(t=>t.filter(t=>t.id!==e.id)),await (0,i._5)(r.uid,e.id)},Y=async e=>{if(!r||!J)return;let t={...e};void 0!==e.title&&(t.tags=[...e.title.matchAll(/@([\w가-힣]+)/g)].map(e=>e[1])),b(e=>e.map(e=>e.id===J?{...e,...t}:e)),await (0,i.xJ)(r.uid,J,t)};return _?(0,s.jsx)("div",{className:"p-8 flex items-center justify-center min-h-[50vh]",children:(0,s.jsx)("div",{className:"w-6 h-6 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin"})}):(0,s.jsxs)("div",{className:"p-8",children:[(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCCB"}),(0,s.jsx)("h2",{className:"text-3xl font-extrabold text-text-primary",children:m("tasks.title")}),(0,s.jsx)("span",{className:"text-sm text-text-muted ml-2",children:H.length})]}),(0,s.jsx)("p",{className:"text-text-secondary text-sm",children:m("tasks.desc")})]}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("input",{type:"text",value:D,onChange:e=>S(e.target.value),placeholder:m("tasks.search"),className:"w-full px-4 py-3 bg-background-card border border-border rounded-xl text-text-primary placeholder-text-muted text-sm focus:outline-none focus:border-[#e94560] transition-colors"})}),(0,s.jsxs)("div",{className:"mb-4 flex items-center gap-4 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-[10px] text-text-muted uppercase tracking-wider",children:m("tasks.list")}),(0,s.jsx)("button",{onClick:()=>k(null),className:"px-2.5 py-1 rounded-lg text-xs transition-all ".concat(j?"text-text-secondary hover:bg-background-card":"bg-[#e94560]/20 text-[#e94560]"),children:m("common.all")}),h.map(e=>(0,s.jsxs)("button",{onClick:()=>k(j===e.id?null:e.id),className:"px-2.5 py-1 rounded-lg text-xs transition-all flex items-center gap-1.5 ".concat(j===e.id?"":"text-text-secondary hover:bg-background-card"),style:j===e.id?{color:e.color}:void 0,children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),e.label]},e.id))]}),(0,s.jsx)("div",{className:"w-px h-5 bg-border"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-[10px] text-text-muted uppercase tracking-wider",children:m("tasks.status")}),Object.entries(M).map(e=>{let[t,r]=e;return(0,s.jsx)("button",{onClick:()=>N(y===t?null:t),className:"px-2.5 py-1 rounded-lg text-xs transition-all ".concat(y===t?"":"text-text-secondary hover:bg-background-card"),style:y===t?{color:r.color}:void 0,children:r.label},t)})]})]}),I.length>0&&(0,s.jsxs)("div",{className:"mb-4 flex items-center gap-2 flex-wrap",children:[(0,s.jsx)("span",{className:"text-[10px] text-text-muted uppercase tracking-wider",children:m("tasks.tags")}),w&&(0,s.jsx)("button",{onClick:()=>C(null),className:"px-2.5 py-1 rounded-lg text-xs bg-background-card text-text-secondary border border-border hover:border-border-hover transition-all",children:m("common.all")}),I.map(e=>(0,s.jsxs)("button",{onClick:()=>C(w===e?null:e),className:"px-2.5 py-1 rounded-lg text-xs font-semibold transition-all border ".concat(w===e?"bg-[#8b5cf6]/15 text-[#8b5cf6] border-[#8b5cf6]/30":"text-text-secondary border-border hover:border-border-hover hover:bg-background-card"),children:["@",e]},e))]}),U&&H.length>1&&(0,s.jsxs)("p",{className:"text-[10px] text-text-inactive mb-2 flex items-center gap-1",children:[(0,s.jsx)("span",{children:"⋮⋮"}),(0,s.jsx)("span",{children:m("tasks.dragHint")})]}),(0,s.jsx)("div",{className:"space-y-2",children:H.map((e,t)=>{var r,a,l;let n=function(e){let t={urgent:{bg:"bg-red-500/20",text:"text-red-400",border:"border-red-500/30"},high:{bg:"bg-orange-500/20",text:"text-orange-400",border:"border-orange-500/30"},medium:{bg:"bg-yellow-500/20",text:"text-yellow-400",border:"border-yellow-500/30"},low:{bg:"bg-blue-500/20",text:"text-blue-400",border:"border-blue-500/30"}};return t[e]||t.medium}(e.priority),o=Q(e.listId),i="completed"===e.status,d=J===e.id,c=T===t,x=L===t,u=null!==(a=e.tags)&&void 0!==a?a:[];return(0,s.jsxs)("div",{draggable:U,onDragStart:U?e=>V(e,t):void 0,onDragOver:U?e=>W(e,t):void 0,onDrop:U?e=>q(e,t):void 0,onDragEnd:Z,onClick:()=>O(d?null:e.id),className:"group flex items-center gap-3 p-4 bg-background-card border rounded-xl transition-all cursor-pointer select-none ".concat(c?"opacity-40 scale-95":x?"border-[#e94560] shadow-[0_0_12px_rgba(233,69,96,0.15)]":d?"border-[#e94560]/40 shadow-[0_0_12px_rgba(233,69,96,0.08)]":i?"border-border/50 opacity-60":"border-border hover:border-border-hover"),style:{animation:x?void 0:"fadeUp 0.4s ease-out both",animationDelay:"".concat(.03*t,"s")},children:[U&&(0,s.jsx)("span",{className:"opacity-0 group-hover:opacity-100 text-text-inactive text-xs cursor-grab active:cursor-grabbing flex-shrink-0 select-none",title:m("tasks.dragReorder"),children:"⋮⋮"}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),z(e)},className:"w-6 h-6 rounded-md border-2 flex items-center justify-center transition-all duration-300 flex-shrink-0 ".concat(i?"bg-gradient-to-br from-[#e94560] to-[#533483] border-transparent":"hover:border-[#e94560] hover:shadow-[0_0_8px_rgba(233,69,96,0.3)]"),style:i?void 0:{borderColor:"var(--color-checkbox-border)"},children:i&&(0,s.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:(0,s.jsx)("path",{d:"M3 7L6 10L11 4",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,s.jsx)("span",{className:"w-1.5 h-8 rounded-full flex-shrink-0",style:{backgroundColor:o.color}}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("span",{className:"block text-sm transition-all duration-300 ".concat(i?"line-through text-text-inactive":"text-text-primary"),children:e.title}),u.length>0&&(0,s.jsx)("div",{className:"flex items-center gap-1 mt-0.5 flex-wrap",children:u.map(e=>(0,s.jsxs)("button",{onClick:t=>{t.stopPropagation(),C(w===e?null:e)},className:"text-[9px] px-1.5 py-0.5 rounded bg-[#8b5cf6]/10 text-[#8b5cf6] font-semibold hover:bg-[#8b5cf6]/20 transition-colors",children:["@",e]},e))})]}),(null!==(l=null===(r=e.subTasks)||void 0===r?void 0:r.length)&&void 0!==l?l:0)>0&&(0,s.jsxs)("span",{className:"text-[10px] text-text-muted flex-shrink-0",children:["\uD83D\uDCCB ",e.subTasks.filter(e=>e.completed).length,"/",e.subTasks.length]}),e.dueDate&&(0,s.jsxs)("span",{className:"text-[10px] text-text-muted flex-shrink-0",children:["\uD83D\uDCC5 ",e.dueDate.slice(5)]}),(0,s.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full border flex-shrink-0",style:{color:o.color,borderColor:"".concat(o.color,"40"),backgroundColor:"".concat(o.color,"10")},children:o.label}),(0,s.jsx)("span",{className:"px-2 py-0.5 rounded text-[10px] font-semibold border flex-shrink-0 ".concat(n.bg," ").concat(n.text," ").concat(n.border),children:m("priority.".concat(e.priority))}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),G(e)},className:"text-lg transition-all flex-shrink-0 ".concat(e.starred?"text-amber-400":"text-text-inactive hover:text-amber-400/60"),children:e.starred?"★":"☆"}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),X(e)},className:"opacity-0 group-hover:opacity-100 text-text-inactive hover:text-[#e94560] transition-all text-lg flex-shrink-0",title:m("common.delete"),children:"\xd7"})]},e.id)})}),0===H.length&&(0,s.jsxs)("div",{className:"text-center py-16",children:[(0,s.jsx)("div",{className:"text-5xl mb-4",children:"\uD83D\uDCED"}),(0,s.jsx)("p",{className:"text-text-secondary font-semibold",children:w?"@".concat(w," ").concat(m("tasks.emptyTag")):m("tasks.empty")}),(0,s.jsx)("p",{className:"text-text-muted text-sm mt-1",children:m("tasks.emptyHint")})]}),w&&K.length>0&&(0,s.jsxs)("div",{className:"mt-8",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)("span",{className:"text-sm",children:"\uD83D\uDCDD"}),(0,s.jsxs)("span",{className:"text-xs font-bold text-text-primary",children:["@",w," ",m("tasks.relatedNotes")]}),(0,s.jsx)("span",{className:"text-[10px] text-text-muted",children:K.length})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:K.map(e=>(0,s.jsxs)("div",{className:"p-3 bg-background-card border border-border rounded-xl hover:border-[#8b5cf6]/40 transition-colors cursor-pointer",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:"text-base",children:e.icon}),(0,s.jsx)("span",{className:"text-xs font-semibold text-text-primary truncate",children:e.title})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:e.tags.map(e=>(0,s.jsxs)("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[#8b5cf6]/10 text-[#8b5cf6]",children:["@",e]},e))})]},e.id))})]})]}),A&&(0,s.jsx)(x.Z,{task:A,onClose:()=>O(null),onUpdate:Y,onDelete:()=>X(A)})]})}function p(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"p-8 flex items-center justify-center min-h-[50vh]",children:(0,s.jsx)("div",{className:"w-6 h-6 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin"})}),children:(0,s.jsx)(m,{})})}},8519:function(e,t,r){"use strict";var s=r(5878);r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[815,419,994,936,907,407,809,744],function(){return e(e.s=5620)}),_N_E=e.O()}]);