(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[755],{5620:function(e,t,r){Promise.resolve().then(r.bind(r,5427))},5427:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var s=r(6717),a=r(7387),l=r(8519),o=r(1097),n=r(9936),i=r(6813),d=r(2423),c=r(354),x=r(1730),u=r(9907);let p=[{id:"my-tasks",label:"My Tasks",color:"#e94560"}];function m(e){let t={urgent:{bg:"bg-red-500/20",text:"text-red-400",border:"border-red-500/30"},high:{bg:"bg-orange-500/20",text:"text-orange-400",border:"border-orange-500/30"},medium:{bg:"bg-yellow-500/20",text:"text-yellow-400",border:"border-yellow-500/30"},low:{bg:"bg-blue-500/20",text:"text-blue-400",border:"border-blue-500/30"}};return t[e]||t.medium}function b(e){return[...e.matchAll(/@([\w가-힣]+)/g)].map(e=>e[1])}function h(){var e;let t=(0,l.useSearchParams)(),{user:r}=(0,o.a)(),{t:h}=(0,n.QT)(),{tasks:g,lists:f,notes:v,loading:j}=(0,x.a)(),[y,N]=(0,a.useState)([]),[k,w]=(0,a.useState)(p),[C,D]=(0,a.useState)(null),[S,_]=(0,a.useState)(null),[T,E]=(0,a.useState)(null),[P,L]=(0,a.useState)(""),[I,O]=(0,a.useState)(""),[B,J]=(0,a.useState)("medium"),[M,U]=(0,a.useState)(""),[A,H]=(0,a.useState)(!1),[R,K]=(0,a.useState)(!0),[Q,W]=(0,a.useState)(null),[Z,q]=(0,a.useState)(null),z=(0,a.useRef)(!1),[F,G]=(0,a.useState)(null),V=null!==(e=y.find(e=>e.id===F))&&void 0!==e?e:null;(0,d.D)(y);let X={todo:{label:h("status.todo"),color:"#94a3b8"},in_progress:{label:h("status.inProgress"),color:"#8b5cf6"},completed:{label:h("status.completed"),color:"#22c55e"}};(0,a.useEffect)(()=>{let e=t.get("list");e&&D(e)},[t]),(0,a.useEffect)(()=>{z.current||N([...g].sort((e,t)=>void 0!==e.order&&void 0!==t.order?e.order-t.order:void 0!==e.order?-1:void 0!==t.order?1:0).map((e,t)=>{var r;return{...e,order:null!==(r=e.order)&&void 0!==r?r:(t+1)*1e3}}))},[g]),(0,a.useEffect)(()=>{f.length>0&&(w(f),M||U(f[0].id))},[f]);let Y=y.filter(e=>!C||e.listId===C).filter(e=>!S||e.status===S).filter(e=>{var t;return!T||(null!==(t=e.tags)&&void 0!==t?t:[]).includes(T)}).filter(e=>!P||e.title.toLowerCase().includes(P.toLowerCase())),$=Y.filter(e=>"completed"!==e.status),ee=Y.filter(e=>"completed"===e.status),et=[...new Set(y.flatMap(e=>{var t;return null!==(t=e.tags)&&void 0!==t?t:[]}))].filter(Boolean),er=!C&&!S&&!T&&!P,es=v.map(e=>({id:e.id,title:e.title,icon:e.icon,tags:e.tags})),ea=T?es.filter(e=>e.tags.includes(T)||e.title.toLowerCase().includes(T.toLowerCase())):[],el=e=>k.find(t=>t.id===e)||k[0],eo=(e,t)=>{W(t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(t))},en=(e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",q(t)},ei=()=>{W(null),q(null)},ed=async(e,t)=>{if(e.preventDefault(),ei(),null===Q||Q===t||z.current)return;let s=[...Y],[a]=s.splice(Q,1);s.splice(t,0,a);let l=s.map((e,t)=>({...e,order:(t+1)*1e3}));if(N(l),r){z.current=!0;try{await Promise.all(l.map(e=>(0,i.xJ)(r.uid,e.id,{order:e.order})))}finally{z.current=!1}}},ec=async e=>{if(!r||!e.id)return;let t="completed"===e.status?"todo":"completed";await (0,i.xJ)(r.uid,e.id,{status:t})},ex=async e=>{r&&e.id&&await (0,i.xJ)(r.uid,e.id,{starred:!e.starred})},eu=async e=>{var t;r&&e.id&&(F===e.id&&G(null),await (0,c.nd)(null!==(t=e.attachments)&&void 0!==t?t:[]),await (0,i._5)(r.uid,e.id))},ep=async()=>{if(!I.trim()||!r||A)return;H(!0);let e=I.trim(),t=b(e),s=y.reduce((e,t)=>{var r;return Math.max(e,null!==(r=t.order)&&void 0!==r?r:0)},0);O("");try{var a;await (0,i.gI)(r.uid,{title:e,status:"todo",priority:B,starred:!1,listId:M||(null===(a=k[0])||void 0===a?void 0:a.id)||"",myDay:!1,tags:t,order:s+1e3,createdDate:new Date().toISOString().split("T")[0]})}catch(e){}finally{H(!1)}},em=async e=>{if(!r||!F)return;let t={...e};void 0!==e.title&&(t.tags=b(e.title)),await (0,i.xJ)(r.uid,F,t)};return j?(0,s.jsx)("div",{className:"p-8 flex items-center justify-center min-h-[50vh]",children:(0,s.jsx)("div",{className:"w-6 h-6 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin"})}):(0,s.jsxs)("div",{className:"p-4 md:p-8",children:[(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCCB"}),(0,s.jsx)("h2",{className:"text-3xl font-extrabold text-text-primary",children:h("tasks.title")}),(0,s.jsx)("span",{className:"text-sm text-text-muted ml-2",children:Y.length})]}),(0,s.jsx)("p",{className:"text-text-secondary text-sm",children:h("tasks.desc")})]}),(0,s.jsxs)("div",{className:"mb-6 flex gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 flex bg-background-card border border-border rounded-xl overflow-hidden focus-within:border-[#e94560] transition-colors",children:[(0,s.jsx)("input",{type:"text",value:I,onChange:e=>O(e.target.value),onKeyDown:e=>"Enter"===e.key&&ep(),placeholder:h("myDay.addTask"),className:"flex-1 px-4 py-3 bg-transparent text-text-primary placeholder-text-muted text-sm focus:outline-none"}),(0,s.jsxs)("select",{value:B,onChange:e=>J(e.target.value),className:"px-2 bg-transparent text-xs border-l border-border focus:outline-none cursor-pointer text-text-secondary",children:[(0,s.jsx)("option",{value:"urgent",className:"bg-background-card",children:h("priority.urgent")}),(0,s.jsx)("option",{value:"high",className:"bg-background-card",children:h("priority.high")}),(0,s.jsx)("option",{value:"medium",className:"bg-background-card",children:h("priority.medium")}),(0,s.jsx)("option",{value:"low",className:"bg-background-card",children:h("priority.low")})]}),(0,s.jsx)("select",{value:M,onChange:e=>U(e.target.value),className:"px-2 bg-transparent text-text-secondary text-xs border-l border-border focus:outline-none cursor-pointer",children:k.map(e=>(0,s.jsx)("option",{value:e.id,className:"bg-background-card",children:e.label},e.id))})]}),(0,s.jsx)("button",{onClick:ep,disabled:A,className:"px-5 py-3 bg-[#e94560] hover:bg-[#ff5a7a] text-white font-semibold rounded-xl text-sm transition-colors disabled:opacity-50",children:A?"...":h("common.add")})]}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("input",{type:"text",value:P,onChange:e=>L(e.target.value),placeholder:h("tasks.search"),className:"w-full px-4 py-3 bg-background-card border border-border rounded-xl text-text-primary placeholder-text-muted text-sm focus:outline-none focus:border-[#e94560] transition-colors"})}),(0,s.jsxs)("div",{className:"mb-4 flex items-center gap-4 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-[10px] text-text-muted uppercase tracking-wider",children:h("tasks.list")}),(0,s.jsx)("button",{onClick:()=>D(null),className:"px-2.5 py-1 rounded-lg text-xs transition-all ".concat(C?"text-text-secondary hover:bg-background-card":"bg-[#e94560]/20 text-[#e94560]"),children:h("common.all")}),k.map(e=>(0,s.jsxs)("button",{onClick:()=>D(C===e.id?null:e.id),className:"px-2.5 py-1 rounded-lg text-xs transition-all flex items-center gap-1.5 ".concat(C===e.id?"":"text-text-secondary hover:bg-background-card"),style:C===e.id?{color:e.color}:void 0,children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),e.label]},e.id))]}),(0,s.jsx)("div",{className:"w-px h-5 bg-border"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-[10px] text-text-muted uppercase tracking-wider",children:h("tasks.status")}),Object.entries(X).map(e=>{let[t,r]=e;return(0,s.jsx)("button",{onClick:()=>_(S===t?null:t),className:"px-2.5 py-1 rounded-lg text-xs transition-all ".concat(S===t?"":"text-text-secondary hover:bg-background-card"),style:S===t?{color:r.color}:void 0,children:r.label},t)})]})]}),et.length>0&&(0,s.jsxs)("div",{className:"mb-4 flex items-center gap-2 flex-wrap",children:[(0,s.jsx)("span",{className:"text-[10px] text-text-muted uppercase tracking-wider",children:h("tasks.tags")}),T&&(0,s.jsx)("button",{onClick:()=>E(null),className:"px-2.5 py-1 rounded-lg text-xs bg-background-card text-text-secondary border border-border hover:border-border-hover transition-all",children:h("common.all")}),et.map(e=>(0,s.jsxs)("button",{onClick:()=>E(T===e?null:e),className:"px-2.5 py-1 rounded-lg text-xs font-semibold transition-all border ".concat(T===e?"bg-[#8b5cf6]/15 text-[#8b5cf6] border-[#8b5cf6]/30":"text-text-secondary border-border hover:border-border-hover hover:bg-background-card"),children:["@",e]},e))]}),er&&Y.length>1&&(0,s.jsxs)("p",{className:"text-[10px] text-text-inactive mb-2 flex items-center gap-1",children:[(0,s.jsx)("span",{children:"⋮⋮"}),(0,s.jsx)("span",{children:h("tasks.dragHint")})]}),(0,s.jsx)("div",{className:"space-y-2",children:$.map((e,t)=>{var r,a,l;let o=m(e.priority),n=el(e.listId),i=F===e.id,d=Q===t,c=Z===t,x=null!==(a=e.tags)&&void 0!==a?a:[];return(0,s.jsxs)("div",{draggable:er,onDragStart:er?e=>eo(e,t):void 0,onDragOver:er?e=>en(e,t):void 0,onDrop:er?e=>ed(e,t):void 0,onDragEnd:ei,onClick:()=>G(i?null:e.id),className:"group flex items-center gap-3 p-4 bg-background-card border rounded-xl transition-all cursor-pointer select-none ".concat(d?"opacity-40 scale-95":c?"border-[#e94560] shadow-[0_0_12px_rgba(233,69,96,0.15)]":i?"border-[#e94560]/40 shadow-[0_0_12px_rgba(233,69,96,0.08)]":"border-border hover:border-border-hover"),style:{animation:c?void 0:"fadeUp 0.4s ease-out both",animationDelay:"".concat(.03*t,"s")},children:[er&&(0,s.jsx)("span",{className:"opacity-0 group-hover:opacity-100 text-text-inactive text-xs cursor-grab active:cursor-grabbing flex-shrink-0 select-none",title:h("tasks.dragReorder"),children:"⋮⋮"}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),ec(e)},className:"w-6 h-6 rounded-md border-2 flex items-center justify-center transition-all duration-300 flex-shrink-0 hover:border-[#e94560] hover:shadow-[0_0_8px_rgba(233,69,96,0.3)]",style:{borderColor:"var(--color-checkbox-border)"}}),(0,s.jsx)("span",{className:"w-1.5 h-8 rounded-full flex-shrink-0",style:{backgroundColor:n.color}}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("span",{className:"block text-sm text-text-primary",children:e.title}),x.length>0&&(0,s.jsx)("div",{className:"flex items-center gap-1 mt-0.5 flex-wrap",children:x.map(e=>(0,s.jsxs)("button",{onClick:t=>{t.stopPropagation(),E(T===e?null:e)},className:"text-[9px] px-1.5 py-0.5 rounded bg-[#8b5cf6]/10 text-[#8b5cf6] font-semibold hover:bg-[#8b5cf6]/20 transition-colors",children:["@",e]},e))})]}),(null!==(l=null===(r=e.subTasks)||void 0===r?void 0:r.length)&&void 0!==l?l:0)>0&&(0,s.jsxs)("span",{className:"text-[10px] text-text-muted flex-shrink-0",children:["\uD83D\uDCCB ",e.subTasks.filter(e=>e.completed).length,"/",e.subTasks.length]}),e.dueDate&&(0,s.jsxs)("span",{className:"text-[10px] text-text-muted flex-shrink-0",children:["\uD83D\uDCC5 ",e.dueDate.slice(5)]}),(0,s.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full border flex-shrink-0",style:{color:n.color,borderColor:"".concat(n.color,"40"),backgroundColor:"".concat(n.color,"10")},children:n.label}),(0,s.jsx)("span",{className:"px-2 py-0.5 rounded text-[10px] font-semibold border flex-shrink-0 ".concat(o.bg," ").concat(o.text," ").concat(o.border),children:h("priority.".concat(e.priority))}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),ex(e)},className:"text-lg transition-all flex-shrink-0 ".concat(e.starred?"text-amber-400":"text-text-inactive hover:text-amber-400/60"),children:e.starred?"★":"☆"}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),eu(e)},className:"opacity-0 group-hover:opacity-100 text-text-inactive hover:text-[#e94560] transition-all text-lg flex-shrink-0",title:h("common.delete"),children:"\xd7"})]},e.id)})}),0===$.length&&0===ee.length&&(0,s.jsxs)("div",{className:"text-center py-16",children:[(0,s.jsx)("div",{className:"text-5xl mb-4",children:"\uD83D\uDCED"}),(0,s.jsx)("p",{className:"text-text-secondary font-semibold",children:T?"@".concat(T," ").concat(h("tasks.emptyTag")):h("tasks.empty")}),(0,s.jsx)("p",{className:"text-text-muted text-sm mt-1",children:h("tasks.emptyHint")})]}),ee.length>0&&(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsxs)("button",{onClick:()=>K(!R),className:"flex items-center gap-2 text-text-muted text-sm mb-3 hover:text-text-secondary transition-colors w-full",children:[(0,s.jsx)("span",{className:"transition-transform duration-200 text-xs ".concat(R?"rotate-90":""),children:"▶"}),(0,s.jsx)("span",{className:"font-semibold",children:h("status.completed")}),(0,s.jsx)("span",{className:"text-[10px] bg-border px-2 py-0.5 rounded-full",children:ee.length})]}),R&&(0,s.jsx)("div",{className:"space-y-2",children:ee.map((e,t)=>{var r;let a=m(e.priority),l=el(e.listId),o=F===e.id,n=null!==(r=e.tags)&&void 0!==r?r:[];return(0,s.jsxs)("div",{onClick:()=>G(o?null:e.id),className:"group flex items-center gap-3 p-4 bg-background-card border rounded-xl transition-all cursor-pointer opacity-60 ".concat(o?"border-[#e94560]/40":"border-border/50 hover:border-border-hover hover:opacity-80"),style:{animation:"fadeUp 0.3s ease-out both",animationDelay:"".concat(.03*t,"s")},children:[(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),ec(e)},className:"w-6 h-6 rounded-md border-2 flex items-center justify-center transition-all duration-300 flex-shrink-0 bg-gradient-to-br from-[#e94560] to-[#533483] border-transparent",children:(0,s.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:(0,s.jsx)("path",{d:"M3 7L6 10L11 4",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,s.jsx)("span",{className:"w-1.5 h-8 rounded-full flex-shrink-0",style:{backgroundColor:l.color}}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("span",{className:"block text-sm line-through text-text-inactive",children:e.title}),n.length>0&&(0,s.jsx)("div",{className:"flex items-center gap-1 mt-0.5 flex-wrap",children:n.map(e=>(0,s.jsxs)("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[#8b5cf6]/10 text-[#8b5cf6]",children:["@",e]},e))})]}),e.dueDate&&(0,s.jsxs)("span",{className:"text-[10px] text-text-muted flex-shrink-0",children:["\uD83D\uDCC5 ",e.dueDate.slice(5)]}),(0,s.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full border flex-shrink-0",style:{color:l.color,borderColor:"".concat(l.color,"40"),backgroundColor:"".concat(l.color,"10")},children:l.label}),(0,s.jsx)("span",{className:"px-2 py-0.5 rounded text-[10px] font-semibold border flex-shrink-0 ".concat(a.bg," ").concat(a.text," ").concat(a.border),children:h("priority.".concat(e.priority))}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),eu(e)},className:"opacity-0 group-hover:opacity-100 text-text-inactive hover:text-[#e94560] transition-all text-lg flex-shrink-0",title:h("common.delete"),children:"\xd7"})]},e.id)})})]}),T&&ea.length>0&&(0,s.jsxs)("div",{className:"mt-8",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)("span",{className:"text-sm",children:"\uD83D\uDCDD"}),(0,s.jsxs)("span",{className:"text-xs font-bold text-text-primary",children:["@",T," ",h("tasks.relatedNotes")]}),(0,s.jsx)("span",{className:"text-[10px] text-text-muted",children:ea.length})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:ea.map(e=>(0,s.jsxs)("div",{className:"p-3 bg-background-card border border-border rounded-xl hover:border-[#8b5cf6]/40 transition-colors cursor-pointer",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:"text-base",children:e.icon}),(0,s.jsx)("span",{className:"text-xs font-semibold text-text-primary truncate",children:e.title})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:e.tags.map(e=>(0,s.jsxs)("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[#8b5cf6]/10 text-[#8b5cf6]",children:["@",e]},e))})]},e.id))})]})]}),V&&(0,s.jsx)(u.Z,{task:V,onClose:()=>G(null),onUpdate:em,onDelete:()=>eu(V)})]})}function g(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"p-8 flex items-center justify-center min-h-[50vh]",children:(0,s.jsx)("div",{className:"w-6 h-6 border-2 border-[#e94560] border-t-transparent rounded-full animate-spin"})}),children:(0,s.jsx)(h,{})})}}},function(e){e.O(0,[815,419,412,936,907,407,809,744],function(){return e(e.s=5620)}),_N_E=e.O()}]);